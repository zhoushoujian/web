{"version":3,"file":"js/7.chunk.js?b081a96a","sources":["webpack:///src/components/child/statusBar.js","webpack:///src/components/child/navbar.js","webpack:///src/components/musicMvPlayer.js"],"sourcesContent":["import React from 'react';\n\nconst StatusBar = () => {\n\treturn (\n\t\t<div className=\"top-status-bar\"></div>\n\t);\n}\n\nexport default StatusBar;\n","import React, { Fragment } from 'react';\nimport StatusBar from \"./statusBar\";\n\nconst NavBar = ({ centerText=\"\", backToPreviousPage=()=>{}, rightText=\"\", rightTextFunc=()=>{}}) => {\n\treturn (\n\t\t<Fragment>\n\t\t\t<StatusBar />\n\t\t\t<div className=\"navbar-container\">\n\t\t\t<div className=\"back-btn\" onClick={backToPreviousPage}>\n\t\t\t\t<i className=\"fa fa-angle-left\" aria-hidden=\"true\"></i>\n\t\t\t</div>\n\t\t\t\t<div className=\"center-text\">{centerText}</div>\n\t\t\t\t<div className=\"other-text\" onClick={rightTextFunc}>{rightText}</div>\n\t\t\t</div>\n\t\t</Fragment>\n\t);\n}\n\nexport default NavBar;\n","import React, { useEffect, useState, useRef, Fragment } from 'react';\nimport { connect } from \"react-redux\";\nimport { useHistory } from \"react-router-dom\"\nimport { Player, BigPlayButton, ControlBar } from 'video-react';\nimport 'video-react/dist/video-react.css'\nimport { CONSTANT } from \"../constants/enumeration\"\nimport { HTTP_URL } from \"../constants/httpRoute\"\nimport Loading from \"./child/loading\"\nimport { hideMusicController, pauseMusic, dealWithThirdPartVisit, saveFileToLocalFunc } from \"../logic/common\"\nimport NavBar from \"./child/navbar\"\nimport { networkErr, shareVideoToWeChat, saveFileToLocal, comeFromWeChat } from \"../services/utils\"\nimport \"../themes/css/fileServer.less\"\n\nlet filename = \"MV\"\n, \tisFromThirdPart = false\n, \tmvId=\"\"\n, \toriginal=\"\"\n\nconst MusicMvPlayer = ({ location, userId }) => {\n\tconst [getMvLink, setGetMvLink] = useState(false)\n\tconst [mvLink, setMvLink] = useState(null)\n\tconst playerRef = useRef()\n\tconst history = useHistory()\n\n\tif(location && location.query && location.query){\n\t\tfilename = location.query.filename\n\t\tmvId = location.query.mvId\n\t\toriginal = location.query.original\n\t}\n\n\tuseEffect(() => {\n\t\tisFromThirdPart = !!location.search\n\t\tif(isFromThirdPart){\n\t\t\tconst queryParams = dealWithThirdPartVisit()\n\t\t\tif(queryParams.mvId){\n\t\t\t\tmvId = queryParams.mvId\n\t\t\t\tfilename = queryParams.filename\n\t\t\t\toriginal = queryParams.original\n\t\t\t\tuserId = \"weChatUser\" + Math.random().toString(36).slice(-5)\n\t\t\t} else {\n\t\t\t\treturn alertDialog(\"视频播放失败, 请稍候再试\")\n\t\t\t}\n\t\t} else {\n\t\t\tif(!location || !location.query) {\n\t\t\t\talertDebug(\"no location.query\")\n\t\t\t\thistory.push(\"/main/myInfo\")\n\t\t\t}\n\t\t\tdocument.addEventListener(\"deviceready\", listenBackButton, false);\n\t\t\thideMusicController()\n\t\t\tpauseMusic()\n\t\t}\n\t\tlet getMvLinkUrl = HTTP_URL.getQQMvLink\n\t\tif(original === CONSTANT.musicOriginal.netEaseCloud){\n\t\t\tgetMvLinkUrl = HTTP_URL.getNetEaseCloudMvLink\n\t\t} else if(original === CONSTANT.musicOriginal.qqMusic){\n\t\t\tgetMvLinkUrl = HTTP_URL.getQQMvLink\n\t\t}\n\t\taxios.get(getMvLinkUrl.format({id: mvId, userId}))\n\t\t\t.then((response) => {\n\t\t\t\tconst result = response.data.result\n\t\t\t\tif(result.response){\n\t\t\t\t\tsetGetMvLink(true)\n\t\t\t\t\tsetMvLink(result.response)\n\t\t\t\t\tplayerRef.current && playerRef.current.subscribeToStateChange(listenVideoState)\n\t\t\t\t} else {\n\t\t\t\t\talertDialog(\"没有视频链接\")\n\t\t\t\t\tif(!isFromThirdPart) backToMainPage(\"nav\")\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tnetworkErr(err, \"MusicMvPlayer\")\n\t\t\t})\n\t\treturn () => {\n\t\t\tportrait()\n\t\t\tdocument.removeEventListener(\"deviceready\", listenBackButton);\n\t\t\tdocument.removeEventListener(\"backbutton\", backToMainPage);\n\t\t}\n\t}, [])\n\n\tconst listenBackButton = () => {\n\t\twindow.plugins.insomnia.keepAwake()\n\t\tdocument.addEventListener(\"backbutton\", backToMainPage, false)\n    }\n\n\tconst backToMainPage = (origin) => {\n\t\tif(!isFromThirdPart){\n\t\t\tif(origin === \"nav\") window.history.back()\n\t\t\tsetTimeout(() => {\n\t\t\t\tdocument.querySelector(\"#root .container .main-content\").style.height = \"calc(100vh - 66px)\"\n\t\t\t\twindow.musicControllerRef && window.musicControllerRef.current.style && (window.musicControllerRef.current.style.display = \"flex\")\n\t\t\t}, 100)\n\t\t} else {\n\t\t\talert(\"请手动关闭页面\")\n\t\t}\n\t}\n\n\tconst landscape = () => {\n\t\tif(window.isCordova){\n\t\t\tStatusBar.overlaysWebView(true);\n\t\t\tscreen.orientation.lock('landscape');\n\t\t}\n\t}\n\n\tconst portrait = () => {\n\t\tif(window.isCordova){\n\t\t\tStatusBar.overlaysWebView(false);\n\t\t\tStatusBar.backgroundColorByHexString(CONSTANT.statusBarColor);\n\t\t\tscreen.orientation.lock('portrait');\n\t\t\twindow.plugins.insomnia.allowSleepAgain()\n\t\t}\n\t}\n\n\tconst listenVideoState = (state, prevState) => {\n\t\tif(state.isFullscreen !== prevState.isFullscreen){\n\t\t\tlogger.info(\"listenVideoState state.isFullscreen, filename\", state.isFullscreen, filename)\n\t\t\tlogger.info(\"listenVideoState prevState.isFullscreen, filename\", prevState.isFullscreen, filename)\n\t\t\tif(state.isFullscreen){\n\t\t\t\tlandscape()\n\t\t\t} else {\n\t\t\t\tportrait()\n\t\t\t}\n\t\t}\n\t}\n\n\tconst downloadMv = () => {\n\t\tif(!isFromThirdPart){\n\t\t\tconst { original, filename } = location.query;\n\t\t\tconst uploadUsername = original === CONSTANT.musicOriginal.netEaseCloud ? \"网易云\" : original === CONSTANT.musicOriginal.qqMusic ? \"qq音乐\" : \"未知\"\n\t\t\tconst filenameOrigin = filename + \".mp4\"\n\t\t\tsaveFileToLocalFunc(filename, uploadUsername, \"未知\", mvLink, false, filenameOrigin, history, null)\n\t\t} else {\n\t\t\tdownloadApp()\n\t\t}\n\t}\n\n\tconst shareToWeChat = () => {\n\t\tconst mvInfo = {\n\t\t\tfilename,\n\t\t\tmvId,\n\t\t\toriginal,\n\t\t\tisFromThirdPart: \"weChat\"\n\t\t}\n\t\tlet videoUrl = `${CONSTANT.appStaticDirectory}#/music_mv_Player`\n\t\tconst arr = []\n\t\tfor (let key in mvInfo) {\n\t\t\tarr.push(`${key}=${mvInfo[key]}`)\n\t\t}\n\t\tvideoUrl = `${videoUrl}?${arr.join('&')}`\n\t\treturn shareVideoToWeChat({\n\t\t\ttitle: \"MV: \" + filename,\n\t\t\tdescription: \"我分享了一个MV,快来看看吧\",\n\t\t\tthumb: `${CONSTANT.appStaticDirectory}logo.png`,\n\t\t\tvideoUrl\n\t\t})\n\t}\n\n\tconst downloadApp = () => {\n\t\tif(comeFromWeChat()){\n\t\t\t// setShowDownloadHeaderTip(true)\n\t\t\twindow.alertOld(\"链接打不开?请点击右上角...,选择在浏览器打开\")\n\t\t} else {\n\t\t\tsaveFileToLocal({\n\t\t\t\tfilenameOrigin: \"shareMVFromThirdPart\",\n\t\t\t\tfileUrl: CONSTANT.appDownloadUrl,\n\t\t\t\tfolder: CONSTANT.downloadAppFromPage\n\t\t\t})\n\t\t}\n\t}\n\n    return (\n\t\t<div className=\"music-mv-player-container\">\n\t\t\t<NavBar\n\t\t\t\tcenterText={filename}\n\t\t\t\tbackToPreviousPage={backToMainPage.bind(this, 'nav')}\n\t\t\t/>\n\t\t\t<div className=\"music-mv-player-content\">\n\t\t\t\t{\n\t\t\t\t\tgetMvLink\n\t\t\t\t\t? \t<Fragment>\n\t\t\t\t\t\t\t<Player ref={playerRef} autoPlay>\n\t\t\t\t\t\t\t\t<ControlBar autoHide={true} />\n\t\t\t\t\t\t\t\t<source src={mvLink} />\n\t\t\t\t\t\t\t\t<BigPlayButton position=\"center\" />\n\t\t\t\t\t\t\t</Player>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tisFromThirdPart\n\t\t\t\t\t\t\t\t?\t<div className=\"weChat-tips\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"open\" onClick={downloadApp} >打开</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"download\" onClick={downloadApp} >下载</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t:\t<div className=\"mv-menu\">\n\t\t\t\t\t\t\t\t\t\t{ window.isCordova ? <i className=\"fa fa-share share\" aria-hidden=\"true\" onClick={shareToWeChat} ></i> : null }\n\t\t\t\t\t\t\t\t\t\t<i className=\"fa fa-download download-song\" aria-hidden=\"true\" onClick={downloadMv}></i>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t:\t<Loading />\n\t\t\t\t}\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n\nconst mapStateToProps = state => {\n    return {\n\t\tuserId: state.login.userId,\n    };\n};\n\nconst mapDispatchToProps = () => ({});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MusicMvPlayer);\n"],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;AADA;AACA;AAKA;;ACRA;AACA;AACA;AACA;AACA;AADA;AACA;AAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AATA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAVA;AAaA;AAbA;AAeA;AACA;AACA;AACA;AAHA;AA1CA;AACA;AAgDA;AACA;AACA;AAFA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAFA;AAFA;AAOA;AACA;AATA;AACA;AAWA;AACA;AACA;AACA;AACA;AAJA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AATA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AARA;AACA;AAUA;AACA;AAAA;AAAA;AAAA;AAIA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAbA;AACA;AAoBA;AACA;AAEA;AAFA;AAIA;AACA;AACA;AACA;AAHA;AAKA;AAVA;AACA;AAYA;AAGA;AACA;AAFA;AAzJA;AACA;AAyLA;AACA;AACA;AADA;AADA;AACA;AAKA;AACA;AACA;;;;A","sourceRoot":""}