(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{203:function(e,t,n){"use strict";var a=n(0),i=n.n(a);t.a=(()=>i.a.createElement("div",{className:"top-status-bar"}))},204:function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(203);t.a=(({centerText:e="",backToPreviousPage:t=(()=>{}),rightText:n="",rightTextFunc:o=(()=>{})})=>i.a.createElement(a.Fragment,null,i.a.createElement(r.a,null),i.a.createElement("div",{className:"navbar-container"},i.a.createElement("div",{className:"back-btn",onClick:t},i.a.createElement("i",{className:"fa fa-angle-left","aria-hidden":"true"})),i.a.createElement("div",{className:"center-text"},e),i.a.createElement("div",{className:"other-text",onClick:o},n))))},246:function(e,t,n){"use strict";n.d(t,"b",function(){return d}),n.d(t,"c",function(){return g}),n.d(t,"d",function(){return p}),n.d(t,"a",function(){return f});var a=n(25),i=n.n(a),r=n(10),o=n(8),s=n(11),l=n(17),c=n(4);function u(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(i,r){try{var o=t[i](r),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){a("next",e)},function(e){a("throw",e)});e(s)}("next")})}}const d=()=>{const{token:e}=$getState().login;if(e){const t=Object.assign({},{token:e});return i.a.post(r.a.lastSign,t).then(e=>{logger.info("retrieveLastLoginTime  response",e.data.result.lastDay);const t=(new Date).format("yyyy-MM-dd"),{lastDay:n,signCount:a}=e.data.result;if(!n)return logger.warn("no such user"),void alertDebug("用户不存在");n&&n.split(" ")[0]===t&&p(),$dispatch(Object(l.g)(n)),$dispatch(Object(l.o)(a))}).catch(e=>{Object(c.q)(e,"lastSign")})}};let m;const g=e=>{if($getState().sign.isSignedUp)return;if(m)return;m=!0;let{currentLocation:t}=$getState().common;logger.info("currentLocation",t),t=(t="object"==typeof t?t.formatted_address:t)||"";const n=(new Date).format("yyyy-MM-dd"),{token:a}=$getState().login;if(a){const l=Object.assign({},{token:a,location:t,CurrentTime:n});logger.info("signInApp data",l),i.a.post(r.a.goSign,l).then(t=>{if(m=!1,Object(o.A)({msg:"sign in success"}),logger.info("signIn  response",t.data),"already_signed"===t.data.result.str)return alert("已签到"),void p();if("token_expired"===t.data.result.str)logger.error("身份已过期,请重新登录页"),$dispatch(Object(s.j)("")),e.push("/login");else{if("no_sign"===t.data.result.str)return $dispatch(Object(s.j)(t.data.result.token)),alert("签到成功"),p(),d(),void Object(o.S)();"error"===t.data.result.str?alert("签到失败"):"error_in_client_time"===t.data.result.str?alert("签到失败，请检查时间设置"):"no_exist_username"===t.data.result.str?alert("用户不存在!"):(logger.warn("signInApp warn",t.data),alertDebug(t.data))}}).catch(e=>{m=!1,Object(c.q)(e,`signInApp data: ${l}`)})}else m=!1,e.push("/login")},p=()=>{const{isSignedUp:e,signedFlag:t}=$getState().sign;e||$dispatch(Object(l.p)(!0)),t||$dispatch(Object(l.q)("signed-flag"))},f=()=>{isCordova&&(window.downloadAdPicTimer=setTimeout(()=>(window.downloadAdPicTimer=null,i.a.get(r.a.getAdPicture).then(e=>{const t=e.data.result.response;if("no_ad_pics"===t.message)return void logger.warn("no ad pics in server");const n=serverHost+t.url,a=t.filename,i="当前为Wi-Fi环境，更新无需移动流量"===window.getNetType()?"yes":"no";if(logger.info("downloadAdPic timer adsName",a,"isWiFiNetwork",i,"adUrl",n),!window.LocalFileSystem)return e();window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,function(e){e.root.getDirectory("miXingFeng",{create:!0},function(e){e.getDirectory("adPics",{create:!0},function(e){e.getFile(a,{create:!0,exclusive:!1},function(e){const t=new window.FileTransfer;let r=0;t.onprogress=(()=>{var e=u(function*(e){if(e.lengthComputable){const t=e.loaded/e.total;r=(100*t).toFixed(0)}});return function(t){return e.apply(this,arguments)}})(),t.download(encodeURI(n),e.nativeURL,(()=>{var e=u(function*(e){r>=1&&(localStorage.setItem("adsName",a),localStorage.setItem("isWiFiNetwork",i))});return function(t){return e.apply(this,arguments)}})(),function(e){alertDebug("setTimeout saveFileToLocal ad pic err"),logger.error("setTimeout saveFileToLocal ad pic err",e.stack||e.toString())})},function(e){logger.error("downloadAdPic 获取文件失败",e.stack||e.toString()),alert("获取文件失败")})},function(e){alert("文件系统加载失败！"),logger.error("downloadAdPic 文件系统加载失败！",e)})})})}).catch(e=>{if(console.error("setTimeout download ad pic err ",e),e)return alertDebug("setTimeout download ad pic err"),logger.error("setTimeout download ad pic err",e.stack||e.toString()),Object(c.q)(e,"setTimeout download ads pic")})),3e4))};Date.prototype.format=function(e){const t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(const n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e}},267:function(e,t,n){"use strict";n(70),n(103),n(190)},268:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=m(n(12)),i=m(n(14)),r=m(n(15)),o=m(n(13)),s=m(n(16)),l=m(n(24)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),u=m(n(104)),d=m(n(269));function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&(n[a[i]]=e[a[i]])}return n},p=function(e){function t(e){(0,i.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onClick=function(){var e=n.props,t=e.mode,a=e.onClick;a&&a(),"closable"===t&&n.setState({show:!1})},n.state={show:!0},n}return(0,s.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e=this.props,t=e.mode,n=e.icon,i=e.onClick,r=e.children,o=e.className,s=e.prefixCls,m=e.action,p=e.marqueeProps,f=g(e,["mode","icon","onClick","children","className","prefixCls","action","marqueeProps"]),h={},v=null;"closable"===t?v=c.createElement("div",{className:s+"-operation",onClick:this.onClick,role:"button","aria-label":"close"},m||c.createElement(u.default,{type:"cross",size:"md"})):("link"===t&&(v=c.createElement("div",{className:s+"-operation",role:"button","aria-label":"go to detail"},m||c.createElement(u.default,{type:"right",size:"md"}))),h.onClick=i);var w=(0,l.default)(s,o);return this.state.show?c.createElement("div",(0,a.default)({className:w},f,h,{role:"alert"}),n&&c.createElement("div",{className:s+"-icon","aria-hidden":"true"},n),c.createElement("div",{className:s+"-content"},c.createElement(d.default,(0,a.default)({prefixCls:s,text:r},p))),v):null}}]),t}(c.Component);t.default=p,p.defaultProps={prefixCls:"am-notice-bar",mode:"",icon:c.createElement(u.default,{type:"voice",size:"xxs"}),onClick:function(){}},e.exports=t.default},269:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=d(n(12)),i=d(n(14)),r=d(n(15)),o=d(n(13)),s=d(n(16)),l=u(n(0)),c=u(n(18));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){(0,i.default)(this,t);var e=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.state={animatedWidth:0,overflowWidth:0},e}return(0,s.default)(t,e),(0,r.default)(t,[{key:"componentDidMount",value:function(){this._measureText(),this._startAnimation()}},{key:"componentDidUpdate",value:function(){this._measureText(),this._marqueeTimer||this._startAnimation()}},{key:"componentWillUnmount",value:function(){clearTimeout(this._marqueeTimer)}},{key:"render",value:function(){var e=this,t=this.props,n=t.prefixCls,i=t.className,r=t.text,o=(0,a.default)({position:"relative",right:this.state.animatedWidth,whiteSpace:"nowrap",display:"inline-block"},this.props.style);return l.createElement("div",{className:n+"-marquee-wrap "+i,style:{overflow:"hidden"},role:"marquee"},l.createElement("div",{ref:function(t){return e.textRef=t},className:n+"-marquee",style:o},r))}},{key:"_startAnimation",value:function(){var e=this;this._marqueeTimer&&window.clearTimeout(this._marqueeTimer);var t=1/this.props.fps*1e3,n=0===this.state.animatedWidth?this.props.leading:t;0!==this.state.overflowWidth&&(this._marqueeTimer=window.setTimeout(function n(){var a=e.state.overflowWidth,i=e.state.animatedWidth+1,r=i>a;if(r){if(!e.props.loop)return;i=0}r&&e.props.trailing?e._marqueeTimer=window.setTimeout(function(){e.setState({animatedWidth:i}),e._marqueeTimer=window.setTimeout(n,t)},e.props.trailing):(e.setState({animatedWidth:i}),e._marqueeTimer=window.setTimeout(n,t))},n))}},{key:"_measureText",value:function(){var e=c.findDOMNode(this),t=this.textRef;if(e&&t){var n=e.offsetWidth,a=t.offsetWidth-n;a!==this.state.overflowWidth&&this.setState({overflowWidth:a})}}}]),t}(l.Component);t.default=m,m.defaultProps={text:"",loop:!1,leading:500,trailing:800,fps:40,className:""},e.exports=t.default},516:function(e,t,n){"use strict";n.r(t);n(267);var a=n(268),i=n.n(a),r=n(0),o=n.n(r),s=n(71),l=n(3),c=n(204),u=n(246),d=n(8),m=n(17),g=n(4);let p=null;t.default=Object(s.connect)(e=>({currentLocation:e.common.currentLocation,alreadySignUpPersons:e.sign.alreadySignUpPersons,notSignUpPersons:e.sign.notSignUpPersons,lastSignUpTime:e.sign.lastSignUpTime,onlinePersonsNum:e.sign.onlinePersonsNum,signedFlag:e.sign.signedFlag,isSignedUp:e.sign.isSignedUp,allowGetPosition:e.common.allowGetPosition,timeForOpenApp:e.sign.timeForOpenApp,setNickname:e.myInfo.setNickname,username:e.login.username,setMobile:e.myInfo.setMobile,signCount:e.sign.signCount}),()=>({}))(({isSignedUp:e,alreadySignUpPersons:t,notSignUpPersons:n,timeForOpenApp:a,allowGetPosition:s,signedFlag:f,currentLocation:h,onlinePersonsNum:v,lastSignUpTime:w,setNickname:b,username:y,setMobile:E,signCount:N})=>{const O=Object(l.useHistory)(),[_,k]=Object(r.useState)({hour:"",minute:"",colon:":",greetingsWord:""});Object(r.useEffect)(()=>(Object(d.m)(),T(),t.length&&n.length?e&&Object(u.d)():t.length||n.length||(Object(d.S)(),Object(u.b)()),j(),document.addEventListener("deviceready",S,!1),()=>{p&&clearInterval(p),document.removeEventListener("deviceready",S,!1),document.removeEventListener("backbutton",P,!1)}),[]);const S=()=>{document.addEventListener("backbutton",P,!1)},T=()=>{x(),p=setInterval(()=>{const e=(new Date).getDate();a<e&&($dispatch(Object(m.r)(e)),Object(d.S)()),x()},1e3)},x=()=>{let e=(new Date).getMinutes(),t=(new Date).getHours();e<10&&(e="0"+e),t<10&&(t="0"+t);let n="";""===_.colon&&(n=":");let a="";t<6?a="凌晨好！":t<8?a="早上好！":t<11?a="上午好！":t<14?a="中午好！":t<17?a="下午好！":t<19?a="傍晚好！":t<24&&(a="晚上好！"),k({hour:t,minute:e,colon:n,greetingsWord:a})},j=()=>{isCordova?s&&document.addEventListener("deviceready",d.w,!1):s&&Object(d.u)()},P=()=>{Object(g.b)("/main/myInfo",!0)};return o.a.createElement("div",{className:"sign-main"},o.a.createElement(c.a,{centerText:`${_.greetingsWord}${b||y||E}`,backToPreviousPage:P}),o.a.createElement("div",{className:"body"},o.a.createElement(i.a,{mode:"",icon:null},"您已连续签到",N,"天"),o.a.createElement("div",{className:"sign-area"},o.a.createElement("div",{className:`sign ${!f&&"flick-animation"} ${f}`,onClick:()=>{Object(u.c)(O)}},o.a.createElement("div",{className:"sign-text"},f?"已签到":"签到"),o.a.createElement("div",{id:"now-time"},o.a.createElement("span",{className:"hour"},_.hour),o.a.createElement("span",{className:"middle"},_.colon),o.a.createElement("span",{className:"minute"},_.minute))),h?o.a.createElement("div",{id:"position-location"},"您当前的位置:","object"==typeof h?h.formatted_address:h):"",o.a.createElement("div",{className:`last-sign-time ${h&&"less-margin-value"}`},"上一次签到时间：",o.a.createElement("span",{className:"last-sign"},w)),o.a.createElement("div",{className:"online-persons",onClick:()=>{O.push("/show_online_persons")}},o.a.createElement("div",{className:"text"},"当前"),o.a.createElement("div",{className:"persons"},v),o.a.createElement("div",{className:"text"},"人在线"))),o.a.createElement("div",{className:"count-area"},o.a.createElement("div",{className:"signed"},o.a.createElement("span",{className:"signed-text"},"已签到:"),o.a.createElement("p",{className:"signed-persons"},t.map((e,n)=>o.a.createElement("span",{key:e.username,className:e.origin||"h5"},e.username+(n===t.length-1?"":", "))))),o.a.createElement("div",{className:"not-signed"},o.a.createElement("span",{className:"not-signed-text"},"未签到:"),o.a.createElement("p",{className:"not-signed-persons"},n.map((e,t)=>o.a.createElement("span",{key:e.username,className:e.origin||"h5"},e.username+(t===n.length-1?"":", "))))))))})}}]);