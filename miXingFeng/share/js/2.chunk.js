(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{103:function(e,i,t){"use strict";t.d(i,"a",function(){return o});const n=window.config.debug?window.config.domain+":"+window.config.port:window.config.domainUrl,o={resetPassword:`${n}/reset_password`,loginVerify:`${n}/login_verify`,registerVerify:`${n}/register_verify`,lastSign:`${n}/last_sign`,goSign:`${n}/go_sign`,retrieveOthers:`${n}/retrieve_others`,appRelease:`${n}/apk/app_release.apk`,checkUpdate:`${n}/check_update?appVersion={appVersion}&notCheckOutOfDateVersion={notCheckOutOfDateVersion}`,tokenLogin:`${n}/token_login`,searchRecord:`${n}/search_user_profile?username={username}&slice={slice}`,checkLog:n+"/check_log",updateUserInfo:n+"/update_user_info",feedback:n+"/feedback",getList:n+"/get_list/?fileType={fileType}",uploadFile:n+"/Images",getLicence:n+"/get_licence",getPrivacy:n+"/get_privacy",getServiceList:n+"/get_service_list",getUserAgreement:n+"/get_user_agreement",getAdsConfig:n+"/get_ads_config",heartBeat:n+"/heart_beat",uploadPic:n+"/upload_pic",signRecordTypeahead:n+"/sign_record_typeahead?query={query}",getOnlinePersons:n+"/get_online_persons",replaceSocketLink:n+"/replace_socket_link",searchPosition:n+"/search_position?username={username}&positiveUsername={positiveUsername}",rpcCall:n+"/rpc_call",uploadDeviceInfo:n+"/device_info",getLoginRecord:n+"/get_login_record?username={username}&token={token}",thirdLogin:n+"/mini_program_login?code={code}&env={env}&fromApp={fromApp}",uploadRegistrationID:n+"/upload_registration_id",saveSong:n+"/save_song",delFile:n+"/del_file",checkFileMD5:n+"/check_file_md5",checkEmailValid:n+"/check_email_valid?value={value}&username={username}&email={email}&mobile={mobile}",checkMobileValid:n+"/check_mobile_valid?value={value}&username={username}&mobile={mobile}&registerFromLogin={registerFromLogin}",forgetPassword:n+"/forget_password",getNetEaseCloudMusicLists:n+"/get_net_ease_cloud_music_lists?query={query}",getQQMusicLists:n+"/get_qq_music_lists?query={query}",getKuGouMusicLists:n+"/get_ku_gou_music_lists?query={query}",getKuWoMusicLists:n+"/get_ku_wo_music_lists?query={query}",getOnlineMusicLists:n+"/get_online_music_lists?query={query}",getNetEaseCloudMusicLinksByIds:n+"/get_net_ease_cloud_music_links__by_ids",getQQMusicLinksByIds:n+"/get_qq_music_links_by_ids",getKuGouMusicLinksByIds:n+"/get_ku_gou_music_links_by_ids",getKuWoMusicLinksByIds:n+"/get_ku_wo_music_links_by_ids",getAdPicture:n+"/get_ad_picture",getNetEaseCloudMvLink:n+"/get_net_ease_cloud_mv_link?id={id}&userId={userId}",getQQMvLink:n+"/get_qq_mv_link?id={id}&userId={userId}",userActivity:n+"/user_activity",jiGuangVerify:n+"/ji_guang_verify",getPositionFromH5:n+"/get_position_from_h5?location={location}",getMusicLyric:n+"/get_music_lyric?musicId={musicId}&original={original}"}},115:function(e,i,t){"use strict";t.d(i,"i",function(){return _}),t.d(i,"a",function(){return I}),t.d(i,"n",function(){return M}),t.d(i,"c",function(){return x}),t.d(i,"o",function(){return E}),t.d(i,"u",function(){return J}),t.d(i,"m",function(){return R}),t.d(i,"l",function(){return A}),t.d(i,"j",function(){return W}),t.d(i,"r",function(){return q}),t.d(i,"k",function(){return X}),t.d(i,"d",function(){return Z}),t.d(i,"b",function(){return ie}),t.d(i,"f",function(){return te}),t.d(i,"g",function(){return ne}),t.d(i,"t",function(){return oe}),t.d(i,"v",function(){return re}),t.d(i,"w",function(){return ae}),t.d(i,"q",function(){return se}),t.d(i,"h",function(){return ue}),t.d(i,"e",function(){return ge}),t.d(i,"s",function(){return me}),t.d(i,"p",function(){return we});t(205);var n=t(204),o=t(103),r=t(24),a=t(94),s=t(21),c=t(23),l=t(22),u=t(19),d=t(181),g=(t(122),t(123),t(27),t(93));window.loginFlag=!1;var f=t(182);let m;const w=window.indexedDB.open("recentMusic",1);w.onerror=function(e){logger.error("recentMusic 数据库打开报错")},w.onsuccess=function(e){m=w.result,logger.info("recentMusic 数据库打开成功")},w.onupgradeneeded=function(e){(m=e.target.result).createObjectStore("recentMusic",{keyPath:"filenameOrigin"})};const p=e=>"[object Object]"!==Object.prototype.toString.call(e)?Promise.reject("error_data_type"):new Promise((i,t)=>{const n=m.transaction(["recentMusic"],"readwrite").objectStore("recentMusic").add(e);n.onsuccess=function(e){i("success"),logger.info("recentMusic 数据写入成功")},n.onerror=function(e){t(e),logger.warn("recentMusic 数据写入失败")}}),h=e=>new Promise((i,t)=>{const n=m.transaction(["recentMusic"],"readwrite").objectStore("recentMusic").delete(e);n.onsuccess=function(e){const t=e.target.result;logger.info("recentMusic 数据移除成功",t),i(t||"success")},n.onerror=function(e){logger.error("recentMusic 数据移除失败"),t(e)}});var O=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};let y=(()=>{var e=S(function*(e,i,t=[],o,r,a,s=!1){if(!a)if(function(){window.platSongNumberTimer&&clearTimeout(window.platSongNumberTimer);window.platSongNumberTimer=setTimeout(()=>{window.playSongNumber=0},1500)}(),window.playSongNumber>=2?(window.playSongNumber++,z.push(o),yield H(1500)):window.playSongNumber++,1===z.length)z.length=0;else if(z.length>=2)return b.info("musicHowlPlay cancel unnecessary song playing filenameOrigin",o),void z.shift();b.info("musicHowlPlay filePath",e);const c=new n.Howl({src:[e],loop:!i,rate:1,html5:!0,onloaderror:function(i,n){if(b.error("playMusic onloaderror error ",n),b.error("play music err filePath, filenameOrigin, original",e,o,r),window.musicPlayErrorTimes>=5)b.warn("Howl onloaderror more than 5, start to stopMusic"),V();else{const{currentFileIndex:e,currentMusicFilenameOriginalArr:i}=G(o,t);A(e,i,r,t,null)}t.some(e=>{if(E(e.filenameOrigin)===E(o))return delete e.getNewestPath,!0}),s||(b.warn("play music err musicPlayErrorTimes",window.musicPlayErrorTimes),void 0===window.musicPlayErrorTimes?(window.musicPlayErrorTimes=0,alertDialog("音乐播放异常,请尝试其他音乐")):window.musicPlayErrorTimes<=2?(window.musicPlayErrorTimes++,alertDialog("音乐播放异常,请尝试其他音乐")):window.musicPlayErrorTimes++)},onplay:function(){window.musicPlayErrorTimes&&(window.musicPlayErrorTimes=0,b.warn("onplay musicPlayErrorTimes",window.musicPlayErrorTimes))},onend:function(){const{pauseWhenOver:e,playByOrder:i,playByRandom:n}=$getState().fileServer;b.info("onend pauseWhenOver, playByOrder, playByRandom",e,i,n),B(),i?setTimeout(()=>{t.length?Q("playByOrder",o,t,r):(W(),$dispatch(Object(u.h)(0)))},1500):n?setTimeout(()=>{t.length?Q("playByRandom",o,t,r):(W(),$dispatch(Object(u.h)(0)))},1500):e&&($dispatch(Object(u.B)(!1)),clearInterval(window.currentTimeInterval))}}),l=c.play();$dispatch(Object(u.z)(c)),$dispatch(Object(u.A)(l)),U()});return function(i,t){return e.apply(this,arguments)}})();function S(e){return function(){var i=e.apply(this,arguments);return new Promise(function(e,t){return function n(o,r){try{var a=i[o](r),s=a.value}catch(e){return void t(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}const b=window.logger||console;let v=!1,$=null;let j=null;const k=e=>{if(!e.length)return;let i=(new Date).format("yyyy-MM-dd"),t=e,n=[],o=[];for(let e=0,r=t.length;e<r;e++)t[e].date&&t[e].date.split(" ")[0]===i?n.push({username:t[e].username||t[e].mobile,origin:t[e].origin}):o.push({username:t[e].username||t[e].mobile,origin:t[e].origin});window.logger.info("setOthersSignInfo signedArray",n.length),window.logger.info("setOthersSignInfo unsignedArray",o.length),window.$dispatch(Object(c.b)(n)),window.$dispatch(Object(c.d)(o))},P=(e,i)=>{let t,n=Promise.resolve();if("file"===i){t=`cdvfile://localhost/sdcard/miXingFeng/download/${e}`;const{fileList:i=[],downloadedFileList:o}=$getState().fileServer;i.some(i=>{if(i.filenameOrigin===e){if(i.downloaded)return delete i.downloaded,!0;b.warn("no downloaded to be deleted from fileList filenameOrigin",e)}}),$dispatch(Object(u.m)(i)),n=Object(d.c)(`downloaded_${e}`).then(()=>{const i=JSON.parse(JSON.stringify(o));let t=null;if(i.some((i,n)=>{if(E(i.filenameOrigin)===e)return t=n,!0}),null!==t)return i.splice(t,1),$dispatch(Object(u.i)(i)),"success";b.warn("no downloaded to be deleted from file downloaded filenameOrigin",e)}).catch(e=>{b.error("removeFileFromDownload file err",e)})}else"music"===i&&(t=`cdvfile://localhost/sdcard/miXingFeng/music/${e}`,n=Object(f.b)(`downloaded_${e}`).then(()=>{const{downloadedMusicList:i}=$getState().fileServer,t=JSON.parse(JSON.stringify(i));return i.some((i,n)=>{if(E(i.filenameOrigin)===e)return t.splice(n,1),!0}),$dispatch(Object(u.j)(t)),"success"}).catch(e=>{alertDebug("removeMusicDataByIndexFromIndexDB err"),b.error("removeFileFromDownload music err",e)}));const o=new Promise((e,i)=>{window.resolveLocalFileSystemURL(t,function(t){t.remove(function(){b.info("removeFileFromDownload success"),e("success")},function(e){b.error("removeFileFromDownload err",e),i(e)},function(){b.warn("removeFileFromDownload file_not_exist"),e("file_not_exist")})})});return Promise.all([n,o]).then(e=>(b.info("removeFileFromDownload response",e),e)).catch(e=>{alert("删除失败"),b.error("removeFileFromDownload err",e)})};const _=(()=>{var e=S(function*(e){window.localStorage.removeItem("tk");const{username:i=""}=$getState().login,{setMobile:t="",setEmail:n=""}=$getState().myInfo;$dispatch(Object(s.h)("")),$dispatch(Object(c.c)("")),$dispatch(Object(c.b)([])),$dispatch(Object(c.d)([])),$dispatch(Object(c.f)(!1)),$dispatch(Object(s.e)(!0)),$dispatch(Object(l.k)("")),$dispatch(Object(l.p)("")),$dispatch(Object(l.m)("")),$dispatch(Object(l.e)("")),$dispatch(Object(l.g)("")),$dispatch(Object(c.g)("")),$dispatch(Object(l.l)("")),$dispatch(Object(l.f)("")),$dispatch(Object(l.i)("")),$dispatch(Object(l.n)("")),$dispatch(Object(l.o)("")),$dispatch(Object(s.j)("")),$dispatch(Object(u.p)([])),$dispatch(Object(r.j)([])),localStorage.removeItem("lastSignUpTime"),localStorage.removeItem("alreadySignUpPersons"),localStorage.removeItem("notSignUpPersons"),localStorage.removeItem("userProfile"),localStorage.removeItem("role"),localStorage.removeItem("favoriteSongs"),localStorage.setItem("username",i),localStorage.setItem("mobile",t),localStorage.setItem("email",n),goRoute(e,"/login")});return function(i){return e.apply(this,arguments)}})(),I=e=>{let i="";return e?"number"!=typeof e?String(e):(e>1073741824?i=(e/1024/1024/1024).toFixed(2)+"GB":e>1048576?i=(e/1024/1024).toFixed(2)+"MB":e>1024?i=(e/1024).toFixed(2)+"KB":e<1024&&(i=e+"B"),i):"未知"},F=(e="websocket interval check")=>{try{if(window.isCordova){const e=cordova.plugins&&cordova.plugins.backgroundMode&&cordova.plugins.backgroundMode.isActive();b.debug("isBackground",e)}if(b.debug("websocket heart beat reconnectAndSend readyState ping",window.ws.readyState,"log",e),1!==window.ws.readyState)b.debug("reconnectAndSend window.ws.readyState !== 1",e),M(`heart beat: ${e}`);else{let i=Object.assign({},{type:"check-connect",userId:$getState().login.userId,data:"ping",date:Date.now()});window.ws.send(JSON.stringify(i)),v=!1,$=setTimeout(()=>{b.warn("reconnectAndSendTimeout reconnectSocket",e),$=null,M("heart beat")},1e4)}}catch(e){b.error("reconnectAndSend err",e)}},M=e=>{const i=$getState().login.userId;window.ws&&window.ws.close&&window.ws.close(1e3),window.websocketHeartBeatInterval&&clearInterval(window.websocketHeartBeatInterval),b.debug("正在重新建立websocket连接...",e),window.ws=new WebSocket(window.config.debug?`ws://${window.config.host}:${window.config.socketPort}`:`wss://${window.config.socketUrl}`),window.ws.onopen=(()=>T(window.ws.readyState,i)),window.ws.onmessage=(e=>N(e))},T=(e,i)=>{b.info("websocket connected",e,"当前用户id",i);const t=Object.assign({},{type:"try-connect",userId:i,date:Date.now(),data:""});window.ws.send(JSON.stringify(t)),window.websocketHeartBeatInterval=setInterval(F,6e4)},N=(()=>{var e=S(function*(e){try{const i=$getState().login.userId,t=window.logger||console;switch((e=JSON.parse(e.data)).type){case"pong":t.debug("incomingMessage pong",e),v=!0,subjectModel.notifyObserver(j);break;case"socket-heart-beat":t.info("incomingMessage server-socket-heart-beat",e);const n={type:"check-connect",userId:i,data:"reply-server-heart-beat",date:Date.now()};window.ws.send(JSON.stringify(n));break;case"response-date":t.info(`incomingMessage Roundtrip time: ${Date.now()-e.data} ms`);break;case"order-string":t.info("incomingMessage 用户加入",e.data);break;case"online-persons":$dispatch(Object(c.e)(e.data)),t.info(`incomingMessage 当前在线人数: ${e.data}`);break;case"get-sign-array":t.info("incomingMessage get-sign-array",e.data.length),$getState().login.token&&k(e.data);break;case"get-files-array":const o=e.data;(yield Object(d.b)()).forEach(function(e){o.forEach(function(i){E(e.filenameOrigin)===i.filenameOrigin&&(i.downloaded=!0)})}),o.forEach(function(e){e.filePath=window.serverHost+e.filePath}),$dispatch(Object(u.m)(o)),t.info("incomingMessage get-files-array",o.length);break;case"get-musics-array":const{musicCollection:a}=$getState().fileServer,s=e.data;s.forEach(function(e){e.filePath=window.serverHost+e.filePath}),a.forEach(function(e){s.forEach(function(i){E(e.filenameOrigin)===E(i.filenameOrigin)&&(i.saved=!0)})}),$dispatch(Object(u.q)(s)),t.info("incomingMessage get-musics-array",s.length);break;case"get-current-position":t.info("incomingMessage get-current-position",e);const{allowOthersGetPosition:l}=$getState().common,g={type:"upload-user-position",userId:i,data:{info:"available",currentLocation:$getState().common.currentLocation,currentXYPosition:$getState().common.currentXYPosition},date:Date.now()};l||(g.data.info="user_not_allowed"),window.ws.send(JSON.stringify(g)),alert(`${e.data}获取了你的位置`);break;case"update-share-nickname":t.info("incomingMessage update-share-nickname length",e.data.length),$dispatch(Object(r.j)(e.data));break;default:t.error("incomingMessage default error",e)}}catch(e){b.error("onmessage JSON.parse",e.stack||e.toString())}});return function(i){return e.apply(this,arguments)}})();const L=(e=[{}],i="filenameOrigin",t={})=>{if(!e.length)return e;const n={};let o=null;for(let t=0;t<e.length;t++){if(!e[t][i]||n[e[t][i]]){o=t;break}n[e[t][i]]=!0}return null!==o?(t.noWarn||b.error("removeDuplicateObjectList same file field",i,"list[willRemoveIndex]",e[o]),e.splice(o,1),L(e,i,t)):e},x=e=>!!/^(?=(?=.*[a-z])(?=.*[A-Z])|(?=.*[a-z])(?=.*\d)|(?=.*[A-Z])(?=.*\d))[^]{6,16}$/.test(e),D=(e,i)=>{const{musicCollection:t}=$getState().fileServer;return i!==g.a.musicOriginal.savedSongs&&(e.forEach(e=>{delete e.saved}),t.forEach(i=>{e.some(e=>E(i.filenameOrigin)===E(e.filenameOrigin)&&(e.saved=!0,!0))})),e},E=e=>{if(e)return e.replace(/downloading_|downloaded_|saved_|searchAll_|onlineMusic_|searchMusic_|recent_/g,"")},J=({savedMusicFilenameOriginalArr:e,filenameOrigin:i,musicCollection:t,musicDataList:n,currentFileIndex:r,original:c,e:l,pageType:d})=>{try{if(l&&l.stopPropagation(),-1===r||null===r)return alert("请选择一首歌播放");const{username:f,token:m}=$getState().login,{setMobile:w}=$getState().myInfo;if(!m)return alert("请先登录");const p=e.indexOf(E(i)),h=JSON.parse(JSON.stringify(t)),O=JSON.parse(JSON.stringify(n)),y=JSON.parse(JSON.stringify(n)),S=y.map(e=>e.filenameOrigin);let v=!1;const $=JSON.parse(JSON.stringify(n[r]));if(-1!==p)c===g.a.musicOriginal.savedSongs&&O.splice(p,1),h.splice(p,1);else{const{currentMusicItemInfo:e}=$getState().fileServer;e.filenameOrigin===$.filenameOrigin&&($.filePath=e.filePath),$.filenameOrigin=`saved_${$.filenameOrigin}`,$.filename=we($.filename),c===g.a.musicOriginal.musicFinished&&($.filePath=$.fileUrl,delete $.fileUrl),delete $.getNewestPath,h.push($),v=!0}const j={username:f||w,token:m,isSaved:v,willSavedSong:$,musicCollection:h};return axios.post(o.a.saveSong,j).then(e=>{if("success"===e.data.result.result){D(n,c),$dispatch(Object(s.h)(e.data.result.token)),h.forEach(e=>{delete e.saved}),$dispatch(Object(u.p)(h));const t=JSON.parse(JSON.stringify(n[r]));t.filename=we(t.filename);const{currentPlayingSong:o}=$getState().fileServer;return-1!==p?(delete t.saved,o===t.filenameOrigin&&$dispatch(Object(u.b)(t)),O.some(e=>{if(E(e.filenameOrigin)===E(i))return delete e.saved,!0}),$dispatch(Object(u.c)(O)),alert("取消收藏成功"),d===g.a.musicOriginal.savedSongs&&o===t.filenameOrigin&&pe(r,S,c,y),!1):(t.saved=!0,E(o)===E(t.filenameOrigin)&&$dispatch(Object(u.b)(t)),O.some(e=>{if(E(e.filenameOrigin)===E(i))return e.saved=!0,!0}),$dispatch(Object(u.c)(O)),alert("收藏成功"),!0)}b.error("HTTP_URL.saveSong result not success",e)}).catch(e=>{b.error("HTTP_URL.saveSong err",e),Object(a.g)(e,`saveSong dataObj: ${j}`)})}catch(e){b.error("saveSongFunc err",e)}},R=(e,i,t,n,o)=>{if(o&&o.stopPropagation(),null===e)return alert("请选择一首歌播放");return e||(e=i.length),K(n[--e],t,n,null,{type:"playPreviousSong",currentFileIndex:e,currentMusicFilenameOriginalArr:i})},A=(e,i,t,n,o)=>{if(o&&o.stopPropagation(),null===e)return alert("请选择一首歌播放");return e===i.length-1&&(e=-1),K(n[++e],t,n,null,{type:"playNextSong",currentFileIndex:e,currentMusicFilenameOriginalArr:i})};let C=0;const U=()=>{clearInterval(window.currentTimeInterval);let e=0;window.currentTimeInterval=setInterval(()=>{const{soundInstance:i}=$getState().fileServer;setTimeout(()=>{try{if(i&&"function"==typeof i.seek&&"number"==typeof i.seek()&&NaN!==i.seek()&&0!==i.seek()){const t=i.seek();e!==t&&(B(),$dispatch(Object(u.h)(t)),e=t)}}catch(e){C++,b.error("getMusicCurrentPlayProcess errorTime",C,"soundInstance.seek err",e),C>=15&&(clearInterval(window.currentTimeInterval),V())}},50)},1e3)},B=()=>{const{currentPlayingSongDuration:e,currentSongTime:i,currentMusicItemInfo:t}=$getState().fileServer;if(e&&NaN!==e&&window.circleControlRef)if(window.circleControlRef.style.strokeDashoffset>0){const e=i/t.duration;window.circleControlRef.style.strokeDashoffset=g.a.strokeDashoffset*(1-e)}else window.circleControlRef.style.strokeDashoffset=314},W=()=>{const{soundInstance:e,soundInstanceId:i,currentPlayingSong:t}=$getState().fileServer;b.info("music pause currentPlayingSong",t),e&&i&&e.pause(i),$dispatch(Object(u.B)(!1))},q=()=>{const{soundInstance:e,soundInstanceId:i,currentPlayingSong:t}=$getState().fileServer;if(b.info("music resume currentPlayingSong",t),e&&i)e.play(i),$dispatch(Object(u.B)(!0));else try{const{pauseWhenOver:e}=$getState().fileServer,i=JSON.parse(localStorage.getItem("lastPlaySongInfo"))||{},t=JSON.parse(localStorage.getItem("lastPlaySongMusicDataList"))||[],n=localStorage.getItem("filePath");$dispatch(Object(u.B)(!0)),y(n||i.filePath,e,t,i.filenameOrigin,i.original,!0,!1)}catch(e){b.error("resumeMusic err",e),V()}},V=()=>{const{soundInstance:e,soundInstanceId:i,currentPlayingSong:t}=$getState().fileServer;b.info("music stop currentPlayingSong",t),e&&i&&(e.stop(i),e.unload()),$dispatch(Object(u.B)(!1)),$dispatch(Object(u.h)(0)),$dispatch(Object(u.z)(null)),$dispatch(Object(u.A)(null)),$dispatch(Object(u.e)(null)),$dispatch(Object(u.s)("")),$dispatch(Object(u.g)("")),$dispatch(Object(u.f)("")),$dispatch(Object(u.c)([])),$dispatch(Object(u.b)({})),localStorage.removeItem("lastPlaySongInfo"),localStorage.removeItem("lastPlaySongPageType"),localStorage.removeItem("lastPlaySongMusicDataList"),window.circleControlRef&&(window.circleControlRef.style.strokeDashoffset=g.a.strokeDashoffset,window.circleControlRef.style.strokeWidth="8px")},X=(()=>{var e=S(function*({filePath:e,filenameOrigin:i,duration:t,original:n,musicDataList:r,pageType:a,filename:s,musicId:c,songOriginal:l,checkLastMusicWhenLaunch:d=!1,songInfo:f={}}){try{f.filename&&(f.filename=we(f.filename),$dispatch(Object(u.b)(f))),$dispatch(Object(u.d)("正在获取歌词...")),localStorage.getItem("notFirstTimePlayMusic")||d||!window.isCordova||window.isDevModel||(localStorage.setItem("notFirstTimePlayMusic",!0),alertDialog("音乐置于后台播放时，为了应用不被系统省电杀掉，状态栏会出现消息提示","","我知道了"));const{pauseWhenOver:m,recentMusicList:w}=$getState().fileServer;let O=f,S=!!e&&e.includes("cdvfile://localhost/sdcard/miXingFeng/music/");if(S){if(!(yield ee(E(i),"music"))){alertDialog(`${s}已被删除`),b.warn("playMusic 已被删除 filePath, filenameOrigin",e,i),P(E(i),"music");let t=-1;if(w.some(function(e,n){if(e.filenameOrigin===i)return t=n,!0}),-1!==t){const e=JSON.parse(JSON.stringify(w));e.splice(t,1),$dispatch(Object(u.w)(e)),h(i)}return}e=E(e)}r=L(r,"filenameOrigin"),b.info("playMusic music play filenameOrigin",i);const{soundInstance:v,soundInstanceId:$,currentPlayingSong:j}=$getState().fileServer;if(b.info("music stop currentPlayingSong",j),v&&$&&(v.stop($),v.unload()),$dispatch(Object(u.h)(0)),r&&r.length&&$dispatch(Object(u.c)(r)),d||$dispatch(Object(u.B)(!0)),$dispatch(Object(u.e)(i)),$dispatch(Object(u.f)(t)),$dispatch(Object(u.g)(n)),a&&$dispatch(Object(u.s)(a)),S)r.some(function(e){if(E(e.filenameOrigin)===E(i))return O=JSON.parse(JSON.stringify(e)),!0});else{let t=!0;if(d||r.some(function(e){if(E(e.filenameOrigin)===E(i))return O.filename||(O=JSON.parse(JSON.stringify(e)),$dispatch(Object(u.b)(O))),e.getNewestPath&&(t=!1,l===g.a.musicOriginal.kuGouMusic&&$dispatch(Object(u.d)(O.lyric))),!0}),t||l===g.a.musicOriginal.netEaseCloud){if(!(e=yield ie(e,l,c,r,i,d,n)))return void $dispatch(Object(u.d)("暂无歌词"));if("获取播放链接出错"===e)return alertDialog(e);{O.filePath=e;const t=JSON.parse(JSON.stringify(r));t.some(function(n,o){E(n.filenameOrigin)===E(i)&&(t[o].filePath=e)}),$dispatch(Object(u.b)(O)),$dispatch(Object(u.c)(t))}}}if(d||D([O],"usedForControllerAndPlayingPage"),O.filename&&!d&&1===window.location.href.split("?").length){const e=JSON.parse(JSON.stringify(O)),t=JSON.parse(JSON.stringify(r));delete e.getNewestPath,a===g.a.musicOriginal.savedSongs?(e.saved=!0,t.forEach(function(e){delete e.getNewestPath,e.saved=!0})):t.forEach(function(e){delete e.getNewestPath}),localStorage.setItem("lastPlaySongInfo",JSON.stringify(e)),localStorage.setItem("lastPlaySongPageType",a),localStorage.setItem("lastPlaySongMusicDataList",JSON.stringify(t));let n=JSON.parse(JSON.stringify(O));const o=JSON.parse(JSON.stringify(w));if(n.date=Date.now(),w.length&&O.filenameOrigin){if(E(w[0].filenameOrigin)===E(i)&&w[0].original===l)b.info("playMusic onload same song filenameOrigin, songOriginal, pauseWhenOver",i,l,m);else if(a!==g.a.musicOriginal.musicRecent){n.filenameOrigin="recent_"+O.filenameOrigin;let e,i=!0;w.some(function(t,n){if(E(t.filenameOrigin)===E(O.filenameOrigin))return e=n,i=!1,!0}),i?(o.unshift(n),delete n.getNewestPath,p(n)):(o.splice(e,1),o.unshift(n),h(n.filenameOrigin),delete n.getNewestPath,p(n))}}else O.filenameOrigin&&(n.filenameOrigin="recent_"+O.filenameOrigin,delete n.getNewestPath,p(n),o.unshift(n));$dispatch(Object(u.w)(o))}d?localStorage.setItem("filePath",e):yield y(e,m,r,i,n,S,d);const{currentMusicItemInfo:k}=$getState().fileServer,_=k.original;if(_===g.a.musicOriginal.qqMusic||_===g.a.musicOriginal.netEaseCloud){if(!c)return void b.warn("no musicId to get lyric songOrigin",_);O.lyric?$dispatch(Object(u.d)(O.lyric)):axios.get(o.a.getMusicLyric.format({musicId:c,original:_})).then(function(e){const i=e.data.result.response;let t="";_===g.a.musicOriginal.netEaseCloud?t=i.lrc&&i.lrc.lyric||"":_===g.a.musicOriginal.qqMusic&&(t=i.data.lyric),O.lyric=t,$dispatch(Object(u.d)(t))})}else _!==g.a.musicOriginal.kuGouMusic&&$dispatch(Object(u.d)(""));window.circleControlRef&&(window.circleControlRef.style.strokeDashoffset=g.a.strokeDashoffset,window.circleControlRef.style.strokeWidth="8px")}catch(e){b.error("play() fail err",e&&e.stack||e.toString());const{currentFileIndex:t,currentMusicFilenameOriginalArr:o}=G(i,r);A(t,o,n,r,null),alert("播放失败")}});return function(i){return e.apply(this,arguments)}})();function G(e,i){const t={};return t.currentMusicFilenameOriginalArr=i.map((i,n)=>(i.filenameOrigin===e&&(t.currentFileIndex=n),i.filenameOrigin)),t}window.playSongNumber=0;const z=[];const H=e=>new Promise(i=>{setTimeout(i,e)}),Q=(e,i,t,n)=>{try{const o=t.map(e=>e.filenameOrigin);let r=o.indexOf(i);r===o.length-1&&(r=-1),r++,b.info("autoPlayNextOne filenameOrigin",i,"type",e),"playByRandom"===e&&1!==o.length&&(r=Y(o,r)),K(t[r],n,t,e,null)}catch(e){alertDialog("音乐文件异常, 暂停播放"),b.error("autoPlayNextOne play onEnd err",e)}};function K(e,i,t,n,o){if($dispatch(Object(u.h)(0)),e.payPlay&&!$getState().myInfo.setMusicVip){if(alert("尊重版权,人人有责"),b.info("playAnotherSong 尊重版权,人人有责 anotherSongInfo",e),n)return Q(n,e.filenameOrigin,t,i);if(o){if("playPreviousSong"===o.type)return R(o.currentFileIndex,o.currentMusicFilenameOriginalArr,i,t,null);if("playNextSong"===o.type)return A(o.currentFileIndex,o.currentMusicFilenameOriginalArr,i,t,null)}}else X({filePath:e.filePath,filenameOrigin:e.filenameOrigin,duration:e.duration,original:i,musicDataList:t,pageType:$getState().fileServer.musicPageType,filename:e.filename,musicId:e.id,songOriginal:e.original,songInfo:e})}const Y=(e,i)=>{const t=parseInt(Math.random()*e.length);return i===t?(b.warn("getRandomFileIndex repeat randomFileIndex",t,"currentFileIndex",i),Y(e,i)):(b.info("getRandomFileIndex randomFileIndex",t),t)},Z=()=>{setTimeout(()=>{const e=window.getRoute(),i=["/search_music","/search_online_music","/search_all","/saved_songs","/my_finished_musics","/recent_music_played"];let t=!1;if(!window.isCordova&&"/my_finished_musics"===e)return ne();e?(i.forEach(i=>{i===e&&(t=!0)}),t?$getState().fileServer.showMusicController||setTimeout(()=>{$dispatch(Object(u.x)(!0))},100):ne()):ne()})},ee=(e,i)=>new Promise(function(t){window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,function(n){n.root.getDirectory("miXingFeng",{create:!0},function(n){n.getDirectory(i,{create:!0},function(i){i.getFile(e,{create:!1,exclusive:!0},function(i){b.info("checkFileExistOrNot file is already exist, filenameOrigin",e),t(!0)},()=>{b.info("checkFileExistOrNot file is not exist at all, filenameOrigin",e),t(!1)})},e=>{b.error("checkFileExistOrNot load file fail",e),t(!1)})},e=>{b.error("checkFileExistOrNot load file directory fail",e),t(!1)})},e=>{b.error("checkFileExistOrNot load file system fail",e),t(!1)})}),ie=(()=>{var e=S(function*(e,i,t,n,r,s=!1,c){let l="";switch(i){case g.a.musicOriginal.netEaseCloud:l=o.a.getNetEaseCloudMusicLinksByIds;break;case g.a.musicOriginal.qqMusic:l=o.a.getQQMusicLinksByIds;break;case g.a.musicOriginal.kuGouMusic:l=o.a.getKuGouMusicLinksByIds;break;case g.a.musicOriginal.kuWoMusic:l=o.a.getKuWoMusicLinksByIds}if(b.info("checkFilePath songOriginal, getFilePath",i,l),l){const o=yield axios.post(l,{ids:[t]}).catch(function(e){b.error("checkFilePath get music link fail"),Object(a.g)(e,`checkFilePath getFilePath: ${l} musicId: ${t}`)}),d=o&&o.data&&o.data.result&&o.data.result.response||{};b.info("checkFilePath axios getFilePath response",d),e=d.filePath;const f=JSON.parse(JSON.stringify(n));if(e){/http/.test(e)||(e=window.serverHost+e),b.info("checkFilePath filePath",e);for(let t of f)E(t.filenameOrigin)===E(r)&&(t.filePath=e,t.getNewestPath=!0,i===g.a.musicOriginal.netEaseCloud&&(t.fileSize=d.fileSize),i===g.a.musicOriginal.kuGouMusic&&(d.lyrics?(t.lyric=d.lyrics,$dispatch(Object(u.d)(d.lyrics))):(t.lyric="暂无歌词",$dispatch(Object(u.d)("暂无歌词")))));return e}if(b.warn("get no filePath songOriginal, musicId, response",i,t,d),!s){const{currentFileIndex:e,currentMusicFilenameOriginalArr:i}=G(r,f);b.error("checkFilePath 获取音乐链接超时,请尝试其他音乐"),void 0===window.musicPlayErrorTimes?(window.musicPlayErrorTimes=0,alert("获取音乐链接超时,请尝试其他音乐"),A(e,i,c,f,null)):window.musicPlayErrorTimes<=2&&(window.musicPlayErrorTime++,alert("获取音乐链接超时,请尝试其他音乐"),A(e,i,c,f,null))}return!1}return e});return function(i,t,n,o,r){return e.apply(this,arguments)}})(),te=e=>{if("string"!=typeof e)return"";let i=e.split(".");return 1!==i.length&&i.pop(),i.join("")},ne=()=>{$getState().fileServer.showMusicController&&$dispatch(Object(u.x)(!1))},oe=({musicDataList:e,filename:i,uploadUsername:t,fileSize:n,musicSrc:o,filenameOrigin:r,duration:s,songOriginal:c,musicId:l,payDownload:d})=>{if(!r)return;const{downloadingMusicItems:g,downloadedMusicList:f}=$getState().fileServer,{token:m}=$getState().login;let w=!1,p=!1;return d&&!$getState().myInfo.setMusicVip?alert("尊重版权,人人有责"):m?(r=E(r),window.isCordova&&g.some(e=>E(e.filenameOrigin)===r&&(w=!0,Object(a.d)("提示",`${i}正在下载`,"去查看",()=>{$dispatch(Object(u.y)(!1)),window.goRoute(null,"/my_finished_musics")}),!0)),f.some(e=>E(e.filenameOrigin)===r&&(p=!0,alertDialog(`${i}已下载`),!0)),w||p?void 0:Object(a.b)().then(u=>{if(!u)return alertDialog("请授予文件读写权限，否则不能下载音乐","","知道了",a.i);alert(`开始下载${i}`),Object(a.n)(i,"准备中",t,n,!0,o,r,!0,{duration:s}),Object(a.j)({filenameOrigin:r,fileUrl:o,folder:"music",filename:i,uploadUsername:t,needSaveToDownloadBox:!0,fileSize:n,fromMusic:!0,options:{duration:s,original:c,musicId:l,musicDataList:e}})})):window.goRoute(null,"/login")},re=e=>{let i=Math.floor(e/3600),t=Math.floor(e%3600/60),n=Math.ceil(e%3600%60);return(0==i?"":i>0&&i.toString().length<2?"0"+i+":":i+":")+(t.toString().length<2?"0"+t:t)+":"+(n.toString().length<2?"0"+n:n)},ae=(e,i,t,n)=>{const o={x:5,y:5,ox:0,oy:0,nx:0,ny:0};e.addEventListener("touchstart",ce.bind(void 0,o,i,t),!1),e.addEventListener("touchmove",le.bind(void 0,o,i,t,n),!1),e.addEventListener("touchend",function(e,i,t,n){Object(a.e)(()=>{const n=e.oy-e.ny,o=e.ox-e.nx,{isHeadPhoneView:r,isLyricView:a}=$getState().fileServer;Math.abs(o)>Math.abs(n)&&Math.abs(o)>e.x?o>0?(b.info("touchEnd left changeX",o,"direction",i),i.includes("swipeLeft")&&t(a?"right":r?"lyric":"left")):(b.info("touchEnd right changeX",o,"direction",i),i.includes("swipeRight")&&t(r?"right":a?"left":"lyric")):Math.abs(n)>Math.abs(o)&&Math.abs(n)>e.y?n>0?-1!=i.indexOf("swipeTop")&&t():-1!=i.indexOf("swipedown")&&t():-1!=i.indexOf("singleTap")&&t(),-1!=i.indexOf("touchend")&&t()},10,{})}.bind(void 0,o,i,t),!1)},se=e=>{e.removeEventListener("touchstart",ce,!1),e.removeEventListener("touchmove",le,!1)};function ce(e,i,t,n){e.ox=n.targetTouches[0].pageX,e.oy=n.targetTouches[0].pageY,e.nx=e.ox,e.ny=e.oy,b.info("touchStart defaults.ox",e.ox),-1!=i.indexOf("touchstart")&&t()}function le(e,i,t,n,o){Object(a.e)(()=>{o.preventDefault(),e.nx=o.targetTouches[0].pageX,e.ny=o.targetTouches[0].pageY,-1!=i.indexOf("touchmove")&&t(),b.info("touchMove defaults.nx",e.nx)},10,n)}const ue=(e={})=>{const{username:i}=$getState().login,{appVersion:t,currentLocation:n,allowOthersGetPosition:r,allowShareMyNickname:a,adPicSrc:s}=$getState().common,{musicCollection:c,playByOrder:l,pauseWhenOver:u}=$getState().fileServer,{isSignedUp:d,lastSignUpTime:g,onlinePersonsNum:f}=$getState().sign,m=O({userId:$getState().login.userId,url:window.getRoute(),username:i,appVersion:t,currentLocation:n,allowOthersGetPosition:r,allowShareMyNickname:a,adPicSrc:s,musicCollectionLength:c.length,playByOrder:l,pauseWhenOver:u,isSignedUp:d,lastSignUpTime:g,onlinePersonsNum:f},e);return axios.post(o.a.userActivity,m).then(()=>{b.info("logActivity success url",window.getRoute())}).catch(e=>{b.error("logActivity err",e),alertDebug("logActivity err")})},de=((()=>{var e=S(function*(e,i,t,n,o,r={}){const a=yield(e=>new Promise(i=>{window.resolveLocalFileSystemURL(window.cordova.file.externalApplicationStorageDirectory,function(t){t.getFile(e,{create:!1,exclusive:!0},function(e){i(!0)},function(e){i(!1)})})}))(i);ue({msg:"start to upgrade app"}),a?window.resolveLocalFileSystemURL(window.cordova.file.externalApplicationStorageDirectory,function(a){a.getFile(i,{create:!1,exclusive:!0},function(a){return new Promise(e=>de(a,t,null,e,!1,o)).then(s=>{b.info("checkDownloadedOrNot md5IsEqual",s),!1===s?n(e,i,t):"cancel"===s?r.forceUpgrade&&r.exit():s&&o(a,"application/vnd.android.package-archive")})},function(e){b.error("about checkDownloadedOrNot err",e)})}):n(e,i,t)})})(),(e,i,t,n,o,s)=>{md5chksum.file(e,function(c){b.info("about page app package MD5SUM: "+c),c===i?($dispatch(Object(r.d)(!1)),$dispatch(Object(r.i)(!0)),cordova.plugins.notification.local.schedule({title:"下载完成",text:"点击安装",progressBar:!1}),Object(a.d)("提示","下载完成","立即安装",function(){t&&t.file(i=>{s(e,i.type)}),ue({msg:"start to install app"}),n(!0)},()=>{n("cancel")})):(o&&(b.error("about page checkAppMD5 md5sum !== MD5 md5sum, MD5",c,i),$dispatch(Object(r.d)(!1)),$dispatch(Object(r.i)(!0)),alertDialog("提示","安装包已损坏，请重新安装")),n(!1))},function(e){o&&(b.error("about page checkAppMD5 fail Error-Message: ",e),$dispatch(Object(r.d)(!1)),$dispatch(Object(r.i)(!0)),alertDialog("提示","安装包已损坏，请重新安装"))})}),ge=()=>{const e=window.location.href.split("?").length>1&&decodeURIComponent(window.location.href.split("?").pop());if(e){const i=(e=>{const i={};return e&&e.split("&").forEach(e=>{const t=e.split("=");i[t[0]]=t[1]}),i})(e);return b.info("queryParams",i),i}return!1};let fe=(new Date).getTime();const me=(()=>{var e=S(function*(e,i,t,n,o,r,s,c){const{token:l}=$getState().login,{downloadingFileList:u,downloadedFileList:d}=$getState().fileServer;if(!l)return s.push("/login");if(!window.isCordova)return Object(a.j)({filenameOrigin:r,fileUrl:n,folder:"download",filename:e,uploadUsername:i,needSaveToDownloadBox:!0,fileSize:t,fromMusic:!1});if((new Date).getTime()-fe<300)return void(fe=(new Date).getTime());let g=!1;const f=r;return r=E(r),!o&&window.isCordova&&u.some(function(i){return E(i.filenameOrigin)===r&&(g=!0,Object(a.d)("提示",`${e}正在下载`,"去查看",function(){s.push("/my_finished_files")}),!0)}),d.some(function(i){return!(E(i.filenameOrigin)!==r||i.status&&"downloaded"!==i.status)&&(g=!0,c?c(e,f):alert("文件已下载"),!0)}),g?void 0:Object(a.b)().then(function(s){if(!s)return alertDialog("请授予文件读写权限，否则不能下载文件","","知道了",a.i);o?alert(`重新下载${e}`):alert(`开始下载${e}`),Object(a.n)(e,"准备中",i,t,!0,n,r,!1,{}),Object(a.j)({filenameOrigin:r,fileUrl:n,folder:"download",filename:e,uploadUsername:i,needSaveToDownloadBox:!0,fileSize:t,fromMusic:!1})})});return function(i,t,n,o,r,a,s,c){return e.apply(this,arguments)}})(),we=e=>e?e.replace(/\<span class="hight\-light\-keyword"\>/g,"").replace(/\<\/span\>/g,""):"",pe=(e,i,t,n)=>{localStorage.removeItem("lastPlaySongInfo"),localStorage.removeItem("lastPlaySongPageType"),localStorage.removeItem("lastPlaySongMusicDataList");const{soundPlaying:o}=$getState().fileServer,r=JSON.parse(JSON.stringify(i)),a=JSON.parse(JSON.stringify(n));r.splice(e,1),a.splice(e,1),r.length&&o?o&&A(e-1,r,t,a,null):V()}},181:function(e,i,t){"use strict";let n;t.d(i,"a",function(){return r}),t.d(i,"b",function(){return a}),t.d(i,"c",function(){return s});const o=window.indexedDB.open("file",1);o.onerror=function(e){logger.error("file数据库打开报错")},o.onsuccess=function(e){n=o.result,logger.info("file数据库打开成功")},o.onupgradeneeded=function(e){(n=e.target.result).createObjectStore("file",{keyPath:"filenameOrigin"})};const r=e=>"[object Object]"!==Object.prototype.toString.call(e)?Promise.reject("error_data_type"):new Promise((i,t)=>{const o=n.transaction(["file"],"readwrite").objectStore("file").add(e);o.onsuccess=function(e){i("success"),logger.info("file 数据写入成功")},o.onerror=function(e){t(e),logger.warn("file 数据写入失败")}}),a=()=>{const e=[];return new Promise((i,t)=>{n.transaction("file").objectStore("file").openCursor().onsuccess=function(t){const n=t.target.result;n?(e.push(n.value),n.continue()):i(e)}})},s=e=>new Promise((i,t)=>{const o=n.transaction(["file"],"readwrite").objectStore("file").delete(e);o.onsuccess=function(e){const t=e.target.result;logger.info("file 数据移除成功",t),i(t||"success")},o.onerror=function(e){logger.error("file 数据移除失败"),t(e)}})},182:function(e,i,t){"use strict";let n;t.d(i,"a",function(){return r}),t.d(i,"b",function(){return a});const o=window.indexedDB.open("music",1);o.onerror=function(e){logger.error("music 数据库打开报错")},o.onsuccess=function(e){n=o.result,logger.info("music 数据库打开成功")},o.onupgradeneeded=function(e){(n=e.target.result).createObjectStore("music",{keyPath:"filenameOrigin"})};const r=e=>"[object Object]"!==Object.prototype.toString.call(e)?Promise.reject("error_data_type"):new Promise((i,t)=>{const o=n.transaction(["music"],"readwrite").objectStore("music").add(e);o.onsuccess=function(e){i("success"),logger.info("music 数据写入成功")},o.onerror=function(e){t(e),logger.warn("music 数据写入失败")}}),a=e=>new Promise((i,t)=>{const o=n.transaction(["music"],"readwrite").objectStore("music").delete(e);o.onsuccess=function(e){const t=e.target.result;logger.info("music 数据移除成功",t),i(t||"success")},o.onerror=function(e){logger.error("music 数据移除失败"),t(e)}})},93:function(e,i,t){"use strict";t.d(i,"a",function(){return n});const n={statusBarColor:"#81AFED",toastLoadingTime:900,toastTime:1,strokeDashoffset:314,musicOriginal:{netEaseCloud:"netEaseCloud",qqMusic:"qqMusic",kuGouMusic:"kuGouMusic",kuWoMusic:"kuWoMusic",musicSearch:"musicSearch",musicShare:"musicShare",savedSongs:"savedSongs",window:"window",musicFinished:"musicFinished",musicDownloading:"musicDownloading",musicRecent:"musicRecent"},showMusicNumberPerTime:40,showFileNumberPerTime:40,appDownloadUrl:"https://api.zhoushoujian.com/apk/app_release.apk",appStaticDirectory:"http://www.zhoushoujian.com/mixingfeng/share/",downloadAppFromPage:"downloadAppFromPage",appName:"miXingFeng.apk"}},94:function(e,i,t){"use strict";t.d(i,"d",function(){return O}),t.d(i,"g",function(){return y}),t.d(i,"m",function(){return j}),t.d(i,"j",function(){return k}),t.d(i,"n",function(){return P}),t.d(i,"e",function(){return _}),t.d(i,"b",function(){return I}),t.d(i,"i",function(){return F}),t.d(i,"a",function(){return M}),t.d(i,"f",function(){return T}),t.d(i,"h",function(){return N}),t.d(i,"k",function(){return x}),t.d(i,"l",function(){return D}),t.d(i,"c",function(){return E});t(122);var n=t(123),o=t.n(n),r=(t(250),t(251)),a=t.n(r),s=t(255),c=t.n(s),l=t(21),u=t(93),d=t(103),g=t(19),f=t(115),m=t(181),w=t(182);function p(e){return function(){var i=e.apply(this,arguments);return new Promise(function(e,t){return function n(o,r){try{var a=i[o](r),s=a.value}catch(e){return void t(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}const h=(e,i,t="确定",n)=>{a.a.alert(e,i,[{text:t,onPress:()=>{window.logger.info("alertDialog confirm enter title, text",e,i),n instanceof Function&&n()}}])},O=function(e,i,t="确定",n,o=!1){a.a.alert(e,i,[{text:"取消",onPress:()=>{window.logger.info("confirm cancel title, text",e,i),o&&o()}},{text:t,onPress:()=>(window.logger.info("confirm enter title, text",e,i),new Promise(e=>e(n())))}])},y=function(e,i){if(logger.error("networkErr window.getRoute()",window.getRoute()),i&&logger.error("networkErr originTip",i),void 0===e){if(logger.warn("network err 请检查网络连接"),window.showToastFail)return;window.showToastFail=!0,setTimeout(()=>{window.showToastFail=!1},1e3),o.a.fail("请检查网络连接",u.a.toastTime)}else"[object Error]"===Object.prototype.toString.call(e)?(alertDebug("[object Error]: 请检查网络连接: "+e.stack||!1),logger.warn("networkErr",e.stack||e.toString())):"[object Object]"===Object.prototype.toString.call(e)?(alertDebug("[object Object]: 请检查网络连接: "+e),logger.warn("networkErr",e)):(alertDebug("请检查网络连接: "+JSON.stringify(e)),logger.warn("networkErr",e))},S=((()=>{var e=p(function*(e="sign.txt",i){let t=yield S(e,!0);return new Promise(function(e){i?t&&t.token?(window.logger.info("含有token"),e(!1)):(window.logger.info("不含有token"),e(!0)):t.length?(window.logger.info("含有内容"),e(!1)):(window.logger.info("没有内容"),e(!0))})})})(),(()=>{var e=p(function*(e,i=!0){return new Promise(function(t){window.resolveLocalFileSystemURL(window.cordova.file.externalApplicationStorageDirectory,function(n){n.getFile(e,{create:!0,exclusive:!1},function(e){e.file(function(e){var n=new FileReader;n.onloadend=function(){if(this.result){if(i)var e=(new window.Base64).decode(this.result);else e=this.result;try{var n=JSON.parse(e);t(n)}catch(e){window.logger.error("getAndReadFile, 解析文件内容是出错",e.stack||e.message||e.toString()),t()}}else t()},n.readAsText(e)},$)},b)},v)}).catch(function(e){window.logger.error("读取文件的内容发生了错误",e)})});return function(i){return e.apply(this,arguments)}})());(()=>{var e=p(function*(e="sign.txt",i){let t=yield S(e,!0);return new Promise(function(e){t?(window.$dispatch(Object(l.h)(t.token)),i||window.logger.info("has login")):window.logger.info("never login"),e()}).catch(function(e){window.logger.error("解析上次登录文件时出现错误",e.stack||e.toString())})})})();function b(e){window.logger.error("文件创建失败！",e)}function v(e){window.logger.error("文件系统加载失败！",e)}function $(e){window.logger.error("读取错误!:",e)}const j=()=>{window.specialBack=!0},k=(()=>{var e=p(function*({filenameOrigin:e,fileUrl:i,folder:t,filename:n,uploadUsername:o,needSaveToDownloadBox:r=!1,fileSize:a,fromMusic:s,options:c={}}){if(!e)return;if(logger.info("saveFileToLocal fileUrl, filenameOrigin",i,e),!window.isCordova)return t===u.a.downloadAppFromPage&&Object(f.h)({msg:e}),s&&!i&&(i=yield Object(f.b)(i,c.original,c.musicId,c.musicDataList,e,!1,$getState().fileServer.currentPlayingSongOriginal)),void window.open(i);const l=new FileTransfer;let d=0,O=null,y=!0,S=!1;return r&&window.eventEmit.$on(`FileTransfer-${e}`,function(e,i){logger.info("saveFileToLocal FileTransfer type",e,"param",i),"abort"===e&&(logger.info("saveFileToLocal cancel download"),S=!0,l.abort()),i&&setTimeout(function(){const{downloadingFileList:e,downloadingMusicItems:t}=$getState().fileServer;if("file"===i[0]){const t=JSON.parse(JSON.stringify(e));for(let n in e)if(t[n].filenameOrigin===i[1]){t.splice(n,1),$dispatch(Object(g.k)(t)),Object(m.c)(i[1]);break}}else if("music"===i[0]){const e=JSON.parse(JSON.stringify(t));for(let n in t)if(t[n].filenameOrigin===i[1]){e.splice(n,1),$dispatch(Object(g.l)(e)),Object(w.b)(i[1]);break}}logger.info("saveFileToLocal param, downloadingMusicItems, downloadingFileList",i,t,e)},1100)}),s&&!(i=yield Object(f.b)(i,c.original,c.musicId,c.musicDataList,e,!1,$getState().fileServer.currentPlayingSongOriginal))?(logger.error("saveFileToLocal fromMusic 音乐链接获取失败"),h("音乐链接获取失败")):new Promise(function(u){logger.info("saveFileToLocal prepare to download filenameOrigin",e);let h=a;window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,function(b){b.root.getDirectory("miXingFeng",{create:!0},function(b){b.getDirectory(t,{create:!0},function(b){b.getFile(e,{create:!0,exclusive:!1},function(b){l.onprogress=(()=>{var t=p(function*(t){if(n&&t.lengthComputable){const l=t.loaded/t.total;if(d=(100*l).toFixed(0),O)return;if(y){logger.info("saveFileToLocal start to download onprogress firstTime filenameOrigin",e),y=!1,h=a&&"未知"!==a?a:t.total;const{username:l}=$getState().login,u=`downloading_${e}`,d={filename:n,username:l,fileSize:h,uploadUsername:o,date:Date.now(),filenameOrigin:u,status:"downloading",progress:"已取消",filePath:i};s?(d.isMusic=!0,d.duration=c.duration,d.id=c.fileId||"downloading",d.original=c.original,Object(w.a)(d)):Object(m.a)(d),P(n,`${Object(f.a)(t.loaded)}/${Object(f.a)(t.total)}`,o,t.total,r,i,e,s,c)}else O=setTimeout(function(){clearTimeout(O),P(n,`${Object(f.a)(t.loaded)}/${Object(f.a)(t.total)}`,o,t.total,r,i,e,s,c),O=null},1e3)}});return function(e){return t.apply(this,arguments)}})(),l.download(encodeURI(i),b.nativeURL,(()=>{var a=p(function*(a){if(logger.info("saveFileToLocal filename",n,"fileUrl",i,"folder",t),!n)return u();if(d>=1){if(logger.info("saveFileToLocal download complete wait for next to success filenameOrigin",e),window.eventEmit.$off(`FileTransfer-${e}`),r){const{username:t}=$getState().login,r=`downloading_${e}`,a=`downloaded_${e}`,l={filename:n,username:t,fileSize:h,uploadUsername:o,date:Date.now(),filenameOrigin:a,status:"downloaded"};let u=Promise.resolve();s?(l.isMusic=!0,l.filePath=`cdvfile://localhost/sdcard/miXingFeng/music/${a}`,l.fileUrl=i,l.duration=c.duration,l.id=c.fileId||"downloaded",l.original=c.original,yield Object(w.b)(r),u=Object(w.a)(l)):(yield Object(m.c)(r),u=Object(m.a)(l)),u.then(function(){setTimeout(function(){alert(`${n}下载完成`);const{downloadingFileList:i,downloadingMusicItems:t,fileList:o,downloadedMusicList:r,downloadedFileList:a}=$getState().fileServer;if(s){const i=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(t));i.push(l),$dispatch(Object(g.j)(i));for(let i in t)t[i].filenameOrigin===`downloading_${e}`&&(n.splice(i,1),logger.info("downloadingMusicItems 下载完成"),$dispatch(Object(g.l)(n)))}else{const t=JSON.parse(JSON.stringify(o)),n=JSON.parse(JSON.stringify(a)),r=JSON.parse(JSON.stringify(i));t.forEach(function(i){i.filenameOrigin===e&&(i.downloaded=!0)}),$dispatch(Object(g.m)(t)),n.push(l),$dispatch(Object(g.i)(n));for(let t in i)if(i[t].filenameOrigin===`downloading_${e}`){r.splice(t,1),logger.info("downloadingFileList 下载完成",r),$dispatch(Object(g.k)(r));break}}logger.info("saveFileToLocal download complete success filenameOrigin",e)},1010)}).catch(function(e){logger.error("download fail",e),alert("下载失败")})}u()}});return function(e){return a.apply(this,arguments)}})(),function(t){setTimeout(()=>{if(S)window.logger.info("error callback cancel download"),logger.info("saveFileToLocal download 已取消 filenameOrigin",e),P(n,"已取消",o,h,r,i,e,s,c);else{if(window.logger.error("下载失败",t,"fileUrl",i),"Not Found"===t.body)return window.logger.error("saveFileToLocal download 文件已删除 filenameOrigin",e),void alert("文件已删除");alert(`${n}下载失败`),window.logger.error("saveFileToLocal download 下载失败 filenameOrigin",e),P(n,"失败",o,h,r,i,e,s,c)}},1010),u()})},function(e){window.logger.error("saveFileToLocal 获取文件失败",e.stack||e.toString()),u()})},function(e){alert("文件系统加载失败！"),window.logger.error("saveFileToLocal 文件系统加载失败！",e)})})})})});return function(i){return e.apply(this,arguments)}})(),P=(e,i,t,n,o,r,a,s,c)=>{if(!o)return;const{downloadingFileList:l,downloadingMusicItems:u}=$getState().fileServer,d={filename:e,progress:i,uploadUsername:t,filePath:r,fileSize:n,filenameOrigin:a=`downloading_${a}`};if(s){d.duration=c.duration;const e=JSON.parse(JSON.stringify(u));for(let t in e)if(e[t].filenameOrigin===a)return e[t].progress=i,void $dispatch(Object(g.l)(e));e.push(d),$dispatch(Object(g.l)(e))}else{const e=JSON.parse(JSON.stringify(l));for(let t in e)if(e[t].filenameOrigin===a)return e[t].progress=i,void $dispatch(Object(g.k)(e));e.push(d),$dispatch(Object(g.k)(e))}logger.info("updateDownloadingStatus fromMusic, obj",s,d)},_=(e,i,t={})=>{t.debounceTimer?(clearTimeout(t.debounceTimer),t.debounceTimer=setTimeout(()=>{e.apply(void 0,t.params),t.debounceTimer=null},i)):t.firstTimeRun?(t.firstTimeRun=!1,e.apply(context,t.params)):t.debounceTimer=setTimeout(()=>{e.apply(void 0,t.params),t.debounceTimer=null},i)},I=()=>new Promise(e=>{window.isCordova?window.permissions.checkPermission(permissions.WRITE_EXTERNAL_STORAGE,function(i){i.hasPermission?e(!0):(logger.info("saveFileToLocal WRITE_EXTERNAL_STORAGE",i),e(!1))}):e(!0)}),F=()=>new Promise(e=>{window.isCordova?window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,function(i){i.root.getDirectory("miXingFeng",{create:!0},function(i){i.getDirectory("tmp",{create:!0},function(i){i.getFile("tmp",{create:!0,exclusive:!1},function(i){localStorage.getItem("allowReadAndWriteFile")||(localStorage.setItem("allowReadAndWriteFile","yes"),window.logger=new c.a({folder:"miXingFeng",column:"log",filename:"miXingFeng.txt"})),e(i)},function(i){logger.error("requestFileWritePriority error",i),e(i)})})})}):e(!1)}),M=()=>{const e=navigator.userAgent,i=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let t=!0;for(let n=0;n<i.length;n++)if(e.indexOf(i[n])>0){t=!1;break}return t},T=()=>"ls"+Math.random().toString(36).slice(2,6),N=(e,i="logInfo")=>axios.post(d.a.replaceSocketLink,e).then(e=>{"success"===e.data.result.response?(logger.info("replaceSocketLink success",i),Object(f.n)()):logger.warn("replaceSocketLink fail",i)}).catch(e=>{logger.warn("replaceSocketLink err",i,e)}),L=()=>new Promise(e=>{Wechat.isInstalled(function(i){e(!0)},function(i){h("未安装微信"),e(!1),logger.warn("Wechat.isInstalled","Failed: "+i)})}),x=({title:e="这是分享的标题",description:i="这是分享的描述",thumb:t="www/assets/imgs/logo.png",webpageUrl:n=u.a.appStaticDirectory,scene:o=Wechat.Scene.SESSION})=>L().then(r=>r?new Promise(r=>{Wechat.share({message:{title:e,description:i,thumb:t,media:{type:Wechat.Type.WEBPAGE,webpageUrl:n}},scene:o},function(){Object(f.h)({msg:"shareLinkToWeChat",LinkTitle:e,scene:o}),r("success")},function(e){r("fail"),logger.error("shareLinkToWeChat","Failed: "+e)})}):r),D=({title:e="这是分享的标题",description:i="这是分享的描述",thumb:t="www/assets/imgs/logo.png",videoUrl:n=u.a.appStaticDirectory})=>L().then(o=>o?new Promise(o=>{Wechat.share({message:{title:e,description:i,thumb:t,media:{type:Wechat.Type.VIDEO,videoUrl:n}},scene:Wechat.Scene.SESSION},function(){Object(f.h)({msg:"shareVideoToWeChat",videoTitle:e}),o("success")},function(e){o("fail"),logger.error("shareVideoToWeChat Failed: "+e)})}):o),E=()=>navigator.userAgent.toLowerCase().includes("micromessenger")}}]);