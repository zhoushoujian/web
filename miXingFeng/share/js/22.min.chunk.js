(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{219:function(e,t,a){"use strict";a(70),a(214),a(187)},220:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(a(21)),n=p(a(12)),r=p(a(24)),s=m(a(0)),l=m(a(18)),c=p(a(105)),o=p(a(102)),u=p(a(221)),d=p(a(215));function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}var g="NORMAL",f="SHARE";function v(){}var O=[];function b(e,t,a){var m=(0,n.default)({prefixCls:"am-action-sheet",cancelButtonText:"取消"},t),p=m.prefixCls,v=m.className,b=m.transitionName,h=m.maskTransitionName,y=m.maskClosable,w=void 0===y||y,M=document.createElement("div");function j(){if(M){l.unmountComponentAtNode(M),M.parentNode&&M.parentNode.removeChild(M);var e=O.indexOf(j);-1!==e&&O.splice(e,1)}}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=a(e,t);i&&i.then?i.then(function(){j()}):j()}document.body.appendChild(M),O.push(j);var N=m.title,S=m.message,x=m.options,$=m.destructiveButtonIndex,P=m.cancelButtonIndex,k=m.cancelButtonText,D=m.badges,T=void 0===D?[]:D,L=[N?s.createElement("h3",{key:"0",className:p+"-title"},N):null,S?s.createElement("div",{key:"1",className:p+"-message"},S):null],C=null,F="normal";switch(e){case g:F="normal";var I=x,R={};T&&T.length>0&&T.forEach(function(e){e.index>=0&&(R[e.index]=s.createElement(d.default,e))}),C=s.createElement("div",(0,u.default)(m),L,s.createElement("div",{className:p+"-button-list",role:"group"},I.map(function(e,t){var a,l={className:(0,r.default)(p+"-button-list-item",(a={},(0,i.default)(a,p+"-destructive-button",$===t),(0,i.default)(a,p+"-cancel-button",P===t),a)),onClick:function(){return E(t)},role:"button"},c=s.createElement("div",l,e);R[t]&&(c=s.createElement("div",(0,n.default)({},l,{className:l.className+" "+p+"-button-list-badge"}),s.createElement("span",{className:p+"-button-list-item-content"},e),R[t]));var u=s.createElement(o.default,{key:t,activeClassName:p+"-button-list-item-active"},c);return P!==t&&$!==t||(u=s.createElement(o.default,{key:t,activeClassName:p+"-button-list-item-active"},s.createElement("div",l,e,P===t?s.createElement("span",{className:p+"-cancel-button-mask"}):null))),u})));break;case f:F="share";var A=x.length&&Array.isArray(x[0])||!1,_=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return s.createElement("div",{className:p+"-share-list-item",role:"button",key:t,onClick:function(){return E(t,a)}},s.createElement("div",{className:p+"-share-list-item-icon"},e.icon),s.createElement("div",{className:p+"-share-list-item-title"},e.title))};C=s.createElement("div",(0,u.default)(m),L,s.createElement("div",{className:p+"-share"},A?x.map(function(e,t){return s.createElement("div",{key:t,className:p+"-share-list"},e.map(function(e,a){return _(e,a,t)}))}):s.createElement("div",{className:p+"-share-list"},x.map(function(e,t){return _(e,t)})),s.createElement(o.default,{activeClassName:p+"-share-cancel-button-active"},s.createElement("div",{className:p+"-share-cancel-button",role:"button",onClick:function(){return E(-1)}},k))))}var U=(0,r.default)(p+"-"+F,v);return l.render(s.createElement(c.default,{visible:!0,title:"",footer:"",prefixCls:p,className:U,transitionName:b||"am-slide-up",maskTransitionName:h||"am-fade",onClose:function(){return E(P||-1)},maskClosable:w,wrapProps:m.wrapProps||{}},C),M),{close:j}}t.default={showActionSheetWithOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;b(g,e,t)},showShareActionSheetWithOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;b(f,e,t)},close:function(){O.forEach(function(e){return e()})}},e.exports=t.default},222:function(e,t,a){"use strict";a(70),a(188)},223:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(a(12)),n=d(a(21)),r=d(a(14)),s=d(a(15)),l=d(a(13)),c=d(a(16)),o=d(a(24)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(0));function d(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){return(0,r.default)(this,t),(0,l.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,s.default)(t,[{key:"componentWillReceiveProps",value:function(){this.noAppearTransition=!0}},{key:"componentDidMount",value:function(){var e=this;this.props.appearTransition&&setTimeout(function(){e.barRef&&(e.barRef.style.width=e.props.percent+"%")},10)}},{key:"render",value:function(){var e,t=this,a=this.props,r=a.className,s=a.prefixCls,l=a.position,c=a.unfilled,d=a.style,m=void 0===d?{}:d,p=a.barStyle,g=void 0===p?{}:p,f={width:this.noAppearTransition||!this.props.appearTransition?this.props.percent+"%":0,height:0},v=(0,o.default)(s+"-outer",r,(e={},(0,n.default)(e,s+"-fixed-outer","fixed"===l),(0,n.default)(e,s+"-hide-outer",!c),e));return u.createElement("div",{style:m,className:v,role:"progressbar","aria-valuenow":this.props.percent,"aria-valuemin":0,"aria-valuemax":100},u.createElement("div",{ref:function(e){return t.barRef=e},className:s+"-bar",style:(0,i.default)({},g,f)}))}}]),t}(u.Component);t.default=m,m.defaultProps={prefixCls:"am-progress",percent:0,position:"fixed",unfilled:!0,appearTransition:!1},e.exports=t.default},228:function(e,t,a){"use strict";a(222);var i=a(223),n=a.n(i),r=(a(219),a(220)),s=a.n(r),l=a(0),c=a.n(l),o=a(71),u=a(3),d=a(73),m=a(10),p=a(234),g=a(51),f=a(1),v=a(4),O=a(11),b=a(8),h=a(6),y=a(33),w=a(23);let M;new RegExp("\\biPhone\\b|\\biPod\\b","i").test(navigator.userAgent)&&(M={onTouchStart:e=>e.preventDefault()});t.a=Object(o.connect)(e=>({soundPlaying:e.fileServer.soundPlaying,soundInstance:e.fileServer.soundInstance,currentPlayingSong:e.fileServer.currentPlayingSong,currentSongTime:e.fileServer.currentSongTime,pauseWhenOver:e.fileServer.pauseWhenOver,playByOrder:e.fileServer.playByOrder,musicCollection:e.fileServer.musicCollection,musicMenuBadge:e.fileServer.musicMenuBadge,username:e.login.username,token:e.login.token,playByRandom:e.fileServer.playByRandom,lastMusicSearchResult:e.fileServer.lastMusicSearchResult,lastSearchAllMusicResult:e.fileServer.lastSearchAllMusicResult,downloadingMusicItems:e.fileServer.downloadingMusicItems,downloadedMusicList:e.fileServer.downloadedMusicList,currentPlayingSongOriginal:e.fileServer.currentPlayingSongOriginal,recentMusicList:e.fileServer.recentMusicList,musicPageType:e.fileServer.musicPageType,setMobile:e.myInfo.setMobile,showMusicPlayingFromMusicControl:e.fileServer.showMusicPlayingFromMusicControl,notExistMusicPlayingPage:e.fileServer.notExistMusicPlayingPage}),()=>({}))(({original:e,soundInstance:t,currentPlayingSong:a,currentSongTime:i,soundPlaying:r,pageType:o,pauseWhenOver:j,playByOrder:E,musicCollection:N=[],musicMenuBadge:S,username:x,token:$,playByRandom:P,setMobile:k,musicDataList:D,lastMusicSearchResult:T,lastSearchAllMusicResult:L,recentMusicList:C,noShowMusicPlaying:F=!1,myMusicPage:I=!1,searchMusicPage:R=!1,notExistMusicPlayingPage:A=!1,showBottomLine:_=!1,musicPlayerRef:U,loadingRecommendSongs:B=!1})=>{const J=Object(u.useHistory)(),[W,q]=Object(l.useState)(!0);Object(l.useEffect)(()=>(d.Howler.volume(.8),e!==h.a.musicOriginal.musicDownloading&&t&&Object(b.v)(),document.addEventListener("deviceready",z,!1),()=>{document.removeEventListener("deviceready",z,!1),document.removeEventListener("backbutton",H,!1)}),[]);const z=()=>{document.addEventListener("backbutton",H,!1)},H=()=>{if(!window.cancelMenuFirst&&!window.specialBack)if($getState().fileServer.showMusicPlayingFromMusicControl||Object(v.h)())Object(v.y)();else if(I)Object(v.b)("/my_download_middle_page",!0);else{if(!R)return;Object(v.b)("/search_column",!0)}},V=()=>{window.cancelMenuFirst=!0,document.addEventListener("backbutton",G)},X=()=>{window.cancelMenuFirst&&(window.cancelMenuFirst=!1,document.removeEventListener("backbutton",G),document.removeEventListener("deviceready",V),document.addEventListener("backbutton",v.r))},G=()=>{const e=document.querySelector(".am-action-sheet-button-list div:nth-last-child(1)");e&&e.click()},Y=(e,t,a,i,n,r,s)=>{Object(v.j)("提示",c.a.createElement(g.a,{textFragment:`确定从本地删除 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>Object(b.M)(Object(b.N)(t),"music").then(()=>{K(r,t),t===a&&Object(b.r)(i,n,r,s)}).catch(e=>{logger.error("删除音乐过程中发生了错误 isFileFinished",e.stack||e.toString()),Object(v.q)(e,`musicPlayer removeFileFromDownload filenameOrigin: ${t}`)}))},K=(e,t)=>{if(e===h.a.musicOriginal.musicSearch){let e,a;T.some((a,i)=>Object(b.N)(a.filenameOrigin)===Object(b.N)(t)&&(e=i,!0));const i=JSON.parse(JSON.stringify(T));i.splice(e,1),L.some((e,i)=>Object(b.N)(e.filenameOrigin)===Object(b.N)(t)&&(a=i,!0));const n=JSON.parse(JSON.stringify(L));n.splice(a,1),$dispatch(Object(f.w)(i)),$dispatch(Object(f.E)(n))}},Z=Object(b.D)(D,W,h.a.showMusicNumberPerTime,q);Object(b.o)(Z,o);const Q=e===h.a.musicOriginal.musicDownloading;return c.a.createElement(l.Fragment,null,c.a.createElement("div",{className:"music-list-container",ref:U},Z.map((l,u)=>c.a.createElement("div",{className:"music-list",key:l.filenameOrigin,id:l.filenameOrigin.split(".")[0].match(/\w/g).join("")},c.a.createElement("div",{className:"music-content",onClick:()=>Object(b.p)({filePath:l.filePath,filename:l.filename,filenameOrigin:l.filenameOrigin,uploadUsername:l.uploadUsername,fileSize:l.fileSize,duration:l.duration,songOriginal:l.original,original:e,musicDataList:D,pageType:o,payPlay:Number(l.payPlay),musicId:l.id,songInfo:l})},c.a.createElement("div",{className:`num ${Object(v.d)(u+1)}`},u+1),c.a.createElement("div",{className:"music-info"},c.a.createElement("div",{className:`info ${l.saved&&o!==h.a.musicOriginal.savedSongs?"song-saved":""}`},c.a.createElement("div",{className:`filename ${Q?l.saved?"downloading-save":"downloading":""}`,dangerouslySetInnerHTML:{__html:Object(b.t)(l.filename)}}),Number(l.payPlay)?c.a.createElement("i",{className:"fa fa-lock copyright-song-flag","aria-hidden":"true"}):"",l.saved&&o!==h.a.musicOriginal.savedSongs&&c.a.createElement("i",{className:"fa fa-heart saved-song-flag","aria-hidden":"true"}),(e===h.a.musicOriginal.savedSongs||e===h.a.musicOriginal.musicFinished||e===h.a.musicOriginal.musicRecent||e===h.a.musicOriginal.musicDownloading)&&(l.original===h.a.musicOriginal.netEaseCloud?c.a.createElement("div",{className:"net-ease-source-flag"},"网易云"):l.original===h.a.musicOriginal.qqMusic?c.a.createElement("div",{className:"qq-music-source-flag"},"QQ音乐"):l.original===h.a.musicOriginal.kuGouMusic?c.a.createElement("div",{className:"ku-gou-music-source-flag"},"酷狗音乐"):l.original===h.a.musicOriginal.kuWoMusic?c.a.createElement("div",{className:"ku-wo-music-source-flag"},"酷我音乐"):null),l.mvId?c.a.createElement("i",{className:"fa fa-youtube-play","aria-hidden":"true",onClick:e=>((e,t,a,i)=>{e.stopPropagation(),J.push({pathname:"/music_mv_Player",query:{mvId:t,original:a,filename:Object(b.O)(i),lastLocation:getRoute()}})})(e,l.mvId,l.original,l.filename)}):null,Q?c.a.createElement("div",{className:"song-duration-time downloading"},l.progress):null),a===l.filenameOrigin?((e,t,a)=>c.a.createElement("div",{className:"audio-player"},c.a.createElement("audio",{preload:"auto",className:"audio-selector"},c.a.createElement("source",{src:e})),c.a.createElement("div",{className:"audio-player-time audio-player-time-current"},Object(b.X)(t)),c.a.createElement("div",{className:"audio-player-bar"},c.a.createElement("div",{className:"audio-player-bar-loaded",style:{width:"100%"}}),c.a.createElement("div",{className:"audio-player-bar-played",style:{width:t/a*100+"%"}})),c.a.createElement("div",{className:"audio-player-time audio-player-time-duration"},Object(b.X)(a))))(l.filePath,i,l.duration):c.a.createElement("div",{className:"upload-duration"},c.a.createElement("div",{className:`upload-user ${Q?"downloading":""}`},l.uploadUsername||"未知",(t=>t?e!==h.a.musicOriginal.musicDownloading?("number"==typeof t&&(t=new Date(t).format("yyyy-MM-dd")),e===h.a.musicOriginal.musicShare||e===h.a.musicOriginal.musicSearch||e===h.a.musicOriginal.musicFinished?" "+t.split(" ")[0]:""):void 0:"")(l.date)),Q?c.a.createElement("div",{className:"download-progress"},c.a.createElement(n.a,{percent:l.received?l.received/l.fileSize*100:0,position:"normal"})):c.a.createElement("div",{className:`song-duration-time ${Object(v.d)(u+1)}`},Object(b.X)(l.duration)))),!r&&e!==h.a.musicOriginal.musicDownloading&&a===l.filenameOrigin&&c.a.createElement("div",{className:"pause-button-overlay"},c.a.createElement("div",{className:"pause-button"},c.a.createElement("div",{className:"triangle"})))),e!==h.a.musicOriginal.musicDownloading?c.a.createElement("div",{className:"menu",onClick:((i,n,l,u,d,p,w,T,L,F,I,R)=>{document.removeEventListener("backbutton",v.r,!1),document.addEventListener("deviceready",V),i=Object(b.O)(i);const A=JSON.parse(JSON.stringify(S)),_=N.map(e=>Object(b.N)(e.filenameOrigin)),U=["播放",-1!==_.indexOf(Object(b.N)(l))?"已收藏":"收藏","单曲播放","单曲循环","顺序播放","随机播放","下载","删除","取消"];r&&l===a&&(U[0]="暂停"),F=e===h.a.musicOriginal.musicShare||e===h.a.musicOriginal.musicSearch?` ${F}`:"";const B={options:U,cancelButtonIndex:U.length-1,destructiveButtonIndex:U.length-2,badges:A,message:n?`大小: ${Object(b.c)(n)}${F}`:F,title:i,maskClosable:!0,"data-seed":"logId",wrapProps:M};e===h.a.musicOriginal.musicFinished?(U.splice(6,1),B.destructiveButtonIndex=U.length-2):(T&&A.push({index:6,text:"版"}),o!==h.a.musicOriginal.savedSongs&&"onlineMusic"!==o&&"onlineMusicSearchALl"!==o&&o!==h.a.musicOriginal.homeRecommend||(U.splice(7,1),delete B.destructiveButtonIndex)),s.a.showActionSheetWithOptions(B,r=>{logger.info("music player showMenu buttonIndex",r);const s=D.map(e=>e.filenameOrigin),M=s.indexOf(l);if(-1===M)return logger.error("showActionSheetWithOptions currentFileIndex === -1 filename",i),alert(i+"已被删除");const S=D[M].filePath;switch(r){case 0:Object(b.p)({filePath:S,filename:i,filenameOrigin:l,uploadUsername:u,fileSize:n,duration:d,songOriginal:p,original:e,musicDataList:D,pageType:o,payPlay:w,musicId:L,songInfo:R});break;case 1:Object(b.V)({savedMusicFilenameOriginalArr:_,filenameOrigin:l,musicCollection:N,musicDataList:D,currentFileIndex:M,original:e,e:null,pageType:o});break;case 2:(!j||E||P)&&(t&&t.loop(!1),$dispatch(Object(f.Y)(!0)),$dispatch(Object(f.Z)(!1)),$dispatch(Object(f.ab)(!1)),alert("单曲播放"),$dispatch(Object(f.K)([{index:2,text:"✔️"},{index:3,text:""},{index:4,text:""},{index:5,text:""}])));break;case 3:j&&(t&&t.loop(!0),$dispatch(Object(f.Y)(!1)),$dispatch(Object(f.Z)(!1)),$dispatch(Object(f.ab)(!1)),alert("单曲循环"),$dispatch(Object(f.K)([{index:2,text:""},{index:3,text:"✔️"},{index:4,text:""},{index:5,text:""}])));break;case 4:E||(t&&t.loop(!1),$dispatch(Object(f.Y)(!0)),$dispatch(Object(f.Z)(!0)),$dispatch(Object(f.ab)(!1)),alert("顺序播放"),$dispatch(Object(f.K)([{index:2,text:""},{index:3,text:""},{index:4,text:"✔️"},{index:5,text:""}])));break;case 5:P||(t&&t.loop(!1),$dispatch(Object(f.Y)(!0)),$dispatch(Object(f.Z)(!1)),$dispatch(Object(f.ab)(!0)),alert("随机播放"),$dispatch(Object(f.K)([{index:2,text:""},{index:3,text:""},{index:4,text:""},{index:5,text:"✔️"}])));break;case 6:if(e===h.a.musicOriginal.musicFinished)Y(i,l,a,M,s,e,D);else{const e=S;Object(b.U)({musicDataList:D,filename:i,uploadUsername:u,fileSize:n,musicSrc:e,filenameOrigin:l,duration:d,songOriginal:p,musicId:L,payDownload:T,mvId:R.mvId})}break;case 7:{if(X(),o===h.a.musicOriginal.savedSongs||"onlineMusic"===o||"onlineMusicSearchALl"===o||e===h.a.musicOriginal.musicFinished)return;if(!$)return goRoute(void 0,"/login");const t={username:x||k,token:$,filename:i,type:"default-music"};return void(e!==h.a.musicOriginal.musicShare&&e!==h.a.musicOriginal.musicSearch||"downloaded"===I?e===h.a.musicOriginal.musicRecent?Object(v.j)("提示",c.a.createElement(g.a,{textFragment:`确定要删除 <span class="delete-alert">${i}</span> 的播放记录吗`}),"确定",()=>{let t=null;if(C.some((e,a)=>e.filenameOrigin===l&&(t=a,!0)),null!==t){const i=JSON.parse(JSON.stringify(C));if(i.splice(t,1),$dispatch(Object(f.bb)(i)),Object(y.c)(l),l===a){const t=JSON.parse(JSON.stringify(C));Object(b.r)(M,s,e,t)}}else logger.error("确定要删除播放记录吗 filenameOrigin, recentMusicList",l,C)}):"downloaded"===I&&Y(i,l,a,M,s,e,D):Object(v.j)("提示",c.a.createElement(g.a,{textFragment:`确定要从服务器删除 <span class="delete-alert">${i}</span> 吗`}),"确定",()=>(Object(v.A)(),axios.delete(m.a.delFile,{data:t}).then(t=>{if(window.toast.hide(),!window.cancelAxiosRequest)return"success"===t.data.result.result?($dispatch(Object(O.j)(t.data.result.token)),alert("删除成功"),K(e,l)):"file_deleted"===t.data.result.result?(alert("文件已删除!"),K(e,l)):void logger.error("HTTP_URL.delFile result",t)}).then(()=>{l===a&&Object(b.r)(M,s,e,D)}).catch(e=>{logger.error("HTTP_URL.delFile err",e),Object(v.q)(e,`musicPlayer delFile filenameOrigin: ${l}`)}).finally(()=>{window.cancelAxiosRequest=!1}))))}}X()})}).bind(void 0,l.filename,l.fileSize,l.filenameOrigin,l.uploadUsername,l.duration,l.original,Number(l.payPlay),Number(l.payDownload),l.id,l.date,l.status,l)},c.a.createElement("div",{className:"dot"}),c.a.createElement("div",{className:"dot"}),c.a.createElement("div",{className:"dot"})):c.a.createElement("div",{className:"move-downloading-item fa fa-remove",onClick:((e,t)=>{Object(v.j)("提示",c.a.createElement(g.a,{textFragment:`确定要移除下载 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>{const e=Object(b.N)(t);window.eventEmit.$emit(`FileTransfer-${e}`,"abort"),window[`remove-download-${e}`]=!0,setTimeout(()=>{},500);const{downloadingMusicItems:a}=$getState().fileServer,i=JSON.parse(JSON.stringify(a));for(const e in a)if(Object.prototype.hasOwnProperty.call(a,e)&&a[e].filenameOrigin===t){i.splice(e,1),$dispatch(Object(f.n)(i)),Object(w.c)(t);break}logger.info("saveFileToLocal param, downloadingMusicItems",a)})}).bind(void 0,l.filename,l.filenameOrigin)}))),_&&!B?c.a.createElement("div",{className:"bottom-text"},"我是有底线的"):null),o===h.a.musicOriginal.savedSongs&&c.a.createElement("div",{className:"music-picture"}),!F&&!A&&c.a.createElement(p.default,{fromMusicControl:!0,myMusicPage:I,searchMusicPage:R}))})},468:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),r=a(71),s=a(270),l=a(203),c=a(51),o=a(4),u=a(10),d=a(228),m=a(1),p=a(8),g=a(6),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};window.startToUploadMusic=!1;t.default=Object(r.connect)(e=>({musicList:e.fileServer.musicList,username:e.login.username,token:e.login.token,musicSubmitStatus:e.fileServer.musicSubmitStatus,musicUploadProgress:e.fileServer.musicUploadProgress,setMobile:e.myInfo.setMobile}),()=>({}))(({musicList:e,username:t,token:a,musicSubmitStatus:r,setMobile:v})=>{const[O,b]=Object(i.useState)(null),h=Object(i.useRef)();Object(i.useEffect)(()=>($dispatch(Object(m.X)(!0)),()=>{$dispatch(Object(m.X)(!1))}),[]);const y=Object(i.useCallback)(e=>(logger.info("music acceptedFiles"),a?e&&e[0]?void j(e[0]):alert("没有待上传的音乐"):goRoute(void 0,"/login")),[]),{getRootProps:w,getInputProps:M}=Object(s.a)({onDrop:y}),j=e=>{const t=e.name,a=e.size;if(logger.info("music handleMD5 filename",t,"fileSize",a),/\.mp3$|\.MPEG$|\.OPUS$|\.OGG$|\.OGA$|\.WAV$|\.AAC$|\.CAF$|\.M4A$|\.MP4$|\.WEBA$|\.WEBM$|\.DOLBY$|\.FLAC$/gi.test(t))if(/#|%/g.test(t))alertDialog("文件名不能包含%或#");else{if(!(a>20971520))return $dispatch(Object(m.M)(`${t} 正在读取...`)),Object(p.b)(e).then(t=>{const{MD5Value:a,MD5ValueError:i}=t;logger.info("music handleMD5 MD5Value",a),a&&!i?E(e,a):(logger.error("music handleMD5 no MD5Value"),$dispatch(Object(m.M)("选择一首音乐上传")),alertDialog("音乐读取失败，请更换音乐重试"))}).catch(e=>{$dispatch(Object(m.M)("选择一首音乐上传")),logger.error("music handleMD5 err",e),alertDialog("音乐读取失败，请更换音乐重试")});alertDialog("文件大小超过20M")}else{const e=t.split(".");if(e.length>1){const t=e.pop();alertDialog(`不支持的音乐文件后缀名: .${t}`)}else alertDialog("不支持上传无后缀名的音乐");logger.info("不支持的音乐文件后缀名 filename",t)}},E=(t,a)=>{try{if(!window.startToUploadMusic){window.startToUploadMusic=!0;const i=t.name,r=t.size;let s=!1;$dispatch(Object(m.M)("选择一首音乐上传"));for(const l of e)l.filename===i&&(s=!0,Object(o.j)("提示",n.a.createElement(c.a,{textFragment:`已经存在 <span class="delete-alert">${i}</span> ，上传将覆盖原音乐`}),"确定",()=>(logger.info("overwrite file true",l.filename),N(i,r,a,t)),()=>{logger.info("overwrite file false",l.filename),window.startToUploadMusic=!1}));if(!s)return N(i,r,a,t)}}catch(e){window.startToUploadMusic=!1,$dispatch(Object(m.M)("选择一首音乐上传")),logger.error("music uploadMusic err",e),alertDialog("音乐读取失败，请更换音乐重试")}},N=(()=>{var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function i(n,r){try{var s=t[n](r),l=s.value}catch(e){return void a(e)}if(!s.done)return Promise.resolve(l).then(function(e){i("next",e)},function(e){i("throw",e)});e(l)}("next")})}}(function*(e,a,i,n){$dispatch(Object(m.M)(`${e} 开始上传...`));const r=window.webkitURL.createObjectURL(n),s=yield Object(p.h)(e,t||v,i,"default-music","music");if("缺少字段"===s)return window.startToUploadMusic=!1,$dispatch(Object(m.M)("选择一首音乐上传")),alertDialog("缺少字段");if("上传成功"===s)return window.startToUploadMusic=!1,$dispatch(Object(m.M)("选择一首音乐上传")),Object(p.A)({msg:"second upload music success"}),alertDialog("秒传成功");if("没有匹配"===s){b(r);let s=0;const l=setInterval(function(){if(++s>100)return clearInterval(l),alertDialog("文件读取错误, 请上传其他文件"),logger.error("文件读取错误, 请上传其他文件 filename, fileSize",e,a),$dispatch(Object(m.M)("选择一首音乐上传")),void(window.startToUploadMusic=!1);const r=h.current.duration;if(logger.info("uploadMusic duration, isNaN(duration)",r,isNaN(r)),!isNaN(r)){logger.info("uploadMusicFunc username, duration, MD5Value",t||v,r,i),clearInterval(l);const a=new FormData;a.append("files",n),a.append("username",t||v),a.append("type","music"),a.append("duration",r),a.append("md5",i),a.append("registrationID",localStorage.getItem("registrationID")||"");const s=new XMLHttpRequest;s.upload.addEventListener("progress",S.bind(this,e),!1),s.addEventListener("error",x,!1),s.open("POST",u.a.uploadFile),s.onreadystatechange=function(){window.startToUploadMusic=!1,logger.info("上传成功"+s.responseText),200===s.status?"illegal_filetype"===s.responseText.response?alertDialog(`不支持的文件后缀名: ${e.split(".").pop()}`):"illegal_filename"===s.responseText.response?alertDialog("文件名不得含有%或#"):"more_than_100mb"===s.responseText.response?alertDialog("文件大小超过100MB"):(Object(p.A)({msg:"upload music success"}),alert("上传成功！")):(alertDialog("上传失败"),logger.error("music upload fail xhr",s)),$dispatch(Object(m.M)("选择一首音乐上传"))},s.send(a)}},20)}});return function(t,a,i,n){return e.apply(this,arguments)}})(),S=(e,t)=>{if(t.lengthComputable){const a=Math.round(100*t.loaded/t.total);$dispatch(Object(m.M)(`${a.toString()}% - ${e}`))}else x()},x=()=>{$dispatch(Object(m.M)("选择一首音乐上传")),window.startToUploadMusic=!1,alertDialog("上传失败")};return n.a.createElement("div",{className:"music-container"},n.a.createElement(l.a,null),n.a.createElement("div",{className:"music-header"},"音乐列表"),n.a.createElement("div",{className:"upload-area"},n.a.createElement("div",w(),n.a.createElement("input",f({},M(),{multiple:!1})),n.a.createElement("p",null,r))),n.a.createElement("audio",{className:"will-upload-music",ref:h,src:O}),n.a.createElement(d.a,{musicDataList:e,original:g.a.musicOriginal.musicShare,pageType:g.a.musicOriginal.musicShare}))})}}]);