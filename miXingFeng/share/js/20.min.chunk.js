(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{203:function(e,t,a){"use strict";var n=a(0),i=a.n(n);t.a=(()=>i.a.createElement("div",{className:"top-status-bar"}))},204:function(e,t,a){"use strict";var n=a(0),i=a.n(n),l=a(203);t.a=(({centerText:e="",backToPreviousPage:t=(()=>{}),rightText:a="",rightTextFunc:r=(()=>{})})=>i.a.createElement(n.Fragment,null,i.a.createElement(l.a,null),i.a.createElement("div",{className:"navbar-container"},i.a.createElement("div",{className:"back-btn",onClick:t},i.a.createElement("i",{className:"fa fa-angle-left","aria-hidden":"true"})),i.a.createElement("div",{className:"center-text"},e),i.a.createElement("div",{className:"other-text",onClick:r},a))))},214:function(e,t,a){"use strict";a(70),a(184)},215:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(a(12)),i=u(a(21)),l=u(a(14)),r=u(a(15)),o=u(a(13)),c=u(a(16)),s=u(a(24)),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(0));function u(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(a[n[i]]=e[n[i]])}return a},m=function(e){function t(){return(0,l.default)(this,t),(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e,t,a=this.props,l=a.className,r=a.prefixCls,o=a.children,c=a.text,u=a.size,m=a.overflowCount,v=a.dot,b=a.corner,p=a.hot,g=f(a,["className","prefixCls","children","text","size","overflowCount","dot","corner","hot"]);m=m,c="number"==typeof c&&c>m?m+"+":c,v&&(c="");var w=(0,s.default)((e={},(0,i.default)(e,r+"-dot",v),(0,i.default)(e,r+"-dot-large",v&&"large"===u),(0,i.default)(e,r+"-text",!v&&!b),(0,i.default)(e,r+"-corner",b),(0,i.default)(e,r+"-corner-large",b&&"large"===u),e)),h=(0,s.default)(r,l,(t={},(0,i.default)(t,r+"-not-a-wrapper",!o),(0,i.default)(t,r+"-corner-wrapper",b),(0,i.default)(t,r+"-hot",!!p),(0,i.default)(t,r+"-corner-wrapper-large",b&&"large"===u),t));return d.createElement("span",{className:h},o,(c||v)&&d.createElement("sup",(0,n.default)({className:w},g),c))}}]),t}(d.Component);t.default=m,m.defaultProps={prefixCls:"am-badge",size:"small",overflowCount:99,dot:!1,corner:!1},e.exports=t.default},221:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Object.keys(e).reduce(function(t,a){return"aria-"!==a.substr(0,5)&&"data-"!==a.substr(0,5)&&"role"!==a||(t[a]=e[a]),t},{})},e.exports=t.default},238:function(e,t,a){"use strict";a(222);var n=a(223),i=a.n(n),l=(a(219),a(220)),r=a.n(l),o=a(0),c=a.n(o),s=a(3),d=a(71),u=a(259),f=a.n(u),m=a(51),v=a(4),b=a(10),p=a(6),g=a(11),w=a(8),h=a(1),O=a(22);function j(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function n(i,l){try{var r=t[i](l),o=r.value}catch(e){return void a(e)}if(!r.done)return Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)});e(o)}("next")})}}let E;new RegExp("\\biPhone\\b|\\biPod\\b","i").test(navigator.userAgent)&&(E={onTouchStart:e=>e.preventDefault()});t.a=Object(d.connect)(e=>({username:e.login.username,token:e.login.token,downloadingFileList:e.fileServer.downloadingFileList,lastFileSearchResult:e.fileServer.lastFileSearchResult,lastSearchAllFileResult:e.fileServer.lastSearchAllFileResult,setMobile:e.myInfo.setMobile,downloadedFileList:e.fileServer.downloadedFileList}),()=>({}))(({username:e,token:t,downloadingFileList:a,downloadedFileList:n,lastFileSearchResult:l,lastSearchAllFileResult:d,setMobile:u,fileDataList:S=[],original:y})=>{const N=Object(s.useHistory)(),[F,k]=Object(o.useState)(!0),$=()=>{window.cancelMenuFirst=!0,document.addEventListener("backbutton",x,!1)},x=()=>{window.cancelMenuFirst=!1;const e=document.querySelector(".am-action-sheet-button-list div:nth-last-child(1)");e&&e.click(),e&&e.click()},L=(()=>{var e=j(function*(e,t,a,i,l,o,s){try{document.removeEventListener("backbutton",v.r,!1),document.addEventListener("deviceready",$),e=Object(w.O)(e);let d="下载",u="fileFinished"===y;u?d="打开":"fileShare"!==y&&"fileSearch"!==y||n.some(function(e){return!(Object(w.N)(e.filenameOrigin)!==Object(w.N)(l)||e.status&&"downloaded"!==e.status||(d="打开",u=!0,0))});const f=[d,"分享","删除","取消"];"fileDownloading"===y||"fileFinished"===y||"downloaded"===s?(f.splice(1,1),o=""):"fileShare"===y&&(o=` ${o}`),isCordova||"fileShare"!==y&&"fileSearch"!==y||f.splice(1,1);const b={options:f,cancelButtonIndex:f.length-1,destructiveButtonIndex:f.length-2,message:`大小: ${Object(w.c)(t)}${o}`,title:e,maskClosable:!0,"data-seed":"logId",wrapProps:E};r.a.showActionSheetWithOptions(b,function(n){switch(logger.info("file manage showMenu buttonIndex",n),n){case 0:u?T(e,l):Object(w.T)(e,i,t,a,!1,l,N,T);break;case 1:if("fileFinished"===y||"downloaded"===s)Object(v.j)("提示",c.a.createElement(m.a,{textFragment:`确定从本地删除 <span class="delete-alert">${e}</span> 吗`}),"确定",function(){Object(w.M)(Object(w.N)(l),"file").then(function(){M(y,l)}).catch(function(t){logger.error("删除文件过程中发生了错误 isFileFinished",t.stack||t.toString()),Object(v.q)(t,`fileManage removeFileFromDownload filename ${e}`)})});else if(isCordova){const n=`${p.a.appStaticDirectory}#/show_file_info?filename=${e}&fileSize=${Object(w.c)(t)}&filePath=${a}`;Object(v.w)({title:e,description:"我分享了一个文件,快来看看吧",thumb:`${p.a.appStaticDirectory}logo.png`,webpageUrl:n})}else P(e,l);break;case 2:!isCordova||"fileShare"!==y&&"fileSearch"!==y||"downloaded"===s||P(e,l);break;default:logger.warn("buttonIndex default")}window.cancelMenuFirst=!1,document.removeEventListener("backbutton",x),document.removeEventListener("deviceready",$),document.addEventListener("backbutton",v.r,!1)})}catch(e){logger.error("fileManage showMenu err",e)}});return function(t,a,n,i,l,r,o){return e.apply(this,arguments)}})(),P=(a,n)=>{if(!t)return goRoute(void 0,"/login");const i={username:e||u,token:t,filename:a,type:"default-file"};Object(v.j)("提示",c.a.createElement(m.a,{textFragment:`确定从服务器删除 <span class="delete-alert">${a}</span> 吗`}),"确定",()=>(Object(v.A)(),axios.delete(b.a.delFile,{data:i}).then(e=>{if(window.toast.hide(),!window.cancelAxiosRequest)return"file_deleted"===e.data.result.result?(alert("文件已删除!"),$dispatch(Object(g.j)(e.data.result.token)),M(y,n)):"success"===e.data.result.result?(alert("删除成功!"),$dispatch(Object(g.j)(e.data.result.token)),M(y,n)):void alert("删除失败!")}).catch(e=>{logger.error("删除文件过程中发生了错误",e.stack||e.toString()),Object(v.q)(e,`delFile dataInfo: ${JSON.stringify(i)}`)}).finally(()=>{window.cancelAxiosRequest=!1})))},M=(e,t)=>{if("fileSearch"===e){let e,a;l.some((a,n)=>a.filenameOrigin===t&&(e=n,!0));const n=JSON.parse(JSON.stringify(l));n.splice(e,1),d.some((e,n)=>e.filenameOrigin===t&&(a=n,!0));const i=JSON.parse(JSON.stringify(d));d.splice(a,1),$dispatch(Object(h.s)(n)),$dispatch(Object(h.B)(i))}},T=(e,t)=>{let a=f.a.lookup(e);a||(a="text/plain",alert("不支持打开的的文件类型，请提交反馈")),Object(w.C)(e,a,Object(w.N)(t))},_=(()=>{var e=j(function*(e,t,n,i,l){e=Object(w.O)(e),"fileFinished"===y?T(e,l):"fileShare"===y||"fileSearch"===y?yield Object(w.T)(e,t,n,i,!1,l,N,T):"fileDownloading"===y&&a.some(function(a){return a.filenameOrigin===l&&(l=l.replace(/^downloading_/,""),logger.info("downloadOrOpenFile filenameOrigin",l),"失败"===a.progress||"已取消"===a.progress?Object(w.T)(e,t,n,i,!0,l,N,T):(window.eventEmit.$emit(`FileTransfer-${l}`,"abort"),setTimeout(function(){window[`cancel-download-${Object(w.N)(l)}`]||Object(w.T)(e,t,n,i,!0,l,N,T)},500)),!0)})});return function(t,a,n,i,l){return e.apply(this,arguments)}})(),C=Object(w.D)(S,F,p.a.showFileNumberPerTime,k),D="fileDownloading"===y;return c.a.createElement("div",{className:"file-manage-container"},C.map((e,t)=>c.a.createElement("div",{className:"file-list",key:e.filenameOrigin},c.a.createElement("div",{className:`file-content ${D?"downloading":""}`,onClick:_.bind(void 0,e.filename,e.uploadUsername,e.fileSize,e.filePath,e.filenameOrigin)},c.a.createElement("div",{className:`num ${Object(v.d)(t+1)}`},t+1),c.a.createElement("div",{className:"file-info"},c.a.createElement("div",{className:`info ${"fileFinished"===y?"center":""} ${e.downloaded?"downloaded":""}`},c.a.createElement("div",{className:`filename ${D?"downloading":""}`,dangerouslySetInnerHTML:{__html:e.filename}}),e.downloaded&&c.a.createElement("div",{className:"downloaded-text"},"已下载"),D?c.a.createElement("div",{className:"file-size downloading"},e.progress):null),c.a.createElement("div",{className:"upload-info"},c.a.createElement("div",{className:`upload-user ${D?"downloading":""}`},`${"fileFinished"!==y?e.uploadUsername:""}${(e=>e?"fileDownloading"===y?"":("number"==typeof e&&(e=new Date(e).format("yyyy-MM-dd"))," "+e.split(" ")[0]):"")(e.date)}`),"fileShare"===y||"fileSearch"===y?c.a.createElement("div",{className:`file-size ${Object(v.d)(t+1)}`},Object(w.c)(e.fileSize)):D?c.a.createElement("div",{className:"download-progress"},c.a.createElement(i.a,{percent:e.received?e.received/e.fileSize*100:0,position:"normal"})):null))),D?c.a.createElement("div",{className:"move-downloading-item fa fa-remove",onClick:((e,t)=>{Object(v.j)("提示",c.a.createElement(m.a,{textFragment:`确定要移除下载 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>{const e=Object(w.N)(t);window.eventEmit.$emit(`FileTransfer-${e}`,"abort"),window[`remove-download-${e}`]=!0,setTimeout(()=>{},500);const{downloadingFileList:a}=$getState().fileServer,n=JSON.parse(JSON.stringify(a));for(const e in a)if(n[e].filenameOrigin===t){n.splice(e,1),$dispatch(Object(h.m)(n)),Object(O.c)(t);break}})}).bind(void 0,e.filename,e.filenameOrigin)}):c.a.createElement("div",{className:"menu",onClick:L.bind(void 0,e.filename,e.fileSize,e.filePath,e.uploadUsername,e.filenameOrigin,e.date,e.status)},c.a.createElement("div",{className:"dot"}),c.a.createElement("div",{className:"dot"}),c.a.createElement("div",{className:"dot"})))))})},497:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),l=a(71),r=a(3),o=a(238),c=a(204),s=a(1),d=a(8),u=a(4),f=a(2);t.default=Object(l.connect)(e=>({downloadingFileList:e.fileServer.downloadingFileList,downloadedFileList:e.fileServer.downloadedFileList,isFromHomeSearch:e.common.isFromHomeSearch}),()=>({}))(({downloadingFileList:e,downloadedFileList:t,isFromHomeSearch:a})=>{const l=Object(r.useHistory)();function m(e){if(!window.cancelMenuFirst){if(Object(u.h)())return void Object(u.y)();"nav"!==e&&Object(u.y)(),a?($dispatch(Object(f.t)(!1)),l.push("/main/home")):l.push("/main/myInfo")}}Object(n.useEffect)(()=>(document.addEventListener("deviceready",v,!1),()=>{document.removeEventListener("deviceready",v,!1),document.removeEventListener("backbutton",m,!1)}),[]);const v=()=>{document.addEventListener("backbutton",m,!1)};return i.a.createElement("div",{className:"my-download-container"},i.a.createElement(c.a,{centerText:"文件",backToPreviousPage:m.bind(null,"nav"),rightText:"清空",rightTextFunc:()=>{Object(u.j)("提示","确定要删除所有文件吗","确定",()=>{$dispatch(Object(s.k)([])),t.length?alert("删除成功"):alert("没有文件需要被清理"),isH5||t.forEach(e=>{Object(d.M)(Object(d.N)(e.filenameOrigin),"file")})})}}),i.a.createElement("div",{className:"my-download-content file-container"},i.a.createElement("div",{className:"downloading-file-container"},i.a.createElement("div",{className:"downloading-file-title"},"正在下载"),!isH5&&i.a.createElement(o.a,{fileDataList:e,original:"fileDownloading"})),i.a.createElement("div",{className:"interval-line"}),i.a.createElement("div",{className:"downloaded-file-container"},i.a.createElement("div",{className:"downloaded-file-title"},"已完成"),!isH5&&i.a.createElement(o.a,{original:"fileFinished",fileDataList:t}))))})}}]);