(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{203:function(e,t,n){"use strict";var a=n(0),s=n.n(a);t.a=(()=>s.a.createElement("div",{className:"top-status-bar"}))},204:function(e,t,n){"use strict";var a=n(0),s=n.n(a),i=n(203);t.a=(({centerText:e="",backToPreviousPage:t=(()=>{}),rightText:n="",rightTextFunc:o=(()=>{})})=>s.a.createElement(a.Fragment,null,s.a.createElement(i.a,null),s.a.createElement("div",{className:"navbar-container"},s.a.createElement("div",{className:"back-btn",onClick:t},s.a.createElement("i",{className:"fa fa-angle-left","aria-hidden":"true"})),s.a.createElement("div",{className:"center-text"},e),s.a.createElement("div",{className:"other-text",onClick:o},n))))},208:function(e,t,n){"use strict";var a=n(0),s=n.n(a);const i=Object(a.forwardRef)((e,t)=>{const{type:n="text",placeholder:a="",value:i="",handleKeyDown:o=(()=>{}),handleChange:r=(()=>{}),maxLength:c=26,style:l={},handleClick:u=(()=>{}),handleBlur:h=(()=>{}),className:m}=e;return s.a.createElement("input",{className:`input-component ${m}`,type:n,placeholder:a,value:i,onKeyDown:o,onChange:r,maxLength:c,autoComplete:"off",style:l,onClick:u,onBlur:h,ref:t})});t.a=i},247:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var a=n(0),s=n.n(a);class i extends a.Component{render(){const{item:e,query:t,select:n}=this.props,a=e.toLowerCase().indexOf(t.toLowerCase()),i=t.length,o=e.slice(0,a)+"<b>"+e.slice(a,a+i)+"</b>"+e.slice(a+i);return s.a.createElement("div",{className:"auto-suggest-name",onClick:()=>n(e),dangerouslySetInnerHTML:{__html:o}})}}},490:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(71),o=n(8),r=n(204),c=n(247),l=n(208),u=n(4);t.default=Object(i.connect)(e=>({username:e.login.username,token:e.login.token,currentLocation:e.common.currentLocation,currentXYPosition:e.common.currentXYPosition,currentProvince:e.common.currentProvince,setMobile:e.myInfo.setMobile}),()=>({}))(class extends a.Component{constructor(e){super(e),this.searchPosition=(()=>{const{token:e,username:t,setMobile:n}=this.props;if(!e)return goRoute(this,"/login");const{searchString:a}=this.state;return this.setState({isSearching:!0}),Object(o.W)(a).then(e=>{this.setState({positionText:e.positionText||"位置不可用",oppositeXYPosition:e.currentXYPosition||[0,0],isSearching:!1,status:e.status||"离线",typedUsername:a},()=>{t===a||n===a?this.updateBaiduMap():e.positionText&&"位置不可用"!==e.positionText&&e.currentXYPosition&&0!==e.currentXYPosition[0]&&this.updateBaiduMap()})}).catch(e=>{Object(u.q)(e,`searchPosition searchString:${a}`)})}),this.keyDownEvent=(e=>{const t=e,{token:n}=this.props;if(13===t.keyCode)return n?(this.blur(),this.searchPosition()):goRoute(this,"/login")}),this.backToMainPage=(()=>{goRoute(this,"/search_column")}),this.blur=(()=>{setTimeout(()=>{this.setState({ulPadding:"0",ulDisplay:"none"})},300)}),this.select=(e=>{this.setState({searchString:e,ulPadding:"0",ulDisplay:"none"},this.searchPosition)}),this.updateBaiduMap=(()=>{let{positionText:e,positionXY:t,searchString:n,oppositeXYPosition:a}=this.state,{username:s,currentProvince:i,setMobile:o}=this.props;if(0===t[0]&&0===t[1]){if(0===a[0]||0===a[1])return;s=n,t=a}0!==t[0]&&0!==t[1]&&0!==a[0]&&0!==a[1]&&(Math.abs(t[0]-a[0])<1e-4||Math.abs(t[1]-a[1])<5e-5)&&(s=n,t=a);const r=new window.BMap.Map("map_canvas");if(r.enableScrollWheelZoom(),n===s||n===o){const n=new window.BMap.Point(t[0],t[1]);r.centerAndZoom(n,12),(new window.BMap.Geocoder).getPoint(e,function(e){e?(r.centerAndZoom(e,16),r.addOverlay(new window.BMap.Marker(e))):alert("您选择地址没有解析到结果!")},i)}else{const e=new window.BMap.DrivingRoute(i,{onSearchComplete:function(t){if(e.getStatus()===window.BMAP_STATUS_SUCCESS){const e=t.getPlan(0);let n=[];for(let t=0;t<e.getNumRoutes();t++){const a=e.getRoute(t);n=n.concat(a.getPath())}r.addOverlay(new window.BMap.Polyline(n,{strokeColor:"#111"})),r.setViewport(n)}}}),n=new window.BMap.Point(t[0],t[1]),s=new window.BMap.Point(a[0],a[1]);e.search(n,s)}}),this.state={positionText:e.currentLocation||"位置不可用",positionXY:e.currentXYPosition||[0,0],oppositeXYPosition:[0,0],searchString:e.token?e.username||e.setMobile:"",autoSuggestList:[],isSearching:!1,status:"在线",typedUsername:"",ulPadding:"0",ulDisplay:"block"}}componentDidMount(){const{token:e}=this.props;e&&this.searchPosition()}render(){const{positionText:e,isSearching:t,searchString:n,autoSuggestList:i,status:u,typedUsername:h,ulPadding:m,ulDisplay:d}=this.state,{token:p}=this.props;return s.a.createElement("div",{className:"search-history-container"},s.a.createElement(r.a,{centerText:"搜索地理位置",backToPreviousPage:this.backToMainPage}),s.a.createElement("div",{className:"search-header"},s.a.createElement("div",{className:"search-input"},s.a.createElement(l.a,{value:n,placeholder:p?n:"请输入您要搜索的用户名",handleChange:e=>Object(o.cb)(e.target.value,this),handleKeyDown:this.keyDownEvent,handleBlur:this.blur,className:"search-input-content"}),s.a.createElement("div",{className:"ul",style:{padding:m,display:d}},i.length?i.map((e,t)=>s.a.createElement(c.a,{key:t,item:e,query:n,select:this.select})):null),s.a.createElement("i",{className:"fa fa-search","aria-hidden":"true"}))),s.a.createElement("div",{className:"search-position-container"},t?n&&s.a.createElement("div",{className:"searching"},"正在查询..."):s.a.createElement("div",{className:"search-position-content"},s.a.createElement("div",{className:"search-string"},"用户名：",h),s.a.createElement("div",{className:"user-status"},"状态：",u),s.a.createElement("div",{className:"position-text"},"位置：",e))),!t&&s.a.createElement(a.Fragment,null,s.a.createElement("div",{id:"map_canvas"}),s.a.createElement("div",{id:"result"})))}})}}]);