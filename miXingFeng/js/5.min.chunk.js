(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{358:function(e,i,a){"use strict";a(353);var t=a(354),n=a.n(t),s=(a(348),a(349)),c=a.n(s),l=(a(150),a(69)),r=a.n(l),o=a(0),m=a.n(o),u=a(95),d=a(4),g=a(98),O=a(361),b=a(8),p=a(371),f=a(38),v=a(1),h=a(3),y=a(11),S=a(9),j=a(2),w=a(31),P=a(24),E=a(34);let N;new RegExp("\\biPhone\\b|\\biPod\\b","i").test(navigator.userAgent)&&(N={onTouchStart:e=>e.preventDefault()});let M=0;const x={action:null};i.a=Object(u.connect)(e=>({soundPlaying:e.fileServer.soundPlaying,soundInstance:e.fileServer.soundInstance,currentPlayingSong:e.fileServer.currentPlayingSong,currentSongTime:e.fileServer.currentSongTime,pauseWhenOver:e.fileServer.pauseWhenOver,playByOrder:e.fileServer.playByOrder,musicCollection:e.fileServer.musicCollection,musicMenuBadge:e.fileServer.musicMenuBadge,username:e.login.username,token:e.login.token,playByRandom:e.fileServer.playByRandom,lastMusicSearchResult:e.fileServer.lastMusicSearchResult,lastSearchAllMusicResult:e.fileServer.lastSearchAllMusicResult,downloadingMusicItems:e.fileServer.downloadingMusicItems,downloadedMusicList:e.fileServer.downloadedMusicList,currentPlayingSongOriginal:e.fileServer.currentPlayingSongOriginal,recentMusicList:e.fileServer.recentMusicList,setMobile:e.myInfo.setMobile,setPermisssions:e.myInfo.setPermisssions,showMusicPlayingFromMusicControl:e.fileServer.showMusicPlayingFromMusicControl,notExistMusicPlayingPage:e.fileServer.notExistMusicPlayingPage,musicPlayListData:e.fileServer.musicPlayListData,musicSharePosition:e.fileServer.musicSharePosition,musicSavePosition:e.fileServer.musicSavePosition,musicRecentPosition:e.fileServer.musicRecentPosition,musicHomePosition:e.fileServer.musicHomePosition,mySongList:e.fileServer.mySongList}),()=>({}))(({original:e,soundInstance:i,currentPlayingSong:a,currentSongTime:t,soundPlaying:s,pageType:l,pauseWhenOver:u,playByOrder:$,musicCollection:k=[],musicMenuBadge:L,username:I,token:F,playByRandom:R,setMobile:J,setPermisssions:D,musicDataList:T,lastMusicSearchResult:B,lastSearchAllMusicResult:H,recentMusicList:_,noShowMusicPlaying:C=!1,myMusicPage:q=!1,searchMusicPage:A=!1,notExistMusicPlayingPage:U=!1,musicPlayerRef:z,musicPlayListData:Q,height:W,musicSharePosition:V,musicSavePosition:G,musicRecentPosition:K,musicHomePosition:X,mySongList:Y})=>{const Z=Object(E.n)(),ee=Object(E.m)(),ie=Object(E.l)(),ae=Object(E.k)(),te=Object(d.useHistory)();Object(o.useEffect)(()=>(g.Howler.volume(.8),e!==j.a.musicOriginal.musicDownloading&&i&&Object(S.t)(),document.addEventListener("deviceready",ne,!1),()=>{Z?$dispatch(Object(v.S)(M)):ee?$dispatch(Object(v.R)(M)):ie?$dispatch(Object(v.Q)(M)):ae&&$dispatch(Object(v.L)(M)),document.removeEventListener("deviceready",ne,!1),document.removeEventListener("backbutton",se,!1)}),[]);const ne=()=>{document.addEventListener("backbutton",se,!1)},se=()=>{if(!window.cancelMenuFirst&&!window.specialBack)if($getState().fileServer.showMusicPlayingFromMusicControl||Object(h.h)())Object(h.z)();else if(q)Object(h.b)("/my_song_lists_detail"===getRoute()?"/my_song_lists_page":"/my_download_middle_page",!0);else{if(!A)return;Object(h.b)("/search_column",!0)}},ce=()=>{window.cancelMenuFirst=!0,document.addEventListener("backbutton",re)},le=()=>{window.cancelMenuFirst&&(window.cancelMenuFirst=!1,document.removeEventListener("backbutton",re),document.removeEventListener("deviceready",ce),document.addEventListener("backbutton",h.r))},re=()=>{const e=document.querySelector(".am-action-sheet-button-list div:nth-last-child(1)");e&&e.click(),x.action&&(x.action.close(),x.action=null),le()},oe=(e,i,a,t,n,s,c)=>{Object(h.j)("提示",m.a.createElement(f.a,{textFragment:`确定从本地删除 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>Object(S.G)(Object(S.H)(i),"music").then(()=>{me(s,i),i===a&&Object(S.q)(t,n,s,c)}).catch(e=>{logger.error("删除音乐过程中发生了错误 isFileFinished",e.stack||e.toString()),Object(h.q)(e,`musicPlayer removeFileFromDownload filenameOrigin: ${i}`)}))},me=(e,i)=>{if(e===j.a.musicOriginal.musicSearch){let e,a;B.some((a,t)=>Object(S.H)(a.filenameOrigin)===Object(S.H)(i)&&(e=t,!0));const t=JSON.parse(JSON.stringify(B));t.splice(e,1),H.some((e,t)=>Object(S.H)(e.filenameOrigin)===Object(S.H)(i)&&(a=t,!0));const n=JSON.parse(JSON.stringify(H));n.splice(a,1),$dispatch(Object(v.y)(t)),$dispatch(Object(v.G)(n))}},ue=(d,g)=>m.a.createElement(o.Fragment,null,m.a.createElement("div",{className:"music-content",onClick:()=>Object(S.o)({filePath:d.filePath,filename:d.filename,filenameOrigin:d.filenameOrigin,uploadUsername:d.uploadUsername,fileSize:d.fileSize,duration:d.duration,songOriginal:d.original,original:e,musicDataList:T,pageType:l,payPlay:Number(d.payPlay),musicId:d.id,songInfo:d})},m.a.createElement("div",{className:`num ${Object(h.d)(g+1)}`},g+1),m.a.createElement("div",{className:"music-info"},m.a.createElement("div",{className:`info ${d.saved&&l!==j.a.musicOriginal.savedSongs?"song-saved":""}`},m.a.createElement("div",{className:`filename ${de?d.saved?"downloading-save":"downloading":""}`,dangerouslySetInnerHTML:{__html:Object(S.s)(d.filename)}}),Number(d.payPlay)?m.a.createElement("i",{className:"fa fa-lock copyright-song-flag","aria-hidden":"true"}):"",d.saved&&l!==j.a.musicOriginal.savedSongs&&m.a.createElement("i",{className:"fa fa-heart saved-song-flag","aria-hidden":"true"}),e!==j.a.musicOriginal.homeRecommend&&"onlineMusic"!==l&&"onlineMusicSearchALl"!==l?d.original===j.a.musicOriginal.netEaseCloud||d.original===j.a.musicOriginal.homeRecommend?m.a.createElement("div",{className:"net-ease-source-flag"},"网易云"):d.original===j.a.musicOriginal.qqMusic?m.a.createElement("div",{className:"qq-music-source-flag"},"QQ音乐"):d.original===j.a.musicOriginal.kuGouMusic?m.a.createElement("div",{className:"ku-gou-music-source-flag"},"酷狗音乐"):d.original===j.a.musicOriginal.kuWoMusic?m.a.createElement("div",{className:"ku-wo-music-source-flag"},"酷我音乐"):null:null,d.mvId?m.a.createElement("i",{className:"fa fa-youtube-play","aria-hidden":"true",onClick:e=>((e,i,a,t)=>{e.stopPropagation(),te.push({pathname:"/music_mv_Player",query:{mvId:i,original:a,filename:Object(S.J)(t),lastLocation:getRoute()}})})(e,d.mvId,d.original,d.filename)}):null,de?m.a.createElement("div",{className:"song-duration-time downloading"},d.progress):null),a===d.filenameOrigin?((e,i,a)=>m.a.createElement("div",{className:"audio-player"},m.a.createElement("audio",{preload:"auto",className:"audio-selector"},m.a.createElement("source",{src:e})),m.a.createElement("div",{className:"audio-player-time audio-player-time-current"},Object(S.Q)(i)),m.a.createElement("div",{className:"audio-player-bar"},m.a.createElement("div",{className:"audio-player-bar-loaded",style:{width:"100%"}}),m.a.createElement("div",{className:"audio-player-bar-played",style:{width:i/a*100+"%"}})),m.a.createElement("div",{className:"audio-player-time audio-player-time-duration"},Object(S.Q)(a))))(d.filePath,t,d.duration):m.a.createElement("div",{className:"upload-duration"},m.a.createElement("div",{className:`upload-user ${de?"downloading":""}`},d.uploadUsername||"未知",(i=>i?e!==j.a.musicOriginal.musicDownloading?("number"==typeof i&&(i=new Date(i).format("yyyy-MM-dd")),e===j.a.musicOriginal.musicShare||e===j.a.musicOriginal.musicSearch||e===j.a.musicOriginal.musicFinished?" "+i.split(" ")[0]:""):void 0:"")(d.date)),de?m.a.createElement("div",{className:"download-progress"},m.a.createElement(n.a,{percent:d.received?d.received/d.fileSize*100:0,position:"normal"})):m.a.createElement("div",{className:`song-duration-time ${Object(h.d)(g+1)}`},Object(S.Q)(d.duration)))),!s&&e!==j.a.musicOriginal.musicDownloading&&a===d.filenameOrigin&&m.a.createElement("div",{className:"pause-button-overlay"},m.a.createElement("div",{className:"pause-button"},m.a.createElement("div",{className:"triangle"})))),e!==j.a.musicOriginal.musicDownloading?m.a.createElement("div",{className:"menu",onClick:((t,n,o,d,g,O,p,P,E,M,B,H)=>{const C=r.a.operation;document.removeEventListener("backbutton",h.r,!1),document.addEventListener("deviceready",ce),t=Object(S.J)(t);const q=JSON.parse(JSON.stringify(L)),A=k.map(e=>Object(S.H)(e.filenameOrigin)),U=["播放",-1!==A.indexOf(Object(S.H)(o))?"已收藏":"收藏","单曲播放","单曲循环","顺序播放","随机播放","添加到播放列表","添加到歌单","下载","删除","取消"];s&&o===a&&(U[0]="暂停"),M=e===j.a.musicOriginal.musicShare||e===j.a.musicOriginal.musicSearch?` ${M}`:"";const z={options:U,cancelButtonIndex:U.length-1,destructiveButtonIndex:U.length-2,badges:q,message:n?`大小: ${Object(S.b)(n)}${M}`:M,title:t,maskClosable:!0,"data-seed":"logId",wrapProps:N};e!==j.a.musicOriginal.musicShare&&e!==j.a.musicOriginal.musicSearch||D.removeMusic||(U.splice(-2,1),delete z.destructiveButtonIndex),e===j.a.musicOriginal.musicFinished?(U.splice(8,1),z.destructiveButtonIndex=U.length-2):((l===j.a.musicOriginal.savedSongs||"onlineMusic"===l||"onlineMusicSearchALl"===l&&e!==j.a.musicOriginal.musicSearch||l===j.a.musicOriginal.homeRecommend||l===j.a.musicOriginal.musicPlayList)&&(U.splice(-2,1),delete z.destructiveButtonIndex,l===j.a.musicOriginal.musicPlayList&&(U[6]="移除")),P&&q.push({index:8,text:"版"})),c.a.showActionSheetWithOptions(z,s=>{logger.info("music player showMenu buttonIndex",s);const c=T.map(e=>e.filenameOrigin),r=c.indexOf(o);if(-1===r)return logger.error("showActionSheetWithOptions currentFileIndex === -1 filename",t),alert(t+"已被删除");const N=T[r].filePath;switch(s){case 0:Object(S.o)({filePath:N,filename:t,filenameOrigin:o,uploadUsername:d,fileSize:n,duration:g,songOriginal:O,original:e,musicDataList:T,pageType:l,payPlay:p,musicId:E,songInfo:H});break;case 1:Object(S.O)({savedMusicFilenameOriginalArr:A,filenameOrigin:o,musicCollection:k,musicDataList:T,currentFileIndex:r,original:e,e:null,pageType:l});break;case 2:(!u||$||R)&&(i&&i.loop(!1),$dispatch(Object(v.jb)(!0)),$dispatch(Object(v.kb)(!1)),$dispatch(Object(v.lb)(!1)),alert("单曲播放"),$dispatch(Object(v.N)([{index:2,text:"✔️"},{index:3,text:""},{index:4,text:""},{index:5,text:""}])));break;case 3:u&&(i&&i.loop(!0),$dispatch(Object(v.jb)(!1)),$dispatch(Object(v.kb)(!1)),$dispatch(Object(v.lb)(!1)),alert("单曲循环"),$dispatch(Object(v.N)([{index:2,text:""},{index:3,text:"✔️"},{index:4,text:""},{index:5,text:""}])));break;case 4:$||(i&&i.loop(!1),$dispatch(Object(v.jb)(!0)),$dispatch(Object(v.kb)(!0)),$dispatch(Object(v.lb)(!1)),alert("顺序播放"),$dispatch(Object(v.N)([{index:2,text:""},{index:3,text:""},{index:4,text:"✔️"},{index:5,text:""}])));break;case 5:R||(i&&i.loop(!1),$dispatch(Object(v.jb)(!0)),$dispatch(Object(v.kb)(!1)),$dispatch(Object(v.lb)(!0)),alert("随机播放"),$dispatch(Object(v.N)([{index:2,text:""},{index:3,text:""},{index:4,text:""},{index:5,text:"✔️"}])));break;case 6:{let e=JSON.parse(JSON.stringify(Q));if(l!==j.a.musicOriginal.musicPlayList){if(p&&!$getState().myInfo.setMusicVip)return alert("不可以添加有版权的音乐");{let i=JSON.parse(JSON.stringify(H));i.pageType=l,e.push(i);const a={};e=e.filter(e=>!a[e.filenameOrigin]&&(a[e.filenameOrigin]=!0,!0)),i=null,alert("添加成功")}}else e=e.filter(e=>e.filenameOrigin!==H.filenameOrigin),alert("已取消");$dispatch(Object(v.P)(e));break}case 7:if(Object.keys(Y).length){const e=Object(S.y)({musicDataList:T,currentFileIndex:r,filenameOrigin:o,operationAction:x,removeListenBackFunc:le});if(e.length)return void(x.action=C(e));alert("没有其他歌单了");break}alert("请先创建歌单");break;case 8:e===j.a.musicOriginal.musicFinished?oe(t,o,a,r,c,e,T):Object(S.N)({musicDataList:T,filename:t,uploadUsername:d,fileSize:n,musicSrc:N,filenameOrigin:o,duration:g,songOriginal:O,musicId:E,payDownload:P,mvId:H.mvId,md5:H.md5,albumId:H.albumId});break;case 9:{if(le(),("onlineMusic"===l||"onlineMusicSearchALl"===l||e===j.a.musicOriginal.musicFinished)&&e!==j.a.musicOriginal.musicSearch)return;if(!F)return goRoute(void 0,"/login");const i={username:I||J,token:F,filename:t,type:"default-music"};if(e!==j.a.musicOriginal.musicShare&&e!==j.a.musicOriginal.musicSearch||"downloaded"===B)e===j.a.musicOriginal.musicRecent?Object(h.j)("提示",m.a.createElement(f.a,{textFragment:`确定要删除 <span class="delete-alert">${t}</span> 的播放记录吗`}),"确定",()=>{let i=null;if(_.some((e,a)=>e.filenameOrigin===o&&(i=a,!0)),null!==i){const t=JSON.parse(JSON.stringify(_));if(t.splice(i,1),$dispatch(Object(v.nb)(t)),Object(w.c)(o),o===a){const i=JSON.parse(JSON.stringify(_));Object(S.q)(r,c,e,i)}}else logger.error("确定要删除播放记录吗 filenameOrigin, recentMusicList",o,_)}):"downloaded"===B?oe(t,o,a,r,c,e,T):l===j.a.musicOriginal.myMusicListPage&&Object(S.I)(o,t);else{if(!D.removeMusic)return;Object(h.j)("提示",m.a.createElement(f.a,{textFragment:`确定要从服务器删除 <span class="delete-alert">${t}</span> 吗`}),"确定",()=>(Object(h.B)(),axios.delete(b.a.delFileV2,{data:i}).then(i=>{if(window.toast.hide(),!window.cancelAxiosRequest)return"success"===i.result?($dispatch(Object(y.i)(i.token)),alert("删除成功"),me(e,o)):"file_deleted"===i.result?(alert("文件已删除!"),me(e,o)):void logger.error("HTTP_URL.delFileV2 result",i)}).then(()=>{o===a&&Object(S.q)(r,c,e,T)}).catch(e=>{window.toast.hide(),logger.error("HTTP_URL.delFileV2 err",e),Object(h.q)(e,`musicPlayer delFile filenameOrigin: ${o}`)}).finally(()=>{window.cancelAxiosRequest=!1})))}return}}le()})}).bind(void 0,d.filename,d.fileSize,d.filenameOrigin,d.uploadUsername,d.duration,d.original,Number(d.payPlay),Number(d.payDownload),d.id,d.date,d.status,d)},m.a.createElement("div",{className:"dot"}),m.a.createElement("div",{className:"dot"}),m.a.createElement("div",{className:"dot"})):m.a.createElement("div",{className:"move-downloading-item fa fa-remove",onClick:((e,i)=>{Object(h.j)("提示",m.a.createElement(f.a,{textFragment:`确定要移除下载 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>{const e=Object(S.H)(i);window.eventEmit.$emit(`FileTransfer-${e}`,"abort"),window[`remove-download-${e}`]=!0,setTimeout(()=>{window[`remove-download-${e}`]=!1},1500);const{downloadingMusicItems:a}=$getState().fileServer,t=JSON.parse(JSON.stringify(a));for(const e in a)if(Object.prototype.hasOwnProperty.call(a,e)&&a[e].filenameOrigin===i){t.splice(e,1),$dispatch(Object(v.o)(t)),Object(P.c)(i);break}logger.info("saveFileToLocal param, downloadingMusicItems",a)})}).bind(void 0,d.filename,d.filenameOrigin)}));Object(S.n)(T,l);const de=e===j.a.musicOriginal.musicDownloading;let ge=0;return Z&&V?ge=V:ee&&G?ge=G:ie&&K?ge=K:ae&&X&&(ge=X),m.a.createElement(o.Fragment,null,m.a.createElement("div",{className:"music-list-container",style:{height:l===j.a.musicOriginal.musicFinished?"auto":"100%"},ref:z},W?m.a.createElement(O.a,{width:window.screen.width,height:W,rowCount:T.length,rowHeight:66,onScroll:({scrollTop:e})=>{M=e,Z&&V?$dispatch(Object(v.S)(0)):ee&&G?$dispatch(Object(v.R)(0)):ie&&K?$dispatch(Object(v.Q)(0)):ae&&X&&$dispatch(Object(v.L)(0))},scrollTop:ge||void 0,rowRenderer:({key:e,index:i,style:a})=>m.a.createElement("div",{key:e,style:a,className:"music-list",id:Object(E.d)(T[i].filenameOrigin)},ue(T[i],i))}):T.map((e,i)=>m.a.createElement("div",{key:e.filenameOrigin,className:"music-list",id:Object(E.d)(e.filenameOrigin)},ue(e,i)))),l===j.a.musicOriginal.savedSongs&&m.a.createElement("div",{className:"music-picture"}),!C&&!U&&m.a.createElement(p.default,{fromMusicControl:!0,myMusicPage:q,searchMusicPage:A}))})}}]);