(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{336:function(e,t,n){"use strict";var a=n(0),i=n.n(a),l=n(337);t.a=(({centerText:e="",backToPreviousPage:t=(()=>{}),rightText:n="",rightTextFunc:r=(()=>{})})=>i.a.createElement(a.Fragment,null,i.a.createElement(l.a,null),i.a.createElement("div",{className:"navbar-container"},i.a.createElement("div",{className:"back-btn",onClick:t},i.a.createElement("i",{className:"fa fa-angle-left","aria-hidden":"true"})),i.a.createElement("div",{className:"center-text"},e),i.a.createElement("div",{className:"other-text",onClick:r},n))))},337:function(e,t,n){"use strict";var a=n(0),i=n.n(a);t.a=(()=>i.a.createElement("div",{className:"top-status-bar"}))},346:function(e,t,n){"use strict";n(96),n(317)},347:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(n(14)),i=f(n(25)),l=f(n(16)),r=f(n(17)),o=f(n(15)),c=f(n(18)),s=f(n(26)),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function f(e){return e&&e.__esModule?e:{default:e}}var m=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&(n[a[i]]=e[a[i]])}return n},u=function(e){function t(){return(0,l.default)(this,t),(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,r.default)(t,[{key:"render",value:function(){var e,t,n=this.props,l=n.className,r=n.prefixCls,o=n.children,c=n.text,f=n.size,u=n.overflowCount,v=n.dot,p=n.corner,g=n.hot,b=m(n,["className","prefixCls","children","text","size","overflowCount","dot","corner","hot"]);u=u,c="number"==typeof c&&c>u?u+"+":c,v&&(c="");var h=(0,s.default)((e={},(0,i.default)(e,r+"-dot",v),(0,i.default)(e,r+"-dot-large",v&&"large"===f),(0,i.default)(e,r+"-text",!v&&!p),(0,i.default)(e,r+"-corner",p),(0,i.default)(e,r+"-corner-large",p&&"large"===f),e)),w=(0,s.default)(r,l,(t={},(0,i.default)(t,r+"-not-a-wrapper",!o),(0,i.default)(t,r+"-corner-wrapper",p),(0,i.default)(t,r+"-hot",!!g),(0,i.default)(t,r+"-corner-wrapper-large",p&&"large"===f),t));return d.createElement("span",{className:w},o,(c||v)&&d.createElement("sup",(0,a.default)({className:h},b),c))}}]),t}(d.Component);t.default=u,u.defaultProps={prefixCls:"am-badge",size:"small",overflowCount:99,dot:!1,corner:!1},e.exports=t.default},350:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Object.keys(e).reduce(function(t,n){return"aria-"!==n.substr(0,5)&&"data-"!==n.substr(0,5)&&"role"!==n||(t[n]=e[n]),t},{})},e.exports=t.default},365:function(e,t,n){"use strict";n(353);var a=n(354),i=n.n(a),l=(n(348),n(349)),r=n.n(l),o=n(0),c=n.n(o),s=n(4),d=n(95),f=n(375),m=n.n(f),u=n(361),v=n(38),p=n(3),g=n(8),b=n(2),h=n(11),w=n(9),O=n(1),E=n(20),j=n(34);function S(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(i,l){try{var r=t[i](l),o=r.value}catch(e){return void n(e)}if(!r.done)return Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)});e(o)}("next")})}}let y;new RegExp("\\biPhone\\b|\\biPod\\b","i").test(navigator.userAgent)&&(y={onTouchStart:e=>e.preventDefault()});let F=0;t.a=Object(d.connect)(e=>({username:e.login.username,token:e.login.token,downloadingFileList:e.fileServer.downloadingFileList,lastFileSearchResult:e.fileServer.lastFileSearchResult,lastSearchAllFileResult:e.fileServer.lastSearchAllFileResult,setMobile:e.myInfo.setMobile,setPermisssions:e.myInfo.setPermisssions,downloadedFileList:e.fileServer.downloadedFileList,fileSharePosition:e.fileServer.fileSharePosition}),()=>({}))(({username:e,token:t,downloadingFileList:n,downloadedFileList:a,lastFileSearchResult:l,lastSearchAllFileResult:d,setMobile:f,setPermisssions:N={},fileDataList:$=[],original:k,height:x,fileSharePosition:L})=>{const P="fileDownloading"===k,M=Object(j.j)(),_=Object(s.useHistory)();Object(o.useEffect)(()=>()=>{M&&$dispatch(Object(O.q)(F))},[]);const C=()=>{window.cancelMenuFirst=!0,document.addEventListener("backbutton",H,!1)},H=()=>{window.cancelMenuFirst=!1;const e=document.querySelector(".am-action-sheet-button-list div:nth-last-child(1)");e&&e.click(),e&&e.click()},T=(()=>{var e=S(function*(e,t,n,i,l,o,s,d){try{document.removeEventListener("backbutton",p.r,!1),document.addEventListener("deviceready",C),e=Object(w.J)(e);let f="下载",m="fileFinished"===k;m?f="打开":"fileShare"!==k&&"fileSearch"!==k||a.some(function(e){return!(Object(w.H)(e.filenameOrigin)!==Object(w.H)(l)||e.status&&"downloaded"!==e.status||(f="打开",m=!0,0))});const u=[f,"分享","删除","取消"];"fileFinished"===k||"downloaded"===s?(u.splice(1,1),o=""):"fileShare"===k&&(o=` ${o}`),"fileShare"!==k&&"fileSearch"!==k||(isCordova?N.removeFile||u.splice(2,1):(u.splice(1,1),N.removeFile||u.splice(1,1)));const g={options:u,cancelButtonIndex:u.length-1,destructiveButtonIndex:u.length-2,message:`大小: ${Object(w.b)(t)}${o}`,title:e,maskClosable:!0,"data-seed":"logId",wrapProps:y};r.a.showActionSheetWithOptions(g,function(a){switch(logger.info("file manage showMenu buttonIndex",a),a){case 0:m?J(e,l):Object(w.M)(e,i,t,n,!1,l,_,J,d);break;case 1:if("fileFinished"===k||"downloaded"===s)Object(p.j)("提示",c.a.createElement(v.a,{textFragment:`确定从本地删除 <span class="delete-alert">${e}</span> 吗`}),"确定",function(){Object(w.G)(Object(w.H)(l),"file").then(function(){z(k,l)}).catch(function(t){logger.error("删除文件过程中发生了错误 isFileFinished",t.stack||t.toString()),Object(p.q)(t,`fileManage removeFileFromDownload filename ${e}`)})});else if(isCordova){const a=`${b.a.appStaticDirectory}#/show_file_info?filename=${e}&fileSize=${Object(w.b)(t)}&filePath=${n}`;Object(p.w)({title:e,description:"我分享了一个文件,快来看看吧",thumb:`${b.a.appStaticDirectory}logo.png`,webpageUrl:a})}else N.removeFile&&D(e,l);break;case 2:isCordova&&("fileShare"===k||"fileSearch"===k)&&"downloaded"!==s&&N.removeFile&&D(e,l);break;default:logger.warn("buttonIndex default")}window.cancelMenuFirst=!1,document.removeEventListener("backbutton",H),document.removeEventListener("deviceready",C),document.addEventListener("backbutton",p.r,!1)})}catch(e){logger.error("fileManage showMenu err",e)}});return function(t,n,a,i,l,r,o,c){return e.apply(this,arguments)}})(),D=(n,a)=>{if(!t)return goRoute(void 0,"/login");const i={username:e||f,token:t,filename:n,type:"default-file"};Object(p.j)("提示",c.a.createElement(v.a,{textFragment:`确定从服务器删除 <span class="delete-alert">${n}</span> 吗`}),"确定",()=>(Object(p.B)(),axios.delete(g.a.delFileV2,{data:i}).then(e=>{if(window.toast.hide(),!window.cancelAxiosRequest)return"file_deleted"===e.result?(alert("文件已删除!"),$dispatch(Object(h.i)(e.token)),z(k,a)):"success"===e.result?(alert("删除成功!"),$dispatch(Object(h.i)(e.token)),z(k,a)):void alert("删除失败!")}).catch(e=>{window.toast.hide(),logger.error("删除文件过程中发生了错误",e.stack||e.toString()),Object(p.q)(e,`delFile dataInfo: ${JSON.stringify(i)}`)}).finally(()=>{window.cancelAxiosRequest=!1})))},z=(e,t)=>{if("fileSearch"===e){let e,n;l.some((n,a)=>n.filenameOrigin===t&&(e=a,!0));const a=JSON.parse(JSON.stringify(l));a.splice(e,1),d.some((e,a)=>e.filenameOrigin===t&&(n=a,!0));const i=JSON.parse(JSON.stringify(d));d.splice(n,1),$dispatch(Object(O.u)(a)),$dispatch(Object(O.D)(i))}},J=(e,t)=>{let n=m.a.lookup(e);n||(n="text/plain",alert("不支持打开的的文件类型，请提交反馈")),Object(w.x)(e,n,Object(w.H)(t))},R=(()=>{var e=S(function*(e,t,a,i,l,r){e=Object(w.J)(e),"fileFinished"===k?J(e,l):"fileShare"===k||"fileSearch"===k?yield Object(w.M)(e,t,a,i,!1,l,_,J,r):"fileDownloading"===k&&n.some(function(n){return n.filenameOrigin===l&&(l=l.replace(/^downloading_/,""),logger.info("downloadOrOpenFile filenameOrigin",l),"失败"===n.progress||"已取消"===n.progress?Object(w.M)(e,t,a,i,!0,l,_,J,r):(window.eventEmit.$emit(`FileTransfer-${l}`,"abort"),setTimeout(function(){window[`cancel-download-${Object(w.H)(l)}`]||Object(w.M)(e,t,a,i,!0,l,_,J,r)},500)),!0)})});return function(t,n,a,i,l,r){return e.apply(this,arguments)}})(),I=(e,t)=>c.a.createElement(o.Fragment,null,c.a.createElement("div",{className:`file-content ${P?"downloading":""}`,onClick:R.bind(void 0,e.filename,e.uploadUsername,e.fileSize,e.filePath,e.filenameOrigin,e.md5)},c.a.createElement("div",{className:`num ${Object(p.d)(t+1)}`},t+1),c.a.createElement("div",{className:"file-info"},c.a.createElement("div",{className:`info ${"fileFinished"===k?"center":""} ${e.downloaded?"downloaded":""}`},c.a.createElement("div",{className:`filename ${P?"downloading":""}`,dangerouslySetInnerHTML:{__html:e.filename}}),e.downloaded&&c.a.createElement("div",{className:"downloaded-text"},"已下载"),P?c.a.createElement("div",{className:"file-size downloading"},e.progress):null),c.a.createElement("div",{className:"upload-info"},c.a.createElement("div",{className:`upload-user ${P?"downloading":""}`},`${"fileFinished"!==k?e.uploadUsername:""}${(e=>e?"fileDownloading"===k?"":("number"==typeof e&&(e=new Date(e).format("yyyy-MM-dd"))," "+e.split(" ")[0]):"")(e.date)}`),"fileShare"===k||"fileSearch"===k?c.a.createElement("div",{className:`file-size ${Object(p.d)(t+1)}`},Object(w.b)(e.fileSize)):P?c.a.createElement("div",{className:"download-progress"},c.a.createElement(i.a,{percent:e.received?e.received/e.fileSize*100:0,position:"normal"})):null))),P?c.a.createElement("div",{className:"move-downloading-item fa fa-remove",onClick:((e,t)=>{Object(p.j)("提示",c.a.createElement(v.a,{textFragment:`确定要移除下载 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>{const e=Object(w.H)(t);window.eventEmit.$emit(`FileTransfer-${e}`,"abort"),window[`remove-download-${e}`]=!0,setTimeout(()=>{window[`remove-download-${e}`]=!1},1500);const{downloadingFileList:n}=$getState().fileServer,a=JSON.parse(JSON.stringify(n));for(const e in n)if(a[e].filenameOrigin===t){a.splice(e,1),$dispatch(Object(O.n)(a)),Object(E.c)(t);break}})}).bind(void 0,e.filename,e.filenameOrigin)}):c.a.createElement("div",{className:"menu",onClick:T.bind(void 0,e.filename,e.fileSize,e.filePath,e.uploadUsername,e.filenameOrigin,e.date,e.status,e.md5)},c.a.createElement("div",{className:"dot"}),c.a.createElement("div",{className:"dot"}),c.a.createElement("div",{className:"dot"})));let q=0;return M&&L&&(q=L),c.a.createElement("div",{className:"file-manage-container"},x?c.a.createElement(u.a,{width:window.screen.width,height:x,rowCount:$.length,rowHeight:66,onScroll:({scrollTop:e})=>{F=e,M&&L&&$dispatch(Object(O.q)(0))},scrollTop:q||void 0,rowRenderer:({key:e,index:t,style:n})=>c.a.createElement("div",{key:e,style:n,className:"file-list"},I($[t],t))}):$.map((e,t)=>c.a.createElement("div",{className:"file-list",key:e.filenameOrigin},I(e,t))))})},590:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),l=n(95),r=n(4),o=n(365),c=n(336),s=n(1),d=n(9),f=n(3),m=n(6);t.default=Object(l.connect)(e=>({downloadingFileList:e.fileServer.downloadingFileList,downloadedFileList:e.fileServer.downloadedFileList,isFromHomeSearch:e.common.isFromHomeSearch}),()=>({}))(({downloadingFileList:e,downloadedFileList:t,isFromHomeSearch:n})=>{const l=Object(r.useHistory)();function u(e){if(!window.cancelMenuFirst){if(Object(f.h)())return void Object(f.z)();"nav"!==e&&Object(f.z)(),n?($dispatch(Object(m.s)(!1)),l.push("/main/home")):l.push("/main/myInfo")}}Object(a.useEffect)(()=>(document.addEventListener("deviceready",v,!1),()=>{document.removeEventListener("deviceready",v,!1),document.removeEventListener("backbutton",u,!1)}),[]);const v=()=>{document.addEventListener("backbutton",u,!1)};return i.a.createElement("div",{className:"my-download-container"},i.a.createElement(c.a,{centerText:"文件",backToPreviousPage:u.bind(null,"nav"),rightText:"清空",rightTextFunc:()=>{Object(f.j)("提示","确定要删除所有文件吗","确定",()=>{$dispatch(Object(s.l)([])),t.length?alert("删除成功"):alert("没有文件需要被清理"),isH5||t.forEach(e=>{Object(d.G)(Object(d.H)(e.filenameOrigin),"file")})})}}),i.a.createElement("div",{className:"my-download-content file-container"},i.a.createElement("div",{className:"downloading-file-container"},i.a.createElement("div",{className:"downloading-file-title"},"正在下载"),!isH5&&i.a.createElement(o.a,{original:"fileDownloading",fileDataList:e})),i.a.createElement("div",{className:"interval-line"}),i.a.createElement("div",{className:"downloaded-file-container"},i.a.createElement("div",{className:"downloaded-file-title"},"已完成"),isH5?i.a.createElement("img",{alt:"",className:"empty-content-pic",src:"./imgs/download.png"}):t.length||e.length?i.a.createElement(o.a,{original:"fileFinished",fileDataList:t}):i.a.createElement("img",{alt:"",className:"empty-content-pic",src:"./imgs/download.png"}))))})}}]);