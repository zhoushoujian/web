(window.webpackJsonp=window.webpackJsonp||[]).push([[30,5],{348:function(e,t,i){"use strict";i(96),i(346),i(318)},349:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=g(i(25)),n=g(i(14)),s=g(i(26)),r=d(i(0)),l=d(i(19)),c=g(i(147)),o=g(i(146)),u=g(i(350)),m=g(i(347));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function g(e){return e&&e.__esModule?e:{default:e}}var p="NORMAL",f="SHARE";function O(){}var b=[];function h(e,t,i){var d=(0,n.default)({prefixCls:"am-action-sheet",cancelButtonText:"取消"},t),g=d.prefixCls,O=d.className,h=d.transitionName,v=d.maskTransitionName,y=d.maskClosable,S=void 0===y||y,j=document.createElement("div");function w(){if(j){l.unmountComponentAtNode(j),j.parentNode&&j.parentNode.removeChild(j);var e=b.indexOf(w);-1!==e&&b.splice(e,1)}}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=i(e,t);a&&a.then?a.then(function(){w()}):w()}document.body.appendChild(j),b.push(w);var N=d.title,M=d.message,$=d.options,P=d.destructiveButtonIndex,x=d.cancelButtonIndex,k=d.cancelButtonText,T=d.badges,L=void 0===T?[]:T,D=[N?r.createElement("h3",{key:"0",className:g+"-title"},N):null,M?r.createElement("div",{key:"1",className:g+"-message"},M):null],I=null,F="normal";switch(e){case p:F="normal";var R=$,C={};L&&L.length>0&&L.forEach(function(e){e.index>=0&&(C[e.index]=r.createElement(m.default,e))}),I=r.createElement("div",(0,u.default)(d),D,r.createElement("div",{className:g+"-button-list",role:"group"},R.map(function(e,t){var i,l={className:(0,s.default)(g+"-button-list-item",(i={},(0,a.default)(i,g+"-destructive-button",P===t),(0,a.default)(i,g+"-cancel-button",x===t),i)),onClick:function(){return E(t)},role:"button"},c=r.createElement("div",l,e);C[t]&&(c=r.createElement("div",(0,n.default)({},l,{className:l.className+" "+g+"-button-list-badge"}),r.createElement("span",{className:g+"-button-list-item-content"},e),C[t]));var u=r.createElement(o.default,{key:t,activeClassName:g+"-button-list-item-active"},c);return x!==t&&P!==t||(u=r.createElement(o.default,{key:t,activeClassName:g+"-button-list-item-active"},r.createElement("div",l,e,x===t?r.createElement("span",{className:g+"-cancel-button-mask"}):null))),u})));break;case f:F="share";var _=$.length&&Array.isArray($[0])||!1,A=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r.createElement("div",{className:g+"-share-list-item",role:"button",key:t,onClick:function(){return E(t,i)}},r.createElement("div",{className:g+"-share-list-item-icon"},e.icon),r.createElement("div",{className:g+"-share-list-item-title"},e.title))};I=r.createElement("div",(0,u.default)(d),D,r.createElement("div",{className:g+"-share"},_?$.map(function(e,t){return r.createElement("div",{key:t,className:g+"-share-list"},e.map(function(e,i){return A(e,i,t)}))}):r.createElement("div",{className:g+"-share-list"},$.map(function(e,t){return A(e,t)})),r.createElement(o.default,{activeClassName:g+"-share-cancel-button-active"},r.createElement("div",{className:g+"-share-cancel-button",role:"button",onClick:function(){return E(-1)}},k))))}var B=(0,s.default)(g+"-"+F,O);return l.render(r.createElement(c.default,{visible:!0,title:"",footer:"",prefixCls:g,className:B,transitionName:h||"am-slide-up",maskTransitionName:v||"am-fade",onClose:function(){return E(x||-1)},maskClosable:S,wrapProps:d.wrapProps||{}},I),j),{close:w}}t.default={showActionSheetWithOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;h(p,e,t)},showShareActionSheetWithOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;h(f,e,t)},close:function(){b.forEach(function(e){return e()})}},e.exports=t.default},353:function(e,t,i){"use strict";i(96),i(320)},354:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=m(i(14)),n=m(i(25)),s=m(i(16)),r=m(i(17)),l=m(i(15)),c=m(i(18)),o=m(i(26)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(0));function m(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return(0,s.default)(this,t),(0,l.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,r.default)(t,[{key:"componentWillReceiveProps",value:function(){this.noAppearTransition=!0}},{key:"componentDidMount",value:function(){var e=this;this.props.appearTransition&&setTimeout(function(){e.barRef&&(e.barRef.style.width=e.props.percent+"%")},10)}},{key:"render",value:function(){var e,t=this,i=this.props,s=i.className,r=i.prefixCls,l=i.position,c=i.unfilled,m=i.style,d=void 0===m?{}:m,g=i.barStyle,p=void 0===g?{}:g,f={width:this.noAppearTransition||!this.props.appearTransition?this.props.percent+"%":0,height:0},O=(0,o.default)(r+"-outer",s,(e={},(0,n.default)(e,r+"-fixed-outer","fixed"===l),(0,n.default)(e,r+"-hide-outer",!c),e));return u.createElement("div",{style:d,className:O,role:"progressbar","aria-valuenow":this.props.percent,"aria-valuemin":0,"aria-valuemax":100},u.createElement("div",{ref:function(e){return t.barRef=e},className:r+"-bar",style:(0,a.default)({},p,f)}))}}]),t}(u.Component);t.default=d,d.defaultProps={prefixCls:"am-progress",percent:0,position:"fixed",unfilled:!0,appearTransition:!1},e.exports=t.default},358:function(e,t,i){"use strict";i(353);var a=i(354),n=i.n(a),s=(i(348),i(349)),r=i.n(s),l=(i(150),i(69)),c=i.n(l),o=i(0),u=i.n(o),m=i(95),d=i(4),g=i(98),p=i(361),f=i(8),O=i(371),b=i(38),h=i(1),v=i(3),y=i(11),S=i(9),j=i(2),w=i(31),E=i(24),N=i(34);let M;new RegExp("\\biPhone\\b|\\biPod\\b","i").test(navigator.userAgent)&&(M={onTouchStart:e=>e.preventDefault()});let $=0;const P={action:null};t.a=Object(m.connect)(e=>({soundPlaying:e.fileServer.soundPlaying,soundInstance:e.fileServer.soundInstance,currentPlayingSong:e.fileServer.currentPlayingSong,currentSongTime:e.fileServer.currentSongTime,pauseWhenOver:e.fileServer.pauseWhenOver,playByOrder:e.fileServer.playByOrder,musicCollection:e.fileServer.musicCollection,musicMenuBadge:e.fileServer.musicMenuBadge,username:e.login.username,token:e.login.token,playByRandom:e.fileServer.playByRandom,lastMusicSearchResult:e.fileServer.lastMusicSearchResult,lastSearchAllMusicResult:e.fileServer.lastSearchAllMusicResult,downloadingMusicItems:e.fileServer.downloadingMusicItems,downloadedMusicList:e.fileServer.downloadedMusicList,currentPlayingSongOriginal:e.fileServer.currentPlayingSongOriginal,recentMusicList:e.fileServer.recentMusicList,setMobile:e.myInfo.setMobile,setPermisssions:e.myInfo.setPermisssions,showMusicPlayingFromMusicControl:e.fileServer.showMusicPlayingFromMusicControl,notExistMusicPlayingPage:e.fileServer.notExistMusicPlayingPage,musicPlayListData:e.fileServer.musicPlayListData,musicSharePosition:e.fileServer.musicSharePosition,musicSavePosition:e.fileServer.musicSavePosition,musicRecentPosition:e.fileServer.musicRecentPosition,musicHomePosition:e.fileServer.musicHomePosition,mySongList:e.fileServer.mySongList}),()=>({}))(({original:e,soundInstance:t,currentPlayingSong:i,currentSongTime:a,soundPlaying:s,pageType:l,pauseWhenOver:m,playByOrder:x,musicCollection:k=[],musicMenuBadge:T,username:L,token:D,playByRandom:I,setMobile:F,setPermisssions:R,musicDataList:C,lastMusicSearchResult:_,lastSearchAllMusicResult:A,recentMusicList:B,noShowMusicPlaying:U=!1,myMusicPage:J=!1,searchMusicPage:H=!1,notExistMusicPlayingPage:q=!1,musicPlayerRef:W,musicPlayListData:z,height:V,musicSharePosition:G,musicSavePosition:Q,musicRecentPosition:X,musicHomePosition:Y,mySongList:K})=>{const Z=Object(N.n)(),ee=Object(N.m)(),te=Object(N.l)(),ie=Object(N.k)(),ae=Object(d.useHistory)();Object(o.useEffect)(()=>(g.Howler.volume(.8),e!==j.a.musicOriginal.musicDownloading&&t&&Object(S.t)(),document.addEventListener("deviceready",ne,!1),()=>{Z?$dispatch(Object(h.S)($)):ee?$dispatch(Object(h.R)($)):te?$dispatch(Object(h.Q)($)):ie&&$dispatch(Object(h.L)($)),document.removeEventListener("deviceready",ne,!1),document.removeEventListener("backbutton",se,!1)}),[]);const ne=()=>{document.addEventListener("backbutton",se,!1)},se=()=>{if(!window.cancelMenuFirst&&!window.specialBack)if($getState().fileServer.showMusicPlayingFromMusicControl||Object(v.h)())Object(v.z)();else if(J)Object(v.b)("/my_song_lists_detail"===getRoute()?"/my_song_lists_page":"/my_download_middle_page",!0);else{if(!H)return;Object(v.b)("/search_column",!0)}},re=()=>{window.cancelMenuFirst=!0,document.addEventListener("backbutton",ce)},le=()=>{window.cancelMenuFirst&&(window.cancelMenuFirst=!1,document.removeEventListener("backbutton",ce),document.removeEventListener("deviceready",re),document.addEventListener("backbutton",v.r))},ce=()=>{const e=document.querySelector(".am-action-sheet-button-list div:nth-last-child(1)");e&&e.click(),P.action&&(P.action.close(),P.action=null),le()},oe=(e,t,i,a,n,s,r)=>{Object(v.j)("提示",u.a.createElement(b.a,{textFragment:`确定从本地删除 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>Object(S.G)(Object(S.H)(t),"music").then(()=>{ue(s,t),t===i&&Object(S.q)(a,n,s,r)}).catch(e=>{logger.error("删除音乐过程中发生了错误 isFileFinished",e.stack||e.toString()),Object(v.q)(e,`musicPlayer removeFileFromDownload filenameOrigin: ${t}`)}))},ue=(e,t)=>{if(e===j.a.musicOriginal.musicSearch){let e,i;_.some((i,a)=>Object(S.H)(i.filenameOrigin)===Object(S.H)(t)&&(e=a,!0));const a=JSON.parse(JSON.stringify(_));a.splice(e,1),A.some((e,a)=>Object(S.H)(e.filenameOrigin)===Object(S.H)(t)&&(i=a,!0));const n=JSON.parse(JSON.stringify(A));n.splice(i,1),$dispatch(Object(h.y)(a)),$dispatch(Object(h.G)(n))}},me=(d,g)=>u.a.createElement(o.Fragment,null,u.a.createElement("div",{className:"music-content",onClick:()=>Object(S.o)({filePath:d.filePath,filename:d.filename,filenameOrigin:d.filenameOrigin,uploadUsername:d.uploadUsername,fileSize:d.fileSize,duration:d.duration,songOriginal:d.original,original:e,musicDataList:C,pageType:l,payPlay:Number(d.payPlay),musicId:d.id,songInfo:d})},u.a.createElement("div",{className:`num ${Object(v.d)(g+1)}`},g+1),u.a.createElement("div",{className:"music-info"},u.a.createElement("div",{className:`info ${d.saved&&l!==j.a.musicOriginal.savedSongs?"song-saved":""}`},u.a.createElement("div",{className:`filename ${de?d.saved?"downloading-save":"downloading":""}`,dangerouslySetInnerHTML:{__html:Object(S.s)(d.filename)}}),Number(d.payPlay)?u.a.createElement("i",{className:"fa fa-lock copyright-song-flag","aria-hidden":"true"}):"",d.saved&&l!==j.a.musicOriginal.savedSongs&&u.a.createElement("i",{className:"fa fa-heart saved-song-flag","aria-hidden":"true"}),e!==j.a.musicOriginal.homeRecommend&&"onlineMusic"!==l&&"onlineMusicSearchALl"!==l?d.original===j.a.musicOriginal.netEaseCloud||d.original===j.a.musicOriginal.homeRecommend?u.a.createElement("div",{className:"net-ease-source-flag"},"网易云"):d.original===j.a.musicOriginal.qqMusic?u.a.createElement("div",{className:"qq-music-source-flag"},"QQ音乐"):d.original===j.a.musicOriginal.kuGouMusic?u.a.createElement("div",{className:"ku-gou-music-source-flag"},"酷狗音乐"):d.original===j.a.musicOriginal.kuWoMusic?u.a.createElement("div",{className:"ku-wo-music-source-flag"},"酷我音乐"):null:null,d.mvId?u.a.createElement("i",{className:"fa fa-youtube-play","aria-hidden":"true",onClick:e=>((e,t,i,a)=>{e.stopPropagation(),ae.push({pathname:"/music_mv_Player",query:{mvId:t,original:i,filename:Object(S.J)(a),lastLocation:getRoute()}})})(e,d.mvId,d.original,d.filename)}):null,de?u.a.createElement("div",{className:"song-duration-time downloading"},d.progress):null),i===d.filenameOrigin?((e,t,i)=>u.a.createElement("div",{className:"audio-player"},u.a.createElement("audio",{preload:"auto",className:"audio-selector"},u.a.createElement("source",{src:e})),u.a.createElement("div",{className:"audio-player-time audio-player-time-current"},Object(S.Q)(t)),u.a.createElement("div",{className:"audio-player-bar"},u.a.createElement("div",{className:"audio-player-bar-loaded",style:{width:"100%"}}),u.a.createElement("div",{className:"audio-player-bar-played",style:{width:t/i*100+"%"}})),u.a.createElement("div",{className:"audio-player-time audio-player-time-duration"},Object(S.Q)(i))))(d.filePath,a,d.duration):u.a.createElement("div",{className:"upload-duration"},u.a.createElement("div",{className:`upload-user ${de?"downloading":""}`},d.uploadUsername||"未知",(t=>t?e!==j.a.musicOriginal.musicDownloading?("number"==typeof t&&(t=new Date(t).format("yyyy-MM-dd")),e===j.a.musicOriginal.musicShare||e===j.a.musicOriginal.musicSearch||e===j.a.musicOriginal.musicFinished?" "+t.split(" ")[0]:""):void 0:"")(d.date)),de?u.a.createElement("div",{className:"download-progress"},u.a.createElement(n.a,{percent:d.received?d.received/d.fileSize*100:0,position:"normal"})):u.a.createElement("div",{className:`song-duration-time ${Object(v.d)(g+1)}`},Object(S.Q)(d.duration)))),!s&&e!==j.a.musicOriginal.musicDownloading&&i===d.filenameOrigin&&u.a.createElement("div",{className:"pause-button-overlay"},u.a.createElement("div",{className:"pause-button"},u.a.createElement("div",{className:"triangle"})))),e!==j.a.musicOriginal.musicDownloading?u.a.createElement("div",{className:"menu",onClick:((a,n,o,d,g,p,O,E,N,$,_,A)=>{const U=c.a.operation;document.removeEventListener("backbutton",v.r,!1),document.addEventListener("deviceready",re),a=Object(S.J)(a);const J=JSON.parse(JSON.stringify(T)),H=k.map(e=>Object(S.H)(e.filenameOrigin)),q=["播放",-1!==H.indexOf(Object(S.H)(o))?"已收藏":"收藏","单曲播放","单曲循环","顺序播放","随机播放","添加到播放列表","添加到歌单","下载","删除","取消"];s&&o===i&&(q[0]="暂停"),$=e===j.a.musicOriginal.musicShare||e===j.a.musicOriginal.musicSearch?` ${$}`:"";const W={options:q,cancelButtonIndex:q.length-1,destructiveButtonIndex:q.length-2,badges:J,message:n?`大小: ${Object(S.b)(n)}${$}`:$,title:a,maskClosable:!0,"data-seed":"logId",wrapProps:M};e!==j.a.musicOriginal.musicShare&&e!==j.a.musicOriginal.musicSearch||R.removeMusic||(q.splice(-2,1),delete W.destructiveButtonIndex),e===j.a.musicOriginal.musicFinished?(q.splice(8,1),W.destructiveButtonIndex=q.length-2):((l===j.a.musicOriginal.savedSongs||"onlineMusic"===l||"onlineMusicSearchALl"===l&&e!==j.a.musicOriginal.musicSearch||l===j.a.musicOriginal.homeRecommend||l===j.a.musicOriginal.musicPlayList)&&(q.splice(-2,1),delete W.destructiveButtonIndex,l===j.a.musicOriginal.musicPlayList&&(q[6]="移除")),E&&J.push({index:8,text:"版"})),r.a.showActionSheetWithOptions(W,s=>{logger.info("music player showMenu buttonIndex",s);const r=C.map(e=>e.filenameOrigin),c=r.indexOf(o);if(-1===c)return logger.error("showActionSheetWithOptions currentFileIndex === -1 filename",a),alert(a+"已被删除");const M=C[c].filePath;switch(s){case 0:Object(S.o)({filePath:M,filename:a,filenameOrigin:o,uploadUsername:d,fileSize:n,duration:g,songOriginal:p,original:e,musicDataList:C,pageType:l,payPlay:O,musicId:N,songInfo:A});break;case 1:Object(S.O)({savedMusicFilenameOriginalArr:H,filenameOrigin:o,musicCollection:k,musicDataList:C,currentFileIndex:c,original:e,e:null,pageType:l});break;case 2:(!m||x||I)&&(t&&t.loop(!1),$dispatch(Object(h.jb)(!0)),$dispatch(Object(h.kb)(!1)),$dispatch(Object(h.lb)(!1)),alert("单曲播放"),$dispatch(Object(h.N)([{index:2,text:"✔️"},{index:3,text:""},{index:4,text:""},{index:5,text:""}])));break;case 3:m&&(t&&t.loop(!0),$dispatch(Object(h.jb)(!1)),$dispatch(Object(h.kb)(!1)),$dispatch(Object(h.lb)(!1)),alert("单曲循环"),$dispatch(Object(h.N)([{index:2,text:""},{index:3,text:"✔️"},{index:4,text:""},{index:5,text:""}])));break;case 4:x||(t&&t.loop(!1),$dispatch(Object(h.jb)(!0)),$dispatch(Object(h.kb)(!0)),$dispatch(Object(h.lb)(!1)),alert("顺序播放"),$dispatch(Object(h.N)([{index:2,text:""},{index:3,text:""},{index:4,text:"✔️"},{index:5,text:""}])));break;case 5:I||(t&&t.loop(!1),$dispatch(Object(h.jb)(!0)),$dispatch(Object(h.kb)(!1)),$dispatch(Object(h.lb)(!0)),alert("随机播放"),$dispatch(Object(h.N)([{index:2,text:""},{index:3,text:""},{index:4,text:""},{index:5,text:"✔️"}])));break;case 6:{let e=JSON.parse(JSON.stringify(z));if(l!==j.a.musicOriginal.musicPlayList){if(O&&!$getState().myInfo.setMusicVip)return alert("不可以添加有版权的音乐");{let t=JSON.parse(JSON.stringify(A));t.pageType=l,e.push(t);const i={};e=e.filter(e=>!i[e.filenameOrigin]&&(i[e.filenameOrigin]=!0,!0)),t=null,alert("添加成功")}}else e=e.filter(e=>e.filenameOrigin!==A.filenameOrigin),alert("已取消");$dispatch(Object(h.P)(e));break}case 7:if(Object.keys(K).length){const e=Object(S.y)({musicDataList:C,currentFileIndex:c,filenameOrigin:o,operationAction:P,removeListenBackFunc:le});if(e.length)return void(P.action=U(e));alert("没有其他歌单了");break}alert("请先创建歌单");break;case 8:e===j.a.musicOriginal.musicFinished?oe(a,o,i,c,r,e,C):Object(S.N)({musicDataList:C,filename:a,uploadUsername:d,fileSize:n,musicSrc:M,filenameOrigin:o,duration:g,songOriginal:p,musicId:N,payDownload:E,mvId:A.mvId,md5:A.md5,albumId:A.albumId});break;case 9:{if(le(),("onlineMusic"===l||"onlineMusicSearchALl"===l||e===j.a.musicOriginal.musicFinished)&&e!==j.a.musicOriginal.musicSearch)return;if(!D)return goRoute(void 0,"/login");const t={username:L||F,token:D,filename:a,type:"default-music"};if(e!==j.a.musicOriginal.musicShare&&e!==j.a.musicOriginal.musicSearch||"downloaded"===_)e===j.a.musicOriginal.musicRecent?Object(v.j)("提示",u.a.createElement(b.a,{textFragment:`确定要删除 <span class="delete-alert">${a}</span> 的播放记录吗`}),"确定",()=>{let t=null;if(B.some((e,i)=>e.filenameOrigin===o&&(t=i,!0)),null!==t){const a=JSON.parse(JSON.stringify(B));if(a.splice(t,1),$dispatch(Object(h.nb)(a)),Object(w.c)(o),o===i){const t=JSON.parse(JSON.stringify(B));Object(S.q)(c,r,e,t)}}else logger.error("确定要删除播放记录吗 filenameOrigin, recentMusicList",o,B)}):"downloaded"===_?oe(a,o,i,c,r,e,C):l===j.a.musicOriginal.myMusicListPage&&Object(S.I)(o,a);else{if(!R.removeMusic)return;Object(v.j)("提示",u.a.createElement(b.a,{textFragment:`确定要从服务器删除 <span class="delete-alert">${a}</span> 吗`}),"确定",()=>(Object(v.B)(),axios.delete(f.a.delFileV2,{data:t}).then(t=>{if(window.toast.hide(),!window.cancelAxiosRequest)return"success"===t.result?($dispatch(Object(y.i)(t.token)),alert("删除成功"),ue(e,o)):"file_deleted"===t.result?(alert("文件已删除!"),ue(e,o)):void logger.error("HTTP_URL.delFileV2 result",t)}).then(()=>{o===i&&Object(S.q)(c,r,e,C)}).catch(e=>{window.toast.hide(),logger.error("HTTP_URL.delFileV2 err",e),Object(v.q)(e,`musicPlayer delFile filenameOrigin: ${o}`)}).finally(()=>{window.cancelAxiosRequest=!1})))}return}}le()})}).bind(void 0,d.filename,d.fileSize,d.filenameOrigin,d.uploadUsername,d.duration,d.original,Number(d.payPlay),Number(d.payDownload),d.id,d.date,d.status,d)},u.a.createElement("div",{className:"dot"}),u.a.createElement("div",{className:"dot"}),u.a.createElement("div",{className:"dot"})):u.a.createElement("div",{className:"move-downloading-item fa fa-remove",onClick:((e,t)=>{Object(v.j)("提示",u.a.createElement(b.a,{textFragment:`确定要移除下载 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>{const e=Object(S.H)(t);window.eventEmit.$emit(`FileTransfer-${e}`,"abort"),window[`remove-download-${e}`]=!0,setTimeout(()=>{window[`remove-download-${e}`]=!1},1500);const{downloadingMusicItems:i}=$getState().fileServer,a=JSON.parse(JSON.stringify(i));for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e)&&i[e].filenameOrigin===t){a.splice(e,1),$dispatch(Object(h.o)(a)),Object(E.c)(t);break}logger.info("saveFileToLocal param, downloadingMusicItems",i)})}).bind(void 0,d.filename,d.filenameOrigin)}));Object(S.n)(C,l);const de=e===j.a.musicOriginal.musicDownloading;let ge=0;return Z&&G?ge=G:ee&&Q?ge=Q:te&&X?ge=X:ie&&Y&&(ge=Y),u.a.createElement(o.Fragment,null,u.a.createElement("div",{className:"music-list-container",style:{height:l===j.a.musicOriginal.musicFinished?"auto":"100%"},ref:W},V?u.a.createElement(p.a,{width:window.screen.width,height:V,rowCount:C.length,rowHeight:66,onScroll:({scrollTop:e})=>{$=e,Z&&G?$dispatch(Object(h.S)(0)):ee&&Q?$dispatch(Object(h.R)(0)):te&&X?$dispatch(Object(h.Q)(0)):ie&&Y&&$dispatch(Object(h.L)(0))},scrollTop:ge||void 0,rowRenderer:({key:e,index:t,style:i})=>u.a.createElement("div",{key:e,style:i,className:"music-list",id:Object(N.d)(C[t].filenameOrigin)},me(C[t],t))}):C.map((e,t)=>u.a.createElement("div",{key:e.filenameOrigin,className:"music-list",id:Object(N.d)(e.filenameOrigin)},me(e,t)))),l===j.a.musicOriginal.savedSongs&&u.a.createElement("div",{className:"music-picture"}),!U&&!q&&u.a.createElement(O.default,{fromMusicControl:!0,myMusicPage:J,searchMusicPage:H}))})},561:function(e,t,i){"use strict";i.r(t);var a=i(0),n=i.n(a),s=i(95),r=i(402),l=i(337),c=i(38),o=i(3),u=i(8),m=i(358),d=i(1),g=i(9),p=i(2),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e};window.startToUploadMusic=!1;t.default=Object(s.connect)(e=>({musicList:e.fileServer.musicList,username:e.login.username,token:e.login.token,musicSubmitStatus:e.fileServer.musicSubmitStatus,musicUploadProgress:e.fileServer.musicUploadProgress,setMobile:e.myInfo.setMobile}),()=>({}))(({musicList:e,username:t,token:i,musicSubmitStatus:s,setMobile:O})=>{const[b,h]=Object(a.useState)(null),v=Object(a.useRef)();Object(a.useEffect)(()=>($dispatch(Object(d.ib)(!0)),()=>{$dispatch(Object(d.ib)(!1))}),[]);const y=Object(a.useCallback)(e=>(logger.info("music acceptedFiles"),i?e&&e[0]?void w(e[0]):alert("没有待上传的音乐"):goRoute(void 0,"/login")),[e]),{getRootProps:S,getInputProps:j}=Object(r.a)({onDrop:y}),w=e=>{const t=e.name,i=e.size;if(logger.info("music handleMD5 filename",t,"fileSize",i),/\.mp3$|\.MPEG$|\.OPUS$|\.OGG$|\.OGA$|\.WAV$|\.AAC$|\.CAF$|\.M4A$|\.MP4$|\.WEBA$|\.WEBM$|\.DOLBY$|\.FLAC$/gi.test(t))if(/#|%/g.test(t))alertDialog("文件名不能包含%或#");else{if(!(i>20971520))return $dispatch(Object(d.T)(`${t} 正在读取...`)),Object(g.a)(e).then(t=>{const{MD5Value:i,MD5ValueError:a}=t;logger.info("music handleMD5 MD5Value",i),i&&!a?E(e,i):(logger.error("music handleMD5 no MD5Value"),$dispatch(Object(d.T)("选择一首音乐上传")),alertDialog("音乐读取失败，请更换音乐重试"))}).catch(e=>{$dispatch(Object(d.T)("选择一首音乐上传")),logger.error("music handleMD5 err",e),alertDialog("音乐读取失败，请更换音乐重试")});alertDialog("文件大小超过20M")}else{const e=t.split(".");if(e.length>1){const t=e.pop();alertDialog(`不支持的音乐文件后缀名: .${t}`)}else alertDialog("不支持上传无后缀名的音乐");logger.info("不支持的音乐文件后缀名 filename",t)}},E=(t,i)=>{try{if(!window.startToUploadMusic){window.startToUploadMusic=!0;const a=t.name,s=t.size;let r=!1;$dispatch(Object(d.T)("选择一首音乐上传"));for(const l in e)e[l].filename===a&&(r=!0,Object(o.j)("提示",n.a.createElement(c.a,{textFragment:`已经存在 <span class="delete-alert">${a}</span>(${Number(l)+1}) ，上传将覆盖原音乐`}),"确定",()=>(logger.info("overwrite file true",e[l].filename),N(a,s,i,t)),()=>{logger.info("overwrite file false",e[l].filename),window.startToUploadMusic=!1}));if(!r)return N(a,s,i,t)}}catch(e){window.startToUploadMusic=!1,$dispatch(Object(d.T)("选择一首音乐上传")),logger.error("music uploadMusic err",e),alertDialog("音乐读取失败，请更换音乐重试")}},N=(()=>{var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function a(n,s){try{var r=t[n](s),l=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(l).then(function(e){a("next",e)},function(e){a("throw",e)});e(l)}("next")})}}(function*(e,i,a,n){$dispatch(Object(d.T)(`${e} 开始上传...`));const s=window.webkitURL.createObjectURL(n),r=yield Object(g.g)(e,t||O,a,"default-music","music");if("缺少字段"===r)return window.startToUploadMusic=!1,$dispatch(Object(d.T)("选择一首音乐上传")),alertDialog("缺少字段");if("上传成功"===r)return window.startToUploadMusic=!1,$dispatch(Object(d.T)("选择一首音乐上传")),Object(g.w)({msg:"second upload music success"+e}),alertDialog("秒传成功");if("没有匹配"===r){h(s);let r=0;const l=setInterval(function(){if(++r>100)return clearInterval(l),alertDialog("文件读取错误, 请上传其他文件"),logger.error("文件读取错误, 请上传其他文件 filename, fileSize",e,i),$dispatch(Object(d.T)("选择一首音乐上传")),void(window.startToUploadMusic=!1);const s=v.current.duration;if(logger.info("uploadMusic duration, isNaN(duration)",s,isNaN(s)),!isNaN(s)){logger.info("uploadMusicFunc username, duration, MD5Value",t||O,s,a),clearInterval(l);const i=new FormData;i.append("files",n),i.append("username",t||O),i.append("type","music"),i.append("duration",s),i.append("md5",a),i.append("registrationID",localStorage.getItem("registrationID")||"");const r=new XMLHttpRequest;r.upload.addEventListener("progress",M.bind(this,e),!1),r.addEventListener("error",$,!1),r.open("POST",u.a.uploadFile),r.onreadystatechange=function(){window.startToUploadMusic=!1,logger.info("上传成功"+r.responseText),4===r.readyState&&(200===r.status?"illegal_filetype"===r.responseText.response?alertDialog(`不支持的文件后缀名: ${e.split(".").pop()}`):"illegal_filename"===r.responseText.response?alertDialog("文件名不得含有%或#"):"more_than_100mb"===r.responseText.response?alertDialog("文件大小超过100MB"):alert("上传成功！"):(alertDialog("上传失败"),logger.error("music upload fail xhr",r))),$dispatch(Object(d.T)("选择一首音乐上传"))},r.send(i)}},20)}});return function(t,i,a,n){return e.apply(this,arguments)}})(),M=(e,t)=>{if(t.lengthComputable){const i=Math.round(100*t.loaded/t.total);$dispatch(Object(d.T)(`${i.toString()}% - ${e}`))}else $()},$=()=>{$dispatch(Object(d.T)("选择一首音乐上传")),window.startToUploadMusic=!1,alertDialog("上传失败")};return n.a.createElement("div",{className:"music-container",style:{backgroundColor:e&&e.length?"":"#F2F2F2"}},n.a.createElement(l.a,null),n.a.createElement("div",{className:"music-header"},"音乐列表"),n.a.createElement("div",{className:"upload-area"},n.a.createElement("div",S(),n.a.createElement("input",f({},j(),{multiple:!1})),n.a.createElement("p",null,s))),n.a.createElement("audio",{className:"will-upload-music",ref:v,src:b}),n.a.createElement(m.a,{musicDataList:e,original:p.a.musicOriginal.musicShare,pageType:p.a.musicOriginal.musicShare,height:window.screen.height-120}),!e.length&&n.a.createElement("img",{alt:"",className:"empty-content-pic",src:"./imgs/music.png"}))})}}]);