(window.webpackJsonp=window.webpackJsonp||[]).push([[30,5],{346:function(e,t,a){"use strict";a(96),a(344),a(316)},347:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=g(a(25)),n=g(a(14)),s=g(a(26)),r=m(a(0)),l=m(a(19)),c=g(a(146)),o=g(a(145)),u=g(a(348)),d=g(a(345));function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function g(e){return e&&e.__esModule?e:{default:e}}var p="NORMAL",f="SHARE";function b(){}var O=[];function v(e,t,a){var m=(0,n.default)({prefixCls:"am-action-sheet",cancelButtonText:"取消"},t),g=m.prefixCls,b=m.className,v=m.transitionName,h=m.maskTransitionName,y=m.maskClosable,j=void 0===y||y,S=document.createElement("div");function w(){if(S){l.unmountComponentAtNode(S),S.parentNode&&S.parentNode.removeChild(S);var e=O.indexOf(w);-1!==e&&O.splice(e,1)}}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=a(e,t);i&&i.then?i.then(function(){w()}):w()}document.body.appendChild(S),O.push(w);var N=m.title,M=m.message,$=m.options,P=m.destructiveButtonIndex,x=m.cancelButtonIndex,k=m.cancelButtonText,T=m.badges,L=void 0===T?[]:T,D=[N?r.createElement("h3",{key:"0",className:g+"-title"},N):null,M?r.createElement("div",{key:"1",className:g+"-message"},M):null],F=null,I="normal";switch(e){case p:I="normal";var R=$,C={};L&&L.length>0&&L.forEach(function(e){e.index>=0&&(C[e.index]=r.createElement(d.default,e))}),F=r.createElement("div",(0,u.default)(m),D,r.createElement("div",{className:g+"-button-list",role:"group"},R.map(function(e,t){var a,l={className:(0,s.default)(g+"-button-list-item",(a={},(0,i.default)(a,g+"-destructive-button",P===t),(0,i.default)(a,g+"-cancel-button",x===t),a)),onClick:function(){return E(t)},role:"button"},c=r.createElement("div",l,e);C[t]&&(c=r.createElement("div",(0,n.default)({},l,{className:l.className+" "+g+"-button-list-badge"}),r.createElement("span",{className:g+"-button-list-item-content"},e),C[t]));var u=r.createElement(o.default,{key:t,activeClassName:g+"-button-list-item-active"},c);return x!==t&&P!==t||(u=r.createElement(o.default,{key:t,activeClassName:g+"-button-list-item-active"},r.createElement("div",l,e,x===t?r.createElement("span",{className:g+"-cancel-button-mask"}):null))),u})));break;case f:I="share";var _=$.length&&Array.isArray($[0])||!1,A=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r.createElement("div",{className:g+"-share-list-item",role:"button",key:t,onClick:function(){return E(t,a)}},r.createElement("div",{className:g+"-share-list-item-icon"},e.icon),r.createElement("div",{className:g+"-share-list-item-title"},e.title))};F=r.createElement("div",(0,u.default)(m),D,r.createElement("div",{className:g+"-share"},_?$.map(function(e,t){return r.createElement("div",{key:t,className:g+"-share-list"},e.map(function(e,a){return A(e,a,t)}))}):r.createElement("div",{className:g+"-share-list"},$.map(function(e,t){return A(e,t)})),r.createElement(o.default,{activeClassName:g+"-share-cancel-button-active"},r.createElement("div",{className:g+"-share-cancel-button",role:"button",onClick:function(){return E(-1)}},k))))}var B=(0,s.default)(g+"-"+I,b);return l.render(r.createElement(c.default,{visible:!0,title:"",footer:"",prefixCls:g,className:B,transitionName:v||"am-slide-up",maskTransitionName:h||"am-fade",onClose:function(){return E(x||-1)},maskClosable:j,wrapProps:m.wrapProps||{}},F),S),{close:w}}t.default={showActionSheetWithOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;v(p,e,t)},showShareActionSheetWithOptions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;v(f,e,t)},close:function(){O.forEach(function(e){return e()})}},e.exports=t.default},351:function(e,t,a){"use strict";a(96),a(318)},352:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(a(14)),n=d(a(25)),s=d(a(16)),r=d(a(17)),l=d(a(15)),c=d(a(18)),o=d(a(26)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(0));function d(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){return(0,s.default)(this,t),(0,l.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,r.default)(t,[{key:"componentWillReceiveProps",value:function(){this.noAppearTransition=!0}},{key:"componentDidMount",value:function(){var e=this;this.props.appearTransition&&setTimeout(function(){e.barRef&&(e.barRef.style.width=e.props.percent+"%")},10)}},{key:"render",value:function(){var e,t=this,a=this.props,s=a.className,r=a.prefixCls,l=a.position,c=a.unfilled,d=a.style,m=void 0===d?{}:d,g=a.barStyle,p=void 0===g?{}:g,f={width:this.noAppearTransition||!this.props.appearTransition?this.props.percent+"%":0,height:0},b=(0,o.default)(r+"-outer",s,(e={},(0,n.default)(e,r+"-fixed-outer","fixed"===l),(0,n.default)(e,r+"-hide-outer",!c),e));return u.createElement("div",{style:m,className:b,role:"progressbar","aria-valuenow":this.props.percent,"aria-valuemin":0,"aria-valuemax":100},u.createElement("div",{ref:function(e){return t.barRef=e},className:r+"-bar",style:(0,i.default)({},p,f)}))}}]),t}(u.Component);t.default=m,m.defaultProps={prefixCls:"am-progress",percent:0,position:"fixed",unfilled:!0,appearTransition:!1},e.exports=t.default},356:function(e,t,a){"use strict";a(351);var i=a(352),n=a.n(i),s=(a(346),a(347)),r=a.n(s),l=(a(149),a(69)),c=a.n(l),o=a(0),u=a.n(o),d=a(95),m=a(4),g=a(98),p=a(359),f=a(8),b=a(369),O=a(38),v=a(1),h=a(3),y=a(10),j=a(9),S=a(2),w=a(31),E=a(24),N=a(34);let M;new RegExp("\\biPhone\\b|\\biPod\\b","i").test(navigator.userAgent)&&(M={onTouchStart:e=>e.preventDefault()});let $=0;const P={action:null};t.a=Object(d.connect)(e=>({soundPlaying:e.fileServer.soundPlaying,soundInstance:e.fileServer.soundInstance,currentPlayingSong:e.fileServer.currentPlayingSong,currentSongTime:e.fileServer.currentSongTime,pauseWhenOver:e.fileServer.pauseWhenOver,playByOrder:e.fileServer.playByOrder,musicCollection:e.fileServer.musicCollection,musicMenuBadge:e.fileServer.musicMenuBadge,username:e.login.username,token:e.login.token,playByRandom:e.fileServer.playByRandom,lastMusicSearchResult:e.fileServer.lastMusicSearchResult,lastSearchAllMusicResult:e.fileServer.lastSearchAllMusicResult,downloadingMusicItems:e.fileServer.downloadingMusicItems,downloadedMusicList:e.fileServer.downloadedMusicList,currentPlayingSongOriginal:e.fileServer.currentPlayingSongOriginal,recentMusicList:e.fileServer.recentMusicList,setMobile:e.myInfo.setMobile,showMusicPlayingFromMusicControl:e.fileServer.showMusicPlayingFromMusicControl,notExistMusicPlayingPage:e.fileServer.notExistMusicPlayingPage,musicPlayListData:e.fileServer.musicPlayListData,musicSharePosition:e.fileServer.musicSharePosition,musicSavePosition:e.fileServer.musicSavePosition,musicRecentPosition:e.fileServer.musicRecentPosition,musicHomePosition:e.fileServer.musicHomePosition,mySongList:e.fileServer.mySongList}),()=>({}))(({original:e,soundInstance:t,currentPlayingSong:a,currentSongTime:i,soundPlaying:s,pageType:l,pauseWhenOver:d,playByOrder:x,musicCollection:k=[],musicMenuBadge:T,username:L,token:D,playByRandom:F,setMobile:I,musicDataList:R,lastMusicSearchResult:C,lastSearchAllMusicResult:_,recentMusicList:A,noShowMusicPlaying:B=!1,myMusicPage:U=!1,searchMusicPage:J=!1,notExistMusicPlayingPage:H=!1,musicPlayerRef:q,musicPlayListData:W,height:z,musicSharePosition:G,musicSavePosition:Q,musicRecentPosition:V,musicHomePosition:X,mySongList:Y})=>{const K=Object(N.n)(),Z=Object(N.m)(),ee=Object(N.l)(),te=Object(N.k)(),ae=Object(m.useHistory)();Object(o.useEffect)(()=>(g.Howler.volume(.8),e!==S.a.musicOriginal.musicDownloading&&t&&Object(j.t)(),document.addEventListener("deviceready",ie,!1),()=>{K?$dispatch(Object(v.S)($)):Z?$dispatch(Object(v.R)($)):ee?$dispatch(Object(v.Q)($)):te&&$dispatch(Object(v.L)($)),document.removeEventListener("deviceready",ie,!1),document.removeEventListener("backbutton",ne,!1)}),[]);const ie=()=>{document.addEventListener("backbutton",ne,!1)},ne=()=>{if(!window.cancelMenuFirst&&!window.specialBack)if($getState().fileServer.showMusicPlayingFromMusicControl||Object(h.h)())Object(h.z)();else if(U)Object(h.b)("/my_song_lists_detail"===getRoute()?"/my_song_lists_page":"/my_download_middle_page",!0);else{if(!J)return;Object(h.b)("/search_column",!0)}},se=()=>{window.cancelMenuFirst=!0,document.addEventListener("backbutton",le)},re=()=>{window.cancelMenuFirst&&(window.cancelMenuFirst=!1,document.removeEventListener("backbutton",le),document.removeEventListener("deviceready",se),document.addEventListener("backbutton",h.r))},le=()=>{const e=document.querySelector(".am-action-sheet-button-list div:nth-last-child(1)");e&&e.click(),P.action&&(P.action.close(),P.action=null),re()},ce=(e,t,a,i,n,s,r)=>{Object(h.j)("提示",u.a.createElement(O.a,{textFragment:`确定从本地删除 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>Object(j.G)(Object(j.H)(t),"music").then(()=>{oe(s,t),t===a&&Object(j.q)(i,n,s,r)}).catch(e=>{logger.error("删除音乐过程中发生了错误 isFileFinished",e.stack||e.toString()),Object(h.q)(e,`musicPlayer removeFileFromDownload filenameOrigin: ${t}`)}))},oe=(e,t)=>{if(e===S.a.musicOriginal.musicSearch){let e,a;C.some((a,i)=>Object(j.H)(a.filenameOrigin)===Object(j.H)(t)&&(e=i,!0));const i=JSON.parse(JSON.stringify(C));i.splice(e,1),_.some((e,i)=>Object(j.H)(e.filenameOrigin)===Object(j.H)(t)&&(a=i,!0));const n=JSON.parse(JSON.stringify(_));n.splice(a,1),$dispatch(Object(v.y)(i)),$dispatch(Object(v.G)(n))}},ue=(m,g)=>u.a.createElement(o.Fragment,null,u.a.createElement("div",{className:"music-content",onClick:()=>Object(j.o)({filePath:m.filePath,filename:m.filename,filenameOrigin:m.filenameOrigin,uploadUsername:m.uploadUsername,fileSize:m.fileSize,duration:m.duration,songOriginal:m.original,original:e,musicDataList:R,pageType:l,payPlay:Number(m.payPlay),musicId:m.id,songInfo:m})},u.a.createElement("div",{className:`num ${Object(h.d)(g+1)}`},g+1),u.a.createElement("div",{className:"music-info"},u.a.createElement("div",{className:`info ${m.saved&&l!==S.a.musicOriginal.savedSongs?"song-saved":""}`},u.a.createElement("div",{className:`filename ${de?m.saved?"downloading-save":"downloading":""}`,dangerouslySetInnerHTML:{__html:Object(j.s)(m.filename)}}),Number(m.payPlay)?u.a.createElement("i",{className:"fa fa-lock copyright-song-flag","aria-hidden":"true"}):"",m.saved&&l!==S.a.musicOriginal.savedSongs&&u.a.createElement("i",{className:"fa fa-heart saved-song-flag","aria-hidden":"true"}),e!==S.a.musicOriginal.homeRecommend&&"onlineMusic"!==l&&"onlineMusicSearchALl"!==l?m.original===S.a.musicOriginal.netEaseCloud||m.original===S.a.musicOriginal.homeRecommend?u.a.createElement("div",{className:"net-ease-source-flag"},"网易云"):m.original===S.a.musicOriginal.qqMusic?u.a.createElement("div",{className:"qq-music-source-flag"},"QQ音乐"):m.original===S.a.musicOriginal.kuGouMusic?u.a.createElement("div",{className:"ku-gou-music-source-flag"},"酷狗音乐"):m.original===S.a.musicOriginal.kuWoMusic?u.a.createElement("div",{className:"ku-wo-music-source-flag"},"酷我音乐"):null:null,m.mvId?u.a.createElement("i",{className:"fa fa-youtube-play","aria-hidden":"true",onClick:e=>((e,t,a,i)=>{e.stopPropagation(),ae.push({pathname:"/music_mv_Player",query:{mvId:t,original:a,filename:Object(j.J)(i),lastLocation:getRoute()}})})(e,m.mvId,m.original,m.filename)}):null,de?u.a.createElement("div",{className:"song-duration-time downloading"},m.progress):null),a===m.filenameOrigin?((e,t,a)=>u.a.createElement("div",{className:"audio-player"},u.a.createElement("audio",{preload:"auto",className:"audio-selector"},u.a.createElement("source",{src:e})),u.a.createElement("div",{className:"audio-player-time audio-player-time-current"},Object(j.Q)(t)),u.a.createElement("div",{className:"audio-player-bar"},u.a.createElement("div",{className:"audio-player-bar-loaded",style:{width:"100%"}}),u.a.createElement("div",{className:"audio-player-bar-played",style:{width:t/a*100+"%"}})),u.a.createElement("div",{className:"audio-player-time audio-player-time-duration"},Object(j.Q)(a))))(m.filePath,i,m.duration):u.a.createElement("div",{className:"upload-duration"},u.a.createElement("div",{className:`upload-user ${de?"downloading":""}`},m.uploadUsername||"未知",(t=>t?e!==S.a.musicOriginal.musicDownloading?("number"==typeof t&&(t=new Date(t).format("yyyy-MM-dd")),e===S.a.musicOriginal.musicShare||e===S.a.musicOriginal.musicSearch||e===S.a.musicOriginal.musicFinished?" "+t.split(" ")[0]:""):void 0:"")(m.date)),de?u.a.createElement("div",{className:"download-progress"},u.a.createElement(n.a,{percent:m.received?m.received/m.fileSize*100:0,position:"normal"})):u.a.createElement("div",{className:`song-duration-time ${Object(h.d)(g+1)}`},Object(j.Q)(m.duration)))),!s&&e!==S.a.musicOriginal.musicDownloading&&a===m.filenameOrigin&&u.a.createElement("div",{className:"pause-button-overlay"},u.a.createElement("div",{className:"pause-button"},u.a.createElement("div",{className:"triangle"})))),e!==S.a.musicOriginal.musicDownloading?u.a.createElement("div",{className:"menu",onClick:((i,n,o,m,g,p,b,E,N,$,C,_)=>{const B=c.a.operation;document.removeEventListener("backbutton",h.r,!1),document.addEventListener("deviceready",se),i=Object(j.J)(i);const U=JSON.parse(JSON.stringify(T)),J=k.map(e=>Object(j.H)(e.filenameOrigin)),H=["播放",-1!==J.indexOf(Object(j.H)(o))?"已收藏":"收藏","单曲播放","单曲循环","顺序播放","随机播放","添加到播放列表","添加到歌单","下载","删除","取消"];s&&o===a&&(H[0]="暂停"),$=e===S.a.musicOriginal.musicShare||e===S.a.musicOriginal.musicSearch?` ${$}`:"";const q={options:H,cancelButtonIndex:H.length-1,destructiveButtonIndex:H.length-2,badges:U,message:n?`大小: ${Object(j.b)(n)}${$}`:$,title:i,maskClosable:!0,"data-seed":"logId",wrapProps:M};e===S.a.musicOriginal.musicFinished?(H.splice(8,1),q.destructiveButtonIndex=H.length-2):(l!==S.a.musicOriginal.savedSongs&&"onlineMusic"!==l&&"onlineMusicSearchALl"!==l&&l!==S.a.musicOriginal.homeRecommend&&l!==S.a.musicOriginal.musicPlayList||(H.splice(9,1),delete q.destructiveButtonIndex,l===S.a.musicOriginal.musicPlayList&&(H[6]="移除")),E&&U.push({index:8,text:"版"})),r.a.showActionSheetWithOptions(q,s=>{logger.info("music player showMenu buttonIndex",s);const r=R.map(e=>e.filenameOrigin),c=r.indexOf(o);if(-1===c)return logger.error("showActionSheetWithOptions currentFileIndex === -1 filename",i),alert(i+"已被删除");const M=R[c].filePath;switch(s){case 0:Object(j.o)({filePath:M,filename:i,filenameOrigin:o,uploadUsername:m,fileSize:n,duration:g,songOriginal:p,original:e,musicDataList:R,pageType:l,payPlay:b,musicId:N,songInfo:_});break;case 1:Object(j.O)({savedMusicFilenameOriginalArr:J,filenameOrigin:o,musicCollection:k,musicDataList:R,currentFileIndex:c,original:e,e:null,pageType:l});break;case 2:(!d||x||F)&&(t&&t.loop(!1),$dispatch(Object(v.jb)(!0)),$dispatch(Object(v.kb)(!1)),$dispatch(Object(v.lb)(!1)),alert("单曲播放"),$dispatch(Object(v.N)([{index:2,text:"✔️"},{index:3,text:""},{index:4,text:""},{index:5,text:""}])));break;case 3:d&&(t&&t.loop(!0),$dispatch(Object(v.jb)(!1)),$dispatch(Object(v.kb)(!1)),$dispatch(Object(v.lb)(!1)),alert("单曲循环"),$dispatch(Object(v.N)([{index:2,text:""},{index:3,text:"✔️"},{index:4,text:""},{index:5,text:""}])));break;case 4:x||(t&&t.loop(!1),$dispatch(Object(v.jb)(!0)),$dispatch(Object(v.kb)(!0)),$dispatch(Object(v.lb)(!1)),alert("顺序播放"),$dispatch(Object(v.N)([{index:2,text:""},{index:3,text:""},{index:4,text:"✔️"},{index:5,text:""}])));break;case 5:F||(t&&t.loop(!1),$dispatch(Object(v.jb)(!0)),$dispatch(Object(v.kb)(!1)),$dispatch(Object(v.lb)(!0)),alert("随机播放"),$dispatch(Object(v.N)([{index:2,text:""},{index:3,text:""},{index:4,text:""},{index:5,text:"✔️"}])));break;case 6:{let e=JSON.parse(JSON.stringify(W));if(l!==S.a.musicOriginal.musicPlayList){if(b&&!$getState().myInfo.setMusicVip)return alert("不可以添加有版权的音乐");{let t=JSON.parse(JSON.stringify(_));t.pageType=l,e.push(t);const a={};e=e.filter(e=>!a[e.filenameOrigin]&&(a[e.filenameOrigin]=!0,!0)),t=null,alert("添加成功")}}else e=e.filter(e=>e.filenameOrigin!==_.filenameOrigin),alert("已取消");$dispatch(Object(v.P)(e));break}case 7:if(Object.keys(Y).length){const e=Object(j.y)({musicDataList:R,currentFileIndex:c,filenameOrigin:o,operationAction:P,removeListenBackFunc:re});if(e.length)return void(P.action=B(e));alert("没有其他歌单了");break}alert("请先创建歌单");break;case 8:e===S.a.musicOriginal.musicFinished?ce(i,o,a,c,r,e,R):Object(j.N)({musicDataList:R,filename:i,uploadUsername:m,fileSize:n,musicSrc:M,filenameOrigin:o,duration:g,songOriginal:p,musicId:N,payDownload:E,mvId:_.mvId,md5:_.md5,albumId:_.albumId});break;case 9:{if(re(),"onlineMusic"===l||"onlineMusicSearchALl"===l||e===S.a.musicOriginal.musicFinished)return;if(!D)return goRoute(void 0,"/login");const t={username:L||I,token:D,filename:i,type:"default-music"};return void(e!==S.a.musicOriginal.musicShare&&e!==S.a.musicOriginal.musicSearch||"downloaded"===C?e===S.a.musicOriginal.musicRecent?Object(h.j)("提示",u.a.createElement(O.a,{textFragment:`确定要删除 <span class="delete-alert">${i}</span> 的播放记录吗`}),"确定",()=>{let t=null;if(A.some((e,a)=>e.filenameOrigin===o&&(t=a,!0)),null!==t){const i=JSON.parse(JSON.stringify(A));if(i.splice(t,1),$dispatch(Object(v.nb)(i)),Object(w.c)(o),o===a){const t=JSON.parse(JSON.stringify(A));Object(j.q)(c,r,e,t)}}else logger.error("确定要删除播放记录吗 filenameOrigin, recentMusicList",o,A)}):"downloaded"===C?ce(i,o,a,c,r,e,R):l===S.a.musicOriginal.myMusicListPage&&Object(j.I)(o,i):Object(h.j)("提示",u.a.createElement(O.a,{textFragment:`确定要从服务器删除 <span class="delete-alert">${i}</span> 吗`}),"确定",()=>(Object(h.B)(),axios.delete(f.a.delFile,{data:t}).then(t=>{if(window.toast.hide(),!window.cancelAxiosRequest)return"success"===t.result?($dispatch(Object(y.j)(t.token)),alert("删除成功"),oe(e,o)):"file_deleted"===t.result?(alert("文件已删除!"),oe(e,o)):void logger.error("HTTP_URL.delFile result",t)}).then(()=>{o===a&&Object(j.q)(c,r,e,R)}).catch(e=>{logger.error("HTTP_URL.delFile err",e),Object(h.q)(e,`musicPlayer delFile filenameOrigin: ${o}`)}).finally(()=>{window.cancelAxiosRequest=!1}))))}}re()})}).bind(void 0,m.filename,m.fileSize,m.filenameOrigin,m.uploadUsername,m.duration,m.original,Number(m.payPlay),Number(m.payDownload),m.id,m.date,m.status,m)},u.a.createElement("div",{className:"dot"}),u.a.createElement("div",{className:"dot"}),u.a.createElement("div",{className:"dot"})):u.a.createElement("div",{className:"move-downloading-item fa fa-remove",onClick:((e,t)=>{Object(h.j)("提示",u.a.createElement(O.a,{textFragment:`确定要移除下载 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>{const e=Object(j.H)(t);window.eventEmit.$emit(`FileTransfer-${e}`,"abort"),window[`remove-download-${e}`]=!0,setTimeout(()=>{},500);const{downloadingMusicItems:a}=$getState().fileServer,i=JSON.parse(JSON.stringify(a));for(const e in a)if(Object.prototype.hasOwnProperty.call(a,e)&&a[e].filenameOrigin===t){i.splice(e,1),$dispatch(Object(v.o)(i)),Object(E.c)(t);break}logger.info("saveFileToLocal param, downloadingMusicItems",a)})}).bind(void 0,m.filename,m.filenameOrigin)}));Object(j.n)(R,l);const de=e===S.a.musicOriginal.musicDownloading;let me=0;return K&&G?me=G:Z&&Q?me=Q:ee&&V?me=V:te&&X&&(me=X),u.a.createElement(o.Fragment,null,u.a.createElement("div",{className:"music-list-container",style:{height:l===S.a.musicOriginal.musicFinished?"auto":"100%"},ref:q},z?u.a.createElement(p.a,{width:window.screen.width,height:z,rowCount:R.length,rowHeight:66,onScroll:({scrollTop:e})=>{$=e,K&&G?$dispatch(Object(v.S)(0)):Z&&Q?$dispatch(Object(v.R)(0)):ee&&V?$dispatch(Object(v.Q)(0)):te&&X&&$dispatch(Object(v.L)(0))},scrollTop:me||void 0,rowRenderer:({key:e,index:t,style:a})=>u.a.createElement("div",{key:e,style:a,className:"music-list",id:Object(N.d)(R[t].filenameOrigin)},ue(R[t],t))}):R.map((e,t)=>u.a.createElement("div",{key:e.filenameOrigin,className:"music-list",id:Object(N.d)(e.filenameOrigin)},ue(e,t)))),l===S.a.musicOriginal.savedSongs&&u.a.createElement("div",{className:"music-picture"}),!B&&!H&&u.a.createElement(b.default,{fromMusicControl:!0,myMusicPage:U,searchMusicPage:J}))})},559:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),s=a(95),r=a(400),l=a(335),c=a(38),o=a(3),u=a(8),d=a(356),m=a(1),g=a(9),p=a(2),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};window.startToUploadMusic=!1;t.default=Object(s.connect)(e=>({musicList:e.fileServer.musicList,username:e.login.username,token:e.login.token,musicSubmitStatus:e.fileServer.musicSubmitStatus,musicUploadProgress:e.fileServer.musicUploadProgress,setMobile:e.myInfo.setMobile}),()=>({}))(({musicList:e,username:t,token:a,musicSubmitStatus:s,setMobile:b})=>{const[O,v]=Object(i.useState)(null),h=Object(i.useRef)();Object(i.useEffect)(()=>($dispatch(Object(m.ib)(!0)),()=>{$dispatch(Object(m.ib)(!1))}),[]);const y=Object(i.useCallback)(e=>(logger.info("music acceptedFiles"),a?e&&e[0]?void w(e[0]):alert("没有待上传的音乐"):goRoute(void 0,"/login")),[e]),{getRootProps:j,getInputProps:S}=Object(r.a)({onDrop:y}),w=e=>{const t=e.name,a=e.size;if(logger.info("music handleMD5 filename",t,"fileSize",a),/\.mp3$|\.MPEG$|\.OPUS$|\.OGG$|\.OGA$|\.WAV$|\.AAC$|\.CAF$|\.M4A$|\.MP4$|\.WEBA$|\.WEBM$|\.DOLBY$|\.FLAC$/gi.test(t))if(/#|%/g.test(t))alertDialog("文件名不能包含%或#");else{if(!(a>20971520))return $dispatch(Object(m.T)(`${t} 正在读取...`)),Object(g.a)(e).then(t=>{const{MD5Value:a,MD5ValueError:i}=t;logger.info("music handleMD5 MD5Value",a),a&&!i?E(e,a):(logger.error("music handleMD5 no MD5Value"),$dispatch(Object(m.T)("选择一首音乐上传")),alertDialog("音乐读取失败，请更换音乐重试"))}).catch(e=>{$dispatch(Object(m.T)("选择一首音乐上传")),logger.error("music handleMD5 err",e),alertDialog("音乐读取失败，请更换音乐重试")});alertDialog("文件大小超过20M")}else{const e=t.split(".");if(e.length>1){const t=e.pop();alertDialog(`不支持的音乐文件后缀名: .${t}`)}else alertDialog("不支持上传无后缀名的音乐");logger.info("不支持的音乐文件后缀名 filename",t)}},E=(t,a)=>{try{if(!window.startToUploadMusic){window.startToUploadMusic=!0;const i=t.name,s=t.size;let r=!1;$dispatch(Object(m.T)("选择一首音乐上传"));for(const l in e)e[l].filename===i&&(r=!0,Object(o.j)("提示",n.a.createElement(c.a,{textFragment:`已经存在 <span class="delete-alert">${i}</span>(${Number(l)+1}) ，上传将覆盖原音乐`}),"确定",()=>(logger.info("overwrite file true",e[l].filename),N(i,s,a,t)),()=>{logger.info("overwrite file false",e[l].filename),window.startToUploadMusic=!1}));if(!r)return N(i,s,a,t)}}catch(e){window.startToUploadMusic=!1,$dispatch(Object(m.T)("选择一首音乐上传")),logger.error("music uploadMusic err",e),alertDialog("音乐读取失败，请更换音乐重试")}},N=(()=>{var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function i(n,s){try{var r=t[n](s),l=r.value}catch(e){return void a(e)}if(!r.done)return Promise.resolve(l).then(function(e){i("next",e)},function(e){i("throw",e)});e(l)}("next")})}}(function*(e,a,i,n){$dispatch(Object(m.T)(`${e} 开始上传...`));const s=window.webkitURL.createObjectURL(n),r=yield Object(g.g)(e,t||b,i,"default-music","music");if("缺少字段"===r)return window.startToUploadMusic=!1,$dispatch(Object(m.T)("选择一首音乐上传")),alertDialog("缺少字段");if("上传成功"===r)return window.startToUploadMusic=!1,$dispatch(Object(m.T)("选择一首音乐上传")),Object(g.w)({msg:"second upload music success"+e}),alertDialog("秒传成功");if("没有匹配"===r){v(s);let r=0;const l=setInterval(function(){if(++r>100)return clearInterval(l),alertDialog("文件读取错误, 请上传其他文件"),logger.error("文件读取错误, 请上传其他文件 filename, fileSize",e,a),$dispatch(Object(m.T)("选择一首音乐上传")),void(window.startToUploadMusic=!1);const s=h.current.duration;if(logger.info("uploadMusic duration, isNaN(duration)",s,isNaN(s)),!isNaN(s)){logger.info("uploadMusicFunc username, duration, MD5Value",t||b,s,i),clearInterval(l);const a=new FormData;a.append("files",n),a.append("username",t||b),a.append("type","music"),a.append("duration",s),a.append("md5",i),a.append("registrationID",localStorage.getItem("registrationID")||"");const r=new XMLHttpRequest;r.upload.addEventListener("progress",M.bind(this,e),!1),r.addEventListener("error",$,!1),r.open("POST",u.a.uploadFile),r.onreadystatechange=function(){window.startToUploadMusic=!1,logger.info("上传成功"+r.responseText),4===r.readyState&&(200===r.status?"illegal_filetype"===r.responseText.response?alertDialog(`不支持的文件后缀名: ${e.split(".").pop()}`):"illegal_filename"===r.responseText.response?alertDialog("文件名不得含有%或#"):"more_than_100mb"===r.responseText.response?alertDialog("文件大小超过100MB"):alert("上传成功！"):(alertDialog("上传失败"),logger.error("music upload fail xhr",r))),$dispatch(Object(m.T)("选择一首音乐上传"))},r.send(a)}},20)}});return function(t,a,i,n){return e.apply(this,arguments)}})(),M=(e,t)=>{if(t.lengthComputable){const a=Math.round(100*t.loaded/t.total);$dispatch(Object(m.T)(`${a.toString()}% - ${e}`))}else $()},$=()=>{$dispatch(Object(m.T)("选择一首音乐上传")),window.startToUploadMusic=!1,alertDialog("上传失败")};return n.a.createElement("div",{className:"music-container",style:{backgroundColor:e&&e.length?"":"#F2F2F2"}},n.a.createElement(l.a,null),n.a.createElement("div",{className:"music-header"},"音乐列表"),n.a.createElement("div",{className:"upload-area"},n.a.createElement("div",j(),n.a.createElement("input",f({},S(),{multiple:!1})),n.a.createElement("p",null,s))),n.a.createElement("audio",{className:"will-upload-music",ref:h,src:O}),n.a.createElement(d.a,{musicDataList:e,original:p.a.musicOriginal.musicShare,pageType:p.a.musicOriginal.musicShare,height:window.screen.height-170}),!e.length&&n.a.createElement("img",{alt:"",className:"empty-content-pic",src:"./imgs/music.png"}))})}}]);