(window.webpackJsonp=window.webpackJsonp||[]).push([[72,5],{358:function(e,t,a){"use strict";a(353);var i=a(354),s=a.n(i),n=(a(348),a(349)),o=a.n(n),r=(a(150),a(69)),c=a.n(r),l=a(0),m=a.n(l),d=a(95),u=a(4),p=a(98),g=a(361),h=a(8),f=a(371),O=a(38),b=a(1),v=a(3),w=a(11),S=a(9),y=a(2),j=a(31),N=a(24),k=a(34);let P;new RegExp("\\biPhone\\b|\\biPod\\b","i").test(navigator.userAgent)&&(P={onTouchStart:e=>e.preventDefault()});let E=0;const $={action:null};t.a=Object(d.connect)(e=>({soundPlaying:e.fileServer.soundPlaying,soundInstance:e.fileServer.soundInstance,currentPlayingSong:e.fileServer.currentPlayingSong,currentSongTime:e.fileServer.currentSongTime,pauseWhenOver:e.fileServer.pauseWhenOver,playByOrder:e.fileServer.playByOrder,musicCollection:e.fileServer.musicCollection,musicMenuBadge:e.fileServer.musicMenuBadge,username:e.login.username,token:e.login.token,playByRandom:e.fileServer.playByRandom,lastMusicSearchResult:e.fileServer.lastMusicSearchResult,lastSearchAllMusicResult:e.fileServer.lastSearchAllMusicResult,downloadingMusicItems:e.fileServer.downloadingMusicItems,downloadedMusicList:e.fileServer.downloadedMusicList,currentPlayingSongOriginal:e.fileServer.currentPlayingSongOriginal,recentMusicList:e.fileServer.recentMusicList,setMobile:e.myInfo.setMobile,setPermisssions:e.myInfo.setPermisssions,showMusicPlayingFromMusicControl:e.fileServer.showMusicPlayingFromMusicControl,notExistMusicPlayingPage:e.fileServer.notExistMusicPlayingPage,musicPlayListData:e.fileServer.musicPlayListData,musicSharePosition:e.fileServer.musicSharePosition,musicSavePosition:e.fileServer.musicSavePosition,musicRecentPosition:e.fileServer.musicRecentPosition,musicHomePosition:e.fileServer.musicHomePosition,mySongList:e.fileServer.mySongList}),()=>({}))(({original:e,soundInstance:t,currentPlayingSong:a,currentSongTime:i,soundPlaying:n,pageType:r,pauseWhenOver:d,playByOrder:R,musicCollection:x=[],musicMenuBadge:T,username:F,token:L,playByRandom:I,setMobile:M,setPermisssions:U,musicDataList:A,lastMusicSearchResult:D,lastSearchAllMusicResult:C,recentMusicList:B,noShowMusicPlaying:H=!1,myMusicPage:W=!1,searchMusicPage:_=!1,notExistMusicPlayingPage:q=!1,musicPlayerRef:z,musicPlayListData:V,height:J,musicSharePosition:G,musicSavePosition:K,musicRecentPosition:Q,musicHomePosition:X,mySongList:Y})=>{const Z=Object(k.n)(),ee=Object(k.m)(),te=Object(k.l)(),ae=Object(k.k)(),ie=Object(u.useHistory)();Object(l.useEffect)(()=>(p.Howler.volume(.8),e!==y.a.musicOriginal.musicDownloading&&t&&Object(S.t)(),document.addEventListener("deviceready",se,!1),()=>{Z?$dispatch(Object(b.S)(E)):ee?$dispatch(Object(b.R)(E)):te?$dispatch(Object(b.Q)(E)):ae&&$dispatch(Object(b.L)(E)),document.removeEventListener("deviceready",se,!1),document.removeEventListener("backbutton",ne,!1)}),[]);const se=()=>{document.addEventListener("backbutton",ne,!1)},ne=()=>{if(!window.cancelMenuFirst&&!window.specialBack)if($getState().fileServer.showMusicPlayingFromMusicControl||Object(v.h)())Object(v.z)();else if(W)Object(v.b)("/my_song_lists_detail"===getRoute()?"/my_song_lists_page":"/my_download_middle_page",!0);else{if(!_)return;Object(v.b)("/search_column",!0)}},oe=()=>{window.cancelMenuFirst=!0,document.addEventListener("backbutton",ce)},re=()=>{window.cancelMenuFirst&&(window.cancelMenuFirst=!1,document.removeEventListener("backbutton",ce),document.removeEventListener("deviceready",oe),document.addEventListener("backbutton",v.r))},ce=()=>{const e=document.querySelector(".am-action-sheet-button-list div:nth-last-child(1)");e&&e.click(),$.action&&($.action.close(),$.action=null),re()},le=(e,t,a,i,s,n,o)=>{Object(v.j)("提示",m.a.createElement(O.a,{textFragment:`确定从本地删除 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>Object(S.G)(Object(S.H)(t),"music").then(()=>{me(n,t),t===a&&Object(S.q)(i,s,n,o)}).catch(e=>{logger.error("删除音乐过程中发生了错误 isFileFinished",e.stack||e.toString()),Object(v.q)(e,`musicPlayer removeFileFromDownload filenameOrigin: ${t}`)}))},me=(e,t)=>{if(e===y.a.musicOriginal.musicSearch){let e,a;D.some((a,i)=>Object(S.H)(a.filenameOrigin)===Object(S.H)(t)&&(e=i,!0));const i=JSON.parse(JSON.stringify(D));i.splice(e,1),C.some((e,i)=>Object(S.H)(e.filenameOrigin)===Object(S.H)(t)&&(a=i,!0));const s=JSON.parse(JSON.stringify(C));s.splice(a,1),$dispatch(Object(b.y)(i)),$dispatch(Object(b.G)(s))}},de=(u,p)=>m.a.createElement(l.Fragment,null,m.a.createElement("div",{className:"music-content",onClick:()=>Object(S.o)({filePath:u.filePath,filename:u.filename,filenameOrigin:u.filenameOrigin,uploadUsername:u.uploadUsername,fileSize:u.fileSize,duration:u.duration,songOriginal:u.original,original:e,musicDataList:A,pageType:r,payPlay:Number(u.payPlay),musicId:u.id,songInfo:u})},m.a.createElement("div",{className:`num ${Object(v.d)(p+1)}`},p+1),m.a.createElement("div",{className:"music-info"},m.a.createElement("div",{className:`info ${u.saved&&r!==y.a.musicOriginal.savedSongs?"song-saved":""}`},m.a.createElement("div",{className:`filename ${ue?u.saved?"downloading-save":"downloading":""}`,dangerouslySetInnerHTML:{__html:Object(S.s)(u.filename)}}),Number(u.payPlay)?m.a.createElement("i",{className:"fa fa-lock copyright-song-flag","aria-hidden":"true"}):"",u.saved&&r!==y.a.musicOriginal.savedSongs&&m.a.createElement("i",{className:"fa fa-heart saved-song-flag","aria-hidden":"true"}),e!==y.a.musicOriginal.homeRecommend&&"onlineMusic"!==r&&"onlineMusicSearchALl"!==r?u.original===y.a.musicOriginal.netEaseCloud||u.original===y.a.musicOriginal.homeRecommend?m.a.createElement("div",{className:"net-ease-source-flag"},"网易云"):u.original===y.a.musicOriginal.qqMusic?m.a.createElement("div",{className:"qq-music-source-flag"},"QQ音乐"):u.original===y.a.musicOriginal.kuGouMusic?m.a.createElement("div",{className:"ku-gou-music-source-flag"},"酷狗音乐"):u.original===y.a.musicOriginal.kuWoMusic?m.a.createElement("div",{className:"ku-wo-music-source-flag"},"酷我音乐"):null:null,u.mvId?m.a.createElement("i",{className:"fa fa-youtube-play","aria-hidden":"true",onClick:e=>((e,t,a,i)=>{e.stopPropagation(),ie.push({pathname:"/music_mv_Player",query:{mvId:t,original:a,filename:Object(S.J)(i),lastLocation:getRoute()}})})(e,u.mvId,u.original,u.filename)}):null,ue?m.a.createElement("div",{className:"song-duration-time downloading"},u.progress):null),a===u.filenameOrigin?((e,t,a)=>m.a.createElement("div",{className:"audio-player"},m.a.createElement("audio",{preload:"auto",className:"audio-selector"},m.a.createElement("source",{src:e})),m.a.createElement("div",{className:"audio-player-time audio-player-time-current"},Object(S.Q)(t)),m.a.createElement("div",{className:"audio-player-bar"},m.a.createElement("div",{className:"audio-player-bar-loaded",style:{width:"100%"}}),m.a.createElement("div",{className:"audio-player-bar-played",style:{width:t/a*100+"%"}})),m.a.createElement("div",{className:"audio-player-time audio-player-time-duration"},Object(S.Q)(a))))(u.filePath,i,u.duration):m.a.createElement("div",{className:"upload-duration"},m.a.createElement("div",{className:`upload-user ${ue?"downloading":""}`},u.uploadUsername||"未知",(t=>t?e!==y.a.musicOriginal.musicDownloading?("number"==typeof t&&(t=new Date(t).format("yyyy-MM-dd")),e===y.a.musicOriginal.musicShare||e===y.a.musicOriginal.musicSearch||e===y.a.musicOriginal.musicFinished?" "+t.split(" ")[0]:""):void 0:"")(u.date)),ue?m.a.createElement("div",{className:"download-progress"},m.a.createElement(s.a,{percent:u.received?u.received/u.fileSize*100:0,position:"normal"})):m.a.createElement("div",{className:`song-duration-time ${Object(v.d)(p+1)}`},Object(S.Q)(u.duration)))),!n&&e!==y.a.musicOriginal.musicDownloading&&a===u.filenameOrigin&&m.a.createElement("div",{className:"pause-button-overlay"},m.a.createElement("div",{className:"pause-button"},m.a.createElement("div",{className:"triangle"})))),e!==y.a.musicOriginal.musicDownloading?m.a.createElement("div",{className:"menu",onClick:((i,s,l,u,p,g,f,N,k,E,D,C)=>{const H=c.a.operation;document.removeEventListener("backbutton",v.r,!1),document.addEventListener("deviceready",oe),i=Object(S.J)(i);const W=JSON.parse(JSON.stringify(T)),_=x.map(e=>Object(S.H)(e.filenameOrigin)),q=["播放",-1!==_.indexOf(Object(S.H)(l))?"已收藏":"收藏","单曲播放","单曲循环","顺序播放","随机播放","添加到播放列表","添加到歌单","下载","删除","取消"];n&&l===a&&(q[0]="暂停"),E=e===y.a.musicOriginal.musicShare||e===y.a.musicOriginal.musicSearch?` ${E}`:"";const z={options:q,cancelButtonIndex:q.length-1,destructiveButtonIndex:q.length-2,badges:W,message:s?`大小: ${Object(S.b)(s)}${E}`:E,title:i,maskClosable:!0,"data-seed":"logId",wrapProps:P};e!==y.a.musicOriginal.musicShare&&e!==y.a.musicOriginal.musicSearch||U.removeMusic||(q.splice(-2,1),delete z.destructiveButtonIndex),e===y.a.musicOriginal.musicFinished?(q.splice(8,1),z.destructiveButtonIndex=q.length-2):((r===y.a.musicOriginal.savedSongs||"onlineMusic"===r||"onlineMusicSearchALl"===r&&e!==y.a.musicOriginal.musicSearch||r===y.a.musicOriginal.homeRecommend||r===y.a.musicOriginal.musicPlayList)&&(q.splice(-2,1),delete z.destructiveButtonIndex,r===y.a.musicOriginal.musicPlayList&&(q[6]="移除")),N&&W.push({index:8,text:"版"})),o.a.showActionSheetWithOptions(z,n=>{logger.info("music player showMenu buttonIndex",n);const o=A.map(e=>e.filenameOrigin),c=o.indexOf(l);if(-1===c)return logger.error("showActionSheetWithOptions currentFileIndex === -1 filename",i),alert(i+"已被删除");const P=A[c].filePath;switch(n){case 0:Object(S.o)({filePath:P,filename:i,filenameOrigin:l,uploadUsername:u,fileSize:s,duration:p,songOriginal:g,original:e,musicDataList:A,pageType:r,payPlay:f,musicId:k,songInfo:C});break;case 1:Object(S.O)({savedMusicFilenameOriginalArr:_,filenameOrigin:l,musicCollection:x,musicDataList:A,currentFileIndex:c,original:e,e:null,pageType:r});break;case 2:(!d||R||I)&&(t&&t.loop(!1),$dispatch(Object(b.jb)(!0)),$dispatch(Object(b.kb)(!1)),$dispatch(Object(b.lb)(!1)),alert("单曲播放"),$dispatch(Object(b.N)([{index:2,text:"✔️"},{index:3,text:""},{index:4,text:""},{index:5,text:""}])));break;case 3:d&&(t&&t.loop(!0),$dispatch(Object(b.jb)(!1)),$dispatch(Object(b.kb)(!1)),$dispatch(Object(b.lb)(!1)),alert("单曲循环"),$dispatch(Object(b.N)([{index:2,text:""},{index:3,text:"✔️"},{index:4,text:""},{index:5,text:""}])));break;case 4:R||(t&&t.loop(!1),$dispatch(Object(b.jb)(!0)),$dispatch(Object(b.kb)(!0)),$dispatch(Object(b.lb)(!1)),alert("顺序播放"),$dispatch(Object(b.N)([{index:2,text:""},{index:3,text:""},{index:4,text:"✔️"},{index:5,text:""}])));break;case 5:I||(t&&t.loop(!1),$dispatch(Object(b.jb)(!0)),$dispatch(Object(b.kb)(!1)),$dispatch(Object(b.lb)(!0)),alert("随机播放"),$dispatch(Object(b.N)([{index:2,text:""},{index:3,text:""},{index:4,text:""},{index:5,text:"✔️"}])));break;case 6:{let e=JSON.parse(JSON.stringify(V));if(r!==y.a.musicOriginal.musicPlayList){if(f&&!$getState().myInfo.setMusicVip)return alert("不可以添加有版权的音乐");{let t=JSON.parse(JSON.stringify(C));t.pageType=r,e.push(t);const a={};e=e.filter(e=>!a[e.filenameOrigin]&&(a[e.filenameOrigin]=!0,!0)),t=null,alert("添加成功")}}else e=e.filter(e=>e.filenameOrigin!==C.filenameOrigin),alert("已取消");$dispatch(Object(b.P)(e));break}case 7:if(Object.keys(Y).length){const e=Object(S.y)({musicDataList:A,currentFileIndex:c,filenameOrigin:l,operationAction:$,removeListenBackFunc:re});if(e.length)return void($.action=H(e));alert("没有其他歌单了");break}alert("请先创建歌单");break;case 8:e===y.a.musicOriginal.musicFinished?le(i,l,a,c,o,e,A):Object(S.N)({musicDataList:A,filename:i,uploadUsername:u,fileSize:s,musicSrc:P,filenameOrigin:l,duration:p,songOriginal:g,musicId:k,payDownload:N,mvId:C.mvId,md5:C.md5,albumId:C.albumId});break;case 9:{if(re(),("onlineMusic"===r||"onlineMusicSearchALl"===r||e===y.a.musicOriginal.musicFinished)&&e!==y.a.musicOriginal.musicSearch)return;if(!L)return goRoute(void 0,"/login");const t={username:F||M,token:L,filename:i,type:"default-music"};if(e!==y.a.musicOriginal.musicShare&&e!==y.a.musicOriginal.musicSearch||"downloaded"===D)e===y.a.musicOriginal.musicRecent?Object(v.j)("提示",m.a.createElement(O.a,{textFragment:`确定要删除 <span class="delete-alert">${i}</span> 的播放记录吗`}),"确定",()=>{let t=null;if(B.some((e,a)=>e.filenameOrigin===l&&(t=a,!0)),null!==t){const i=JSON.parse(JSON.stringify(B));if(i.splice(t,1),$dispatch(Object(b.nb)(i)),Object(j.c)(l),l===a){const t=JSON.parse(JSON.stringify(B));Object(S.q)(c,o,e,t)}}else logger.error("确定要删除播放记录吗 filenameOrigin, recentMusicList",l,B)}):"downloaded"===D?le(i,l,a,c,o,e,A):r===y.a.musicOriginal.myMusicListPage&&Object(S.I)(l,i);else{if(!U.removeMusic)return;Object(v.j)("提示",m.a.createElement(O.a,{textFragment:`确定要从服务器删除 <span class="delete-alert">${i}</span> 吗`}),"确定",()=>(Object(v.B)(),axios.delete(h.a.delFileV2,{data:t}).then(t=>{if(window.toast.hide(),!window.cancelAxiosRequest)return"success"===t.result?($dispatch(Object(w.i)(t.token)),alert("删除成功"),me(e,l)):"file_deleted"===t.result?(alert("文件已删除!"),me(e,l)):void logger.error("HTTP_URL.delFileV2 result",t)}).then(()=>{l===a&&Object(S.q)(c,o,e,A)}).catch(e=>{window.toast.hide(),logger.error("HTTP_URL.delFileV2 err",e),Object(v.q)(e,`musicPlayer delFile filenameOrigin: ${l}`)}).finally(()=>{window.cancelAxiosRequest=!1})))}return}}re()})}).bind(void 0,u.filename,u.fileSize,u.filenameOrigin,u.uploadUsername,u.duration,u.original,Number(u.payPlay),Number(u.payDownload),u.id,u.date,u.status,u)},m.a.createElement("div",{className:"dot"}),m.a.createElement("div",{className:"dot"}),m.a.createElement("div",{className:"dot"})):m.a.createElement("div",{className:"move-downloading-item fa fa-remove",onClick:((e,t)=>{Object(v.j)("提示",m.a.createElement(O.a,{textFragment:`确定要移除下载 <span class="delete-alert">${e}</span> 吗`}),"确定",()=>{const e=Object(S.H)(t);window.eventEmit.$emit(`FileTransfer-${e}`,"abort"),window[`remove-download-${e}`]=!0,setTimeout(()=>{window[`remove-download-${e}`]=!1},1500);const{downloadingMusicItems:a}=$getState().fileServer,i=JSON.parse(JSON.stringify(a));for(const e in a)if(Object.prototype.hasOwnProperty.call(a,e)&&a[e].filenameOrigin===t){i.splice(e,1),$dispatch(Object(b.o)(i)),Object(N.c)(t);break}logger.info("saveFileToLocal param, downloadingMusicItems",a)})}).bind(void 0,u.filename,u.filenameOrigin)}));Object(S.n)(A,r);const ue=e===y.a.musicOriginal.musicDownloading;let pe=0;return Z&&G?pe=G:ee&&K?pe=K:te&&Q?pe=Q:ae&&X&&(pe=X),m.a.createElement(l.Fragment,null,m.a.createElement("div",{className:"music-list-container",style:{height:r===y.a.musicOriginal.musicFinished?"auto":"100%"},ref:z},J?m.a.createElement(g.a,{width:window.screen.width,height:J,rowCount:A.length,rowHeight:66,onScroll:({scrollTop:e})=>{E=e,Z&&G?$dispatch(Object(b.S)(0)):ee&&K?$dispatch(Object(b.R)(0)):te&&Q?$dispatch(Object(b.Q)(0)):ae&&X&&$dispatch(Object(b.L)(0))},scrollTop:pe||void 0,rowRenderer:({key:e,index:t,style:a})=>m.a.createElement("div",{key:e,style:a,className:"music-list",id:Object(k.d)(A[t].filenameOrigin)},de(A[t],t))}):A.map((e,t)=>m.a.createElement("div",{key:e.filenameOrigin,className:"music-list",id:Object(k.d)(e.filenameOrigin)},de(e,t)))),r===y.a.musicOriginal.savedSongs&&m.a.createElement("div",{className:"music-picture"}),!H&&!q&&m.a.createElement(f.default,{fromMusicControl:!0,myMusicPage:W,searchMusicPage:_}))})},564:function(e,t,a){"use strict";a.r(t);a(399);var i=a(400),s=a.n(i),n=(a(556),a(557)),o=a.n(n),r=a(0),c=a.n(r),l=a(95),m=a(123),d=a.n(m),u=(a(353),a(354)),p=a.n(u),g=a(9);var h=class extends c.a.Component{render(){let{percent:e,appSize:t,appTotalSize:a,checkingPackage:i}=this.props;return t=Object(g.b)(t),a=Object(g.b)(a),c.a.createElement("div",{className:"progress-area"},c.a.createElement("div",{className:"progress-container"},c.a.createElement("div",{className:"updating"},"正在更新"),c.a.createElement("div",{className:"show-info"},c.a.createElement("div",{className:"number","aria-hidden":"true"},e,"%"),c.a.createElement("div",{className:"progress"},c.a.createElement(p.a,{percent:e,position:"normal"})),i?c.a.createElement("div",{className:"check-package"},"正在校验安装包..."):c.a.createElement("div",{className:"process-size","aria-hidden":"true"},t,"/",a))))}},f=a(337),O=a(94),b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},v=({faName:e,displayName:t,style:a={},click:i=(()=>{})})=>c.a.createElement("div",{className:"item-container",style:b({},a),onClick:i},c.a.createElement("div",{className:"icon"},c.a.createElement("i",{className:`fa ${e}`,"aria-hidden":"true"})),c.a.createElement("div",{className:"text"},c.a.createElement("span",{className:"square-item-text"},t))),w=a(358),S=a(97),y=a(3),j=a(8),N=a(2),k=a(11),P=a(106),E=a(45),$=a(13),R=a(7),x=a(6),T=a(157),F=a(34),L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};function I(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){return function i(s,n){try{var o=t[s](n),r=o.value}catch(e){return void a(e)}if(!o.done)return Promise.resolve(r).then(function(e){i("next",e)},function(e){i("throw",e)});e(r)}("next")})}}t.default=Object(l.connect)(e=>({adsTime:e.common.adsTime,username:e.login.username,token:e.login.token,alreadySignUpPersons:e.sign.alreadySignUpPersons,notSignUpPersons:e.sign.notSignUpPersons,setNickname:e.myInfo.setNickname,directShowHomePage:e.sign.directShowHomePage,savedCurrentRoute:e.common.savedCurrentRoute,isFromLoginPage:e.login.isFromLoginPage,alwaysShowAdsPage:e.common.alwaysShowAdsPage,allowGetPosition:e.common.allowGetPosition,adNumber:e.sign.adNumber,fromResume:e.sign.fromResume,isFromSignPage:e.common.isFromSignPage,isFromSystemSetup:e.common.isFromSystemSetup,adPicSrc:e.common.adPicSrc,loadedInWifi:e.common.loadedInWifi,justOpenApp:e.sign.justOpenApp,showUpdateConfirm:e.sign.showUpdateConfirm,needRetryRequestWhenLaunch:e.sign.needRetryRequestWhenLaunch,showDownloadAppTip:e.sign.showDownloadAppTip,setMobile:e.myInfo.setMobile,appVersion:e.common.appVersion,showAdsTransition:e.sign.showAdsTransition,setHeadPic:e.myInfo.setHeadPic,headPicAddress:e.myInfo.headPicAddress,replaceHeadPic:e.myInfo.replaceHeadPic,defaultSearchShortKey:e.common.defaultSearchShortKey,topSong:e.common.topSong,offlineState:e.common.offlineState,musicList:e.fileServer.musicList,loadingRecommendSongs:e.common.loadingRecommendSongs,runInBackGround:e.common.runInBackGround}),()=>({}))(class extends r.Component{constructor(e){var t;t=super(e),this.startToShowAds=(e=>{this.leftRectRef&&this.leftRectRef.style&&(this.leftRectRef.style.animation=`left ${e-.9}s linear`,this.rightRectRef.style.animation=`right ${e-.9}s linear`,this.leftRectRef.style["-webkit-animation"]=`left ${e-.9}s linear`,this.rightRectRef.style["-webkit-animation"]=`right ${e-.9}s linear`),logger.info("start ad page this.getAdsConfig skipTime",e),$dispatch(Object($.l)(!0)),this.getAdsConfig()}),this.clockFunc=(()=>{let e=(new Date).getMinutes(),t=(new Date).getHours();e<10&&(e="0"+e),t<10&&(t="0"+t);let a="";t<6?a="凌晨好！":t<8?a="早上好！":t<11?a="上午好！":t<14?a="中午好！":t<17?a="下午好！":t<19?a="傍晚好！":t<24&&(a="晚上好！"),this.setState({greetingsWord:a})}),this.getAdsConfig=(()=>{let{skipTime:e}=this.state;logger.info("getAdsConfig skipTime",e),this.setState({skipTime:--e},()=>{setTimeout(()=>{this.checkUpdateFlag||(e<=1?(logger.info("skipTime",e),this.skip()):this.getAdsConfig())},1e3)})}),this.skip=(()=>{const{savedCurrentRoute:e}=this.props;if(this.setState({skipTime:0}),isCordova&&setTimeout(()=>{window.StatusBar.backgroundColorByHexString(N.a.statusBarColor)},1),$dispatch(Object($.d)(!0)),$dispatch(Object(x.r)(!1)),$dispatch(Object($.l)(!1)),this.checkUpdateFlag||(this.checkUpdateFlag=!0,setTimeout(()=>{document.addEventListener("deviceready",this.checkUpdateSign,!1),isElectron&&Object(y.g)()},300)),e)return $dispatch(Object(x.F)("")),goRoute(this,e)}),this.listenBackKeyDown=(()=>{const{isFromLoginPage:e}=this.props;logger.info("this.props.isFromLoginPage",e),document.addEventListener("backbutton",this.onBackKeyDownSign,!1)}),this.dealWithLocation=(()=>{const{allowGetPosition:e}=this.props;isCordova?e&&document.addEventListener("deviceready",P.c,!1):e&&Object(P.b)()}),this.onBackKeyDownSign=(()=>{const e=this,{showUpdateConfirm:t}=this.props;t?(this.setState({showProgress:!1}),Object(y.j)("提示","确定要取消下载吗","确定",function(){e.setState({showProgress:!1},()=>{e.state.fileTransfer.abort&&e.state.fileTransfer.abort(),e.forceUpgrade&&Object(y.m)()})},()=>{e.setState({showProgress:!0}),$dispatch(Object($.n)(!0))}),Promise.resolve().then(()=>{$dispatch(Object($.n)(!1))})):Object(y.r)()}),this.checkUpdateSign=(()=>{var e=I(function*(e){const a=t,i=Date.now(),{appVersion:s}=t.props,n=yield Object(y.o)("last_close_update.txt",!0);return axios.get(j.a.checkUpdate.format({appVersion:s||!1,notCheckOutOfDateVersion:!0===e?"yes":"no"})).then((()=>{var e=I(function*(e){if(!e)return logger.info("checkUpdateSign no result");if(e.disableUpdate)return logger.info("checkUpdateSign disableUpdate");if(e.outOfDate)return Object(y.j)("提示","当前app版本过低，必须升级才能继续使用","立即更新",function(){const e=Date.now()-2592e5;return a.writeFileFunc(e),a.forceUpgrade=!0,a.tooOldVersion=!0,a.checkUpdateSign(!0)},y.m);const{updateInfo:s}=e,o=s.version,r=s.appSize,l=s.MD5,m=s.content,d=s.forceUpgradeText||"因系统接口重大升级,必须更新app才能使用",u=s.alertNotice,p=s.confirmNotice,h=s.menuList,{appVersion:f}=t.props;if(window.newAppSize=r,t.forceUpgrade||(t.forceUpgrade=s.forceUpgrade),h&&Array.isArray(h)&&h.length&&$dispatch(Object(x.x)(h)),logger.info(`remote appVersion, ${o}`),logger.info(`local appVersion, ${f}`),u&&u.enable)yield new Promise(function(e){Object(y.a)("公告",u.content,"我知道了",e)});else if(p&&p.enable)return Object(y.j)("提示",p.content,p.confirmButton,function(){Object(y.s)(p.link)});if(o>f){if(logger.info("发现新版本 remoteAppVersion",o,"appVersion",f),n&&logger.info("(date - content.closeUpdateDate) / (1000 * 3600 * 24))",(i-n.closeUpdateDate)/864e3),$dispatch(Object(R.t)(!0)),(t.forceUpgrade||!n||(i-n.closeUpdateDate)/864e5>2)&&"/main/home"===getRoute())if(localStorage.removeItem("showInstallAppTip"),localStorage.removeItem("alreadyShowInstallAppTip"),t.forceUpgrade&&!t.tooOldVersion)Object(y.a)("提示",d,"知道了",function(){Object(y.j)("发现新版本",c.a.createElement(O.a,{list:m,remoteAppVersion:o,appSize:r}),"立即下载",function(){a.checkUpdate(j.a.appRelease,N.a.appName,l)},y.m)});else{const e=Date.now();a.writeFileFunc(e),Object(y.j)("发现新版本",c.a.createElement(O.a,{list:m,remoteAppVersion:o,appSize:r}),"立即下载",function(){a.checkUpdate(j.a.appRelease,N.a.appName,l)},function(){a.forceUpgrade&&Object(y.m)()})}else if(n&&(i-n.closeUpdateDate)/864e5<=2){const e=yield Object(g.f)(N.a.appName);if(logger.info("silent upgrade download isAppExisted",e),"yes"===localStorage.getItem("showInstallAppTip")&&e&&"yes"!==localStorage.getItem("alreadyShowInstallAppTip"))return localStorage.setItem("alreadyShowInstallAppTip","yes"),Object(y.j)("提示","升级包已在wifi环境下准备就绪,是否立即安装","立即安装",function(){Object(g.w)({msg:"prepare to install by silent upgrade download"}),$dispatch(Object(x.q)(!0)),Object(T.a)()});"yes"!==localStorage.getItem("showInstallAppTip")&&"当前为Wi-Fi环境，更新无需移动流量"===window.getNetType()&&(Object(g.w)({msg:"start to download by silent upgrade download"}),window.resolveLocalFileSystemURL(cordova.file.externalApplicationStorageDirectory,function(e){e.getFile(N.a.appName,{create:!0,exclusive:!1},function(e){let t=0;const a=new window.FileTransfer;a.onprogress=function(e){if(e.lengthComputable){const a=e.loaded/e.total;t=(100*a).toFixed(0)}},a.download(encodeURI(j.a.appRelease),e.nativeURL,function(e){(t>1||1===t)&&(localStorage.setItem("showInstallAppTip","yes"),logger.info("silent upgrade download success"))},function(e){alertDebug("silent upgrade download fail"),logger.error("silent upgrade download fail error",e)})})}))}}else logger.info("已是最新版本")});return function(t){return e.apply(this,arguments)}})()).catch(function(e){logger.error("checkUpdateSign err",e),alertDebug("checkUpdateSign err")})});return function(t){return e.apply(this,arguments)}})(),this.writeFileFunc=(e=>{let t=Object.assign({},{closeUpdateDate:e});t=JSON.stringify(t),t=(new window.Base64).encode(t),Object(y.C)(t,"last_close_update.txt",!1)}),this.checkUpdate=((e,t,a)=>{Object(g.d)(e,t,a,this.downloadAppFunc,this.preview,{exit:y.m,forceUpgrade:this.forceUpgrade})}),this.downloadAppFunc=((e,t,a)=>{const i=this;return Object(g.w)({msg:"start to upgrade app on home page"}),new Promise(function(s){window.resolveLocalFileSystemURL(cordova.file.externalApplicationStorageDirectory,function(n){n.getFile(t,{create:!0,exclusive:!1},function(t){const s=new window.FileTransfer;$dispatch(Object($.n)(!0)),i.setState({showProgress:!0});let n=0;s.onprogress=function(e){if(e.lengthComputable){const t=e.loaded/e.total;n=(100*t).toFixed(0)}Object(y.k)(()=>{i.setState({progress:n,appSize:e.loaded,appTotalSize:e.total,fileTransfer:s})},200)()},s.download(encodeURI(e),t.nativeURL,function(e){(n>1||1===n)&&(i.setState({checkingPackage:!0}),setTimeout(()=>{window.md5chksum.file(t,function(s){logger.info("home page app package MD5SUM: "+s,"MD5",a),s===a?(i.setState({showProgress:!1,checkingPackage:!1}),$dispatch(Object($.n)(!1)),Object(y.j)("提示","下载完成","立即安装",function(){e.file(e=>{Object(g.w)({msg:"start to install app in home page"}),i.preview(t,e.type)})},()=>{i.forceUpgrade&&Object(y.m)()})):(logger.error("home page MD5",a,"md5sum",s),i.setState({showProgress:!1,checkingPackage:!1}),$dispatch(Object($.n)(!1)),Object(y.a)("提示","安装包已损坏，请重新安装"),Object(y.s)(N.a.appDownloadUrl))},function(e){logger.error("home page Error-Message: ",e),i.setState({showProgress:!1,checkingPackage:!1}),$dispatch(Object($.n)(!1)),Object(y.a)("提示","安装包已损坏，请重新安装"),Object(y.s)(N.a.appDownloadUrl)})},2e3))},function(e){logger.error("下载失败",e)})},function(e){n.getFile(t,{create:!1},function(e){s(i.preview(e))},function(e){logger.error("升级文件读取错误",e)})})},function(e){logger.error("文件系统加载失败！",e)})})}),this.preview=((e,t="application/vnd.android.package-archive")=>{this.forceUpgrade&&setTimeout(y.m,1e3),Object(g.E)(e,t)}),this.gotoUserProfile=(()=>{$dispatch(Object(x.t)(!0)),goRoute(this,"/user_profile")}),this.downloadApp=(()=>{this.cancelTips||($dispatch(Object($.m)(!1)),Object(y.v)({filenameOrigin:"signPageAds",fileUrl:N.a.appDownloadUrl,folder:N.a.downloadAppFromPage}))}),this.cancelShowTip=(()=>{this.cancelTips=!0,$dispatch(Object($.m)(!1))}),this.clickHomeSearch=(()=>{$dispatch(Object(x.s)(!0)),goRoute(this,"/search_all")}),this.moduleRoute=((e,t,a)=>{const{token:i,history:s}=this.props;$dispatch(Object(x.s)(!0)),"package_iframe"===e?s.push({pathname:"/package_iframe",query:{name:t,src:a}}):"/sign"!==e||i?window.goRoute(this,e):window.goRoute(this,"/login")}),this.scrollToTop=(()=>{this.musicPlayerRef.current.scrollTop>0&&(this.musicPlayerRef.current.scrollTop=this.musicPlayerRef.current.scrollTop-30,this.musicPlayerRef.current.scrollTop>0&&requestAnimationFrame(this.scrollToTop))});const{adsTime:a,adNumber:i,isFromSignPage:s,fromResume:n,adPicSrc:o,loadedInWifi:r}=this.props;s&&$dispatch(Object(x.t)(!1));const l=localStorage.getItem("adsName"),m=localStorage.getItem("isWiFiNetwork");let d=r,u=o;this.fromResume=n,l&&m&&n&&(n&&$dispatch(Object($.e)(!1)),localStorage.removeItem("adsName"),localStorage.removeItem("isWiFiNetwork"),window.downloadAdPicTimer||Object(P.a)(),d="yes"===m?"已wifi预加载":"",u=`/storage/emulated/0/miXingFeng/adPics/${l}`,$dispatch(Object(x.b)(u)),$dispatch(Object(x.v)(d))),this.offsetXValue=0,this.offsetYValue=0,this.offsetFirstXValue=0,this.offsetFirstYValue=0,this.movingX=!1,this.movingY=!1,this.musicPlayerRef=c.a.createRef(),this.state={skipTime:a||4,progress:0,appSize:100,appTotalSize:100,showProgress:!1,fileTransfer:{},checkingPackage:!1,loadedInWifi:d,adPicSrc:u||`./ads/ad${i}.png`,greetingsWord:""}}componentDidMount(){var e=this;return I(function*(){try{const{skipTime:t}=e.state,{directShowHomePage:a,alwaysShowAdsPage:i,token:s,isFromLoginPage:n,justOpenApp:o,fromResume:r,isFromSystemSetup:c,needRetryRequestWhenLaunch:l,alreadySignUpPersons:m,notSignUpPersons:u,offlineState:p,runInBackGround:g}=e.props;if(c)return;if(yield Object(F.u)(),i){logger.info("directShowHomePage",a);const i=localStorage.getItem("adsName"),s=localStorage.getItem("isWiFiNetwork");if(logger.info("adsName",i,"isWiFiNetwork",s,"fromResume",r),window.downloadAdPicTimer||i||s||Object(P.a)(),!a)if(localStorage.getItem("everLaunched")){d.a.preloadAll();try{logger.info("splashscreen.hide",typeof navigator.splashscreen),setTimeout(function(){navigator.splashscreen&&navigator.splashscreen.hide(),g?window.eventEmit.$on("app-resume",function(){e.appResumeFlag=!0,e.startToShowAds(t)}):e.startToShowAds(t)},100)}catch(e){logger.error("splashscreen err",e.stack||e.toString())}}else localStorage.setItem("everLaunched","true"),window.StatusBar&&window.StatusBar.backgroundColorByHexString(N.a.statusBarColor),d.a.preloadAll(),$dispatch(Object($.d)(!0)),$dispatch(Object(x.r)(!1)),setTimeout(function(){logger.info("splashscreen.hide",typeof navigator.splashscreen),navigator.splashscreen&&navigator.splashscreen.hide()},800)}else logger.info("componentDidMount alwaysShowAdsPage",i),d.a.preloadAll(),isCordova?setTimeout(function(){window.StatusBar.backgroundColorByHexString(N.a.statusBarColor),document.addEventListener("deviceready",e.checkUpdateSign,!1),logger.info("splashscreen.hide",typeof navigator.splashscreen),navigator.splashscreen.hide()},800):isElectron&&Object(y.g)();if(e.clockFunc(),document.addEventListener("deviceready",e.listenBackKeyDown),Object(F.i)(),!s&&localStorage.getItem("tk")&&$dispatch(Object(k.i)(localStorage.getItem("tk"))),!o&&p)return;if(o||l)(new Date).getHours()<6&&setTimeout(function(){return alert("夜深了,请注意休息")},1e3*(t-1)),$dispatch(Object($.f)(!1)),$dispatch(Object($.r)((new Date).getDate())),Object(F.o)(),Object(F.p)(),Object(F.q)(),Object(F.e)().then(function(){return Promise.all([Object(F.f)(),Object(F.g)(),Object(F.c)(),Object(F.h)(e)])}).then(function(){return $dispatch(Object($.h)(!1)),Promise.all([Object(P.e)(),Object(P.d)()])}).catch(function(e){logger.error("main/home ajax error",e)});else{isCordova&&window.StatusBar.backgroundColorByHexString(N.a.statusBarColor);let e=!1;!s||m.length||u.length||(e=!0),logger.info("home isFromLoginPage",n),(n||e)&&(Object(P.e)(),Object(P.d)(),$dispatch(Object(k.e)(!1)))}e.dealWithLocation(),setTimeout(function(){Object(E.b)("homeSocket check")},3500)}catch(e){logger.error("home componentDidMount",e.stack||e.toString())}})()}componentWillUnmount(){const{isFromSystemSetup:e,loadingRecommendSongs:t,needRetryRequestWhenLaunch:a}=this.props;document.removeEventListener("deviceready",this.listenBackKeyDown,!1),document.removeEventListener("backbutton",this.onBackKeyDownSign,!1),document.removeEventListener("deviceready",this.checkUpdateSign,!1),e&&$dispatch(Object(x.u)(!1)),t&&$dispatch(Object(x.w)(!1)),this.appResumeFlag&&window.eventEmit.$off("app-resume"),a&&[{url:j.a.getDefaultSearchWord,method:"get"},{url:j.a.getList.format({fileType:"file"}),method:"get"},{url:j.a.getList.format({fileType:"music"}),method:"get"},{url:j.a.tokenLogin,method:"post"},{url:j.a.getRecommendSongs,method:"get"},{url:j.a.getTopSongs,method:"get"}].forEach(e=>Object(F.r)(e))}render(){const{showProgress:e,skipTime:t,progress:a,appSize:i,appTotalSize:n,checkingPackage:r,loadedInWifi:l,adPicSrc:m,greetingsWord:d}=this.state,{username:u,token:p,setNickname:g,directShowHomePage:O,isFromSystemSetup:b,showDownloadAppTip:y,setMobile:j="",showAdsTransition:k,setHeadPic:P,replaceHeadPic:E,defaultSearchShortKey:$,topSong:R,musicList:x,loadingRecommendSongs:T,offlineState:F}=this.props;let{headPicAddress:I}=this.props;const M=g||u||j||"";return E&&(I=serverHost+"/"+P),c.a.createElement("div",{className:"main-page"},c.a.createElement("div",{className:`home-page ${O?"show-home":"not-show-home"} ${this.fromResume?"from-resume-home":""}`},c.a.createElement(f.a,null),c.a.createElement("div",{className:"header"},c.a.createElement(o.a,{placeholder:`${$||"搜索"}`,className:"home-search",cancelText:"",onFocus:this.clickHomeSearch}),p?c.a.createElement("span",{className:"user",onClick:this.gotoUserProfile},!P||!I||F&&isH5?c.a.createElement("span",{className:"user-head-text"},M.slice(0,1).toUpperCase()):c.a.createElement("img",{className:"user-info-head-pic",src:I,alt:M.slice(0,1).toUpperCase()})):c.a.createElement("span",{className:"greetings"},d)),c.a.createElement("div",{className:"home-area"},isH5&&y?c.a.createElement("div",{className:"show-download-app-tips",onClick:this.downloadApp},c.a.createElement(s.a,{mode:"closable",onClick:e=>this.cancelShowTip(e)},"app打开体验更佳")):null,c.a.createElement("div",{className:"swiper-container"},c.a.createElement("div",{className:"swiper-wrapper"},N.b.map((e,t)=>c.a.createElement("div",{className:"swiper-slide",key:e.displayName||t},c.a.createElement("div",{className:"swiper-item"},c.a.createElement(v,{faName:e[0].faName,displayName:e[0].displayName,click:()=>this.moduleRoute(e[0].route,e[0].displayName,e[0].src),style:L({},e[0].style)}),c.a.createElement(v,{faName:e[1].faName,displayName:e[1].displayName,click:()=>this.moduleRoute(e[1].route,e[1].displayName,e[1].src),style:L({},e[1].style)})),c.a.createElement("div",{className:"swiper-item",style:{marginTop:"-15px"}},c.a.createElement(v,{faName:e[2].faName,displayName:e[2].displayName,click:()=>this.moduleRoute(e[2].route,e[2].displayName,e[2].src),style:L({},e[2].style)}),c.a.createElement(v,{faName:e[3].faName,displayName:e[3].displayName,click:()=>this.moduleRoute(e[3].route,e[3].displayName,e[3].src),style:L({},e[3].style)}))))),c.a.createElement("div",{className:"swiper-pagination"})),c.a.createElement("div",{className:`recommendation-container ${isH5&&y?"show-download-app-height":""}`},c.a.createElement("div",{className:"title"},c.a.createElement("div",{className:"text"},"为你推荐")),c.a.createElement("div",{className:"recommend-content",ref:e=>this.recommendRef=e},T?c.a.createElement(S.a,{text:"正在为你推荐"}):null,c.a.createElement(w.a,{musicDataList:R||x,original:N.a.musicOriginal.homeRecommend,pageType:N.a.musicOriginal.homeRecommend,musicPlayerRef:this.musicPlayerRef,height:(R||x).length>N.a.maxSongsNumberInOneCustomPage&&window.screen.height-350}))))),e?c.a.createElement(h,{percent:a,appSize:i,appTotalSize:n,checkingPackage:r}):"",c.a.createElement("div",{className:`ads-container ${O?"not-show-ads":""}\n\t\t\t\t\t\t${k?"show-ads-transition":""}\n\t\t\t\t\t\t${b?"is-from-system-setup":""}\n\t\t\t\t\t`},c.a.createElement("div",{className:"top-ads"},c.a.createElement("div",{className:"tip-text"},l),b?c.a.createElement("div",{className:"skip-ads",onClick:this.skip},"跳过"):c.a.createElement("div",{className:"rect-box",onClick:this.skip},c.a.createElement("div",{className:"rect left"},c.a.createElement("div",{className:"circle",ref:e=>this.leftRectRef=e})),c.a.createElement("div",{className:"rect right"},c.a.createElement("div",{className:"circle",ref:e=>this.rightRectRef=e})),c.a.createElement("div",{className:"skip-text"},"跳过 ",t)),c.a.createElement("img",{src:m,alt:""}),c.a.createElement("div",{className:"ads-text"},"广告")),c.a.createElement("div",{className:"bottom-info"},c.a.createElement("div",{className:"bottom-content"},c.a.createElement("img",{className:"app-logo",src:"logo.png",alt:"logo"}),c.a.createElement("div",{className:"app-text"},c.a.createElement("div",{className:"app-name"},"觅星峰"),c.a.createElement("div",{className:"app-description"},"堪舆倒斗觅星峰"))))))}})}}]);